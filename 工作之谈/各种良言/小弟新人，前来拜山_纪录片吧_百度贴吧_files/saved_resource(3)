var Balv={config:{url:{dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete",closetip:"/f/like/commit/notice/delete"}},__body:function(){var a=0,i=0,g=0,c=0,b=0,j=0;var h=window,e=document,f=e.documentElement;a=f.clientWidth||e.body.clientWidth;i=h.innerHeight||f.clientHeight||e.body.clientHeight;c=e.body.scrollTop||f.scrollTop;g=e.body.scrollLeft||f.scrollLeft;b=Math.max(e.body.scrollWidth,f.scrollWidth||0);j=Math.max(e.body.scrollHeight,f.scrollHeight||0,i);return{scrollTop:c,scrollLeft:g,documentWidth:b,documentHeight:j,viewWidth:a,viewHeight:i}},showFloatTip:function(c){var a=document.getElementById("userlike_tip");var b=null;if(c=="join"){return}else{if(c=="lvup"){b=document.getElementById("userlike_tip_lvup")}}if(a){var d=Balv.__body();a.style.width=d.documentWidth+"px";a.style.height=d.documentHeight+"px";a.style.display="block";if(b){b.style.display="block";b.style.left=Math.max(parseInt((d.viewWidth-b.offsetWidth)/2,10),0)+d.scrollLeft+"px";b.style.top=Math.max(parseInt((d.viewHeight-b.offsetHeight)/2,10),0)+d.scrollTop+"px"}}if(c=="lvup"){setTimeout(function(){Balv.closeFloatTip("lvup")},5000)}},closeFloatTip:function(c){var a=document.getElementById("userlike_tip");var b=null;if(c=="join"){b=document.getElementById("userlike_tip_join")}else{if(c=="lvup"){b=document.getElementById("userlike_tip_lvup")}}if(a){a.style.display="none"}if(b){b.style.display="none"}if(c=="lvup"){Balv._close_tip("lvup")}},showAlert:function(b){var a='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+b+"</div>";$.dialog.open(a,{title:"\u64cd\u4f5c\u5931\u8d25",width:380})},howtojoin:function(){$.dialog.alert("<div style='padding:20px;line-height:30px;padding-bottom:0px;'>\u70b9\u51fb\u53f3\u4fa7\u4e0a\u65b9\u201c<img align='absmiddle' src='"+PageData.staticDomain+"tb/static-member/img/whatlevel.png'></img>\u201d<br/>\u5373\u53ef\u52a0\u5165\u672c\u5427\uff0c\u70b9\u4eae\u5934\u8854\uff0c\u4ece\u521d\u7ea7\u7c89\u4e1d\u5f00\u59cb\u6210\u957f\uff01</div>",{title:"\u5982\u4f55\u52a0\u5165",width:325})},dolike:function(){if(PageData.user.is_login&&PageData.user.no_un){TbCom.process("User","buildUnameFrame","\u586b\u5199\u7528\u6237\u540d","\u6709\u7528\u6237\u540d\u624d\u80fd\u70b9\u4eae\u201c\u6211\u559c\u6b22\u201d\uff0c\u8d76\u5feb\u7ed9\u81ea\u5df1\u8d77\u4e00\u4e2a\u5427~");return false}var a={fid:PageData.forum.id,fname:PageData.forum.name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post(Balv.config.url.dolike,a,function(f){var b=false;try{var c=f}catch(d){b=true}if(b){return}if(c&&c.no==0){Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid);_.Module.use("ucenter/component/LikeTip",["",false,{index:c.data.ret.index,like_no:c.like_no}]);$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto")}else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+c.no);var e="";if(c.no==8||c.no==9){e="\u4f60\u5728\u672c\u5427\u88ab\u5c01\u7981\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(c.no==220){e="\u4f60\u88ab\u5427\u4e3b\u52a0\u5165\u9ed1\u540d\u5355\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c"}else{if(c.no==221){e="\u4f60\u5df2like\u4e86\u672c\u5427,\u8bf7\u4e0d\u8981\u91cd\u590d\u64cd\u4f5c"}else{e="\u62b1\u6b49\uff0c\u5f02\u5e38\u9519\u8bef\uff0c\u5efa\u8bae\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u4e00\u4e0b"}}}Balv.showAlert(e)}},"json")},undolike:function(){var a={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(Balv.config.url.undolike,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){$.tb.location.reload(true)}else{}})},showexpbar:function(){var d=document.getElementById("userlike_expbar");var c=document.getElementById("userlike_expnum_cur");var e=document.getElementById("userlike_expnum_max");var f=0;var a=0;if(c&&e){f=parseInt(c.innerHTML,10);a=parseInt(e.innerHTML,10)}var b=parseInt(document.getElementById("userlike_expborder").offsetWidth,10);if(f==0){d.style.display="none"}else{d.style.display="block"}if(a!=0){d.style.width=parseInt(b*f/a,10)+"px"}},show_titleset_tip:function(){var a=(new Date()-new Date("2011/11/18"))/86400000;if(a>=14||a<=0){return}if($.cookie("close_titleset_tip")=="false"){return}$.cookie("close_titleset_tip",true,{expires:14});var b=new Array();b.push("<div style='width:220px;padding:3px 0'>");b.push("\u53ef\u5bf9\u4f1a\u5458\u8fdb\u884c\u7ba1\u7406\uff0c\u5305\u62ec\u5934\u8854\u540d\u8bbe\u7f6e\u3002");b.push("</div>");Tinytip.render("titleManageLink",b.join(""),true,false,false,1,true,function(){$.cookie("close_titleset_tip",false,{expires:14})})},show_tcbox_tip:function(){var a=(new Date()-new Date("2012/04/01"))/86400000;if(a>=1||a<=0){return}if($.cookie("close_tcbox_tip")=="false"){return}$.cookie("close_tcbox_tip",true,{expires:14});var b=new Array();b.push("<div style='width:145px;padding:4px;text-align:left;'>");b.push("\u611a\u4eba\u8282\uff0c\u5934\u50cf\u76f8\u6846\u5927\u53d8\u8eab\uff01\u8bb0\u5f97\u8981\u9884\u89c8\u5594~");b.push("</div>");Tinytip.render("my_entrance_tcbox",b.join(""),true,false,false,1,true,function(){Balv.clean_tcbox_session()},true)},clean_tcbox_session:function(){$.cookie("close_tcbox_tip",false,{expires:14})},show_firstlike_tip:function(){var a=new Array();a.push("<div style='width:200px;'>");a.push("<img style='vertical-align: middle; margin-bottom: 5px;width:16px;height:16px;' src='"+PageData.staticDomain+"/tb/img/icon_tip1.png?v=1.0' />");a.push("<a href='' onclick='BalvInfo.render();return false;' target='_blank'>\u5982\u4f55\u83b7\u5f97\u7ecf\u9a8c\uff0c\u63d0\u5347\u5934\u8854\uff1f</a>");a.push("</div>");Tinytip.render("userlike_info_tip",a.join(""),true,false,false,1,true,Balv.close_firstlike_tip)},close_firstlike_tip:function(){Balv._close_tip("first")},show_shortblock_tip:function(c,a){var b=new Array();b.push("<div style='width:205px;text-align:left;margin:6px 0px 6px 10px;'>");b.push("<div style='width:205px;'><span>\u4f60\u5df2\u88ab"+a+"\u5c01\u7981\uff0c\u8fd8\u5269</span><span style='color:#ff7f40;font-weight:bold;'>"+c+"</span><span>\u5929\u89e3\u5c01,<span></br><span>\u5c01\u7981\u671f\u95f4\u4e0d\u52a0\u7ecf\u9a8c\uff0c\u5934\u8854\u548c\u6743\u9650\u6536\u56de\u3002</span></div><div style='text-align:right;margin-right:5px;'><a href='http://tieba.baidu.com/pmc/main?fid="+PageData.forum.id+"' target='_blank'>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</a></div>");b.push("</div>");Tinytip.render("userliked_ban_content",b.join(""),false,false,true,2,false)},show_block_tip:function(){var a=new Array();a.push("<div style='width:205px;text-align:left;margin:6px 0px 6px 10px;'>");a.push("<div><span>\u4f60\u5df2\u88ab\u7cfb\u7edf\u6c38\u4e45\u5c01\u7981\uff0c<br/>\u5c01\u7981\u671f\u95f4\u4e0d\u52a0\u7ecf\u9a8c\uff0c\u5934\u8854\u548c\u6743\u9650\u6536\u56de\u3002</span></div><div style='text-align:right;margin-right:5px;'><a href='http://tieba.baidu.com/pmc/main' target='_blank'>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</a></div>");a.push("</div>");Tinytip.render("userliked_ban_content",a.join(""),false,false,true,2,false)},show_black_tip:function(){var a=new Array();a.push("<div style='width:180px;text-align:left;margin:6px 0px 6px 10px;'>");a.push("<span>\u4f60\u5df2\u88ab\u5427\u4e3b\u62c9\u5165\u9ed1\u540d\u5355\uff0c</span></br><span>\u4f60\u5728\u672c\u5427\u7684\u5934\u8854\u548c\u6743\u9650\u4e5f\u88ab\u6536\u56de\u3002</span>");a.push("</div>");Tinytip.render("userliked_ban_content",a.join(""),false,true,true,2,false)},show_award_tip:function(d,e,a,c){var b=new Array();b.push("<div style='width:210px;'>");b.push("<div style='float:left;text-align:left;padding-left:12px;padding-top:9px;line-height:18px;'><span style='color:#555555;'>"+d+"</span></br>");b.push("<div style='float:left;text-align:left;line-height:18px;padding-bottom:6px;'><a href='"+a+"' style='display:inline;'>"+c+"</a></br>");b.push("</div></div>");Tinytip.render("userlike_info_tip",b.join(""),true,false,true,8,true,Balv.close_award_tip);Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlvup")},close_award_tip:function(){Balv._close_tip("award")},show_trans_tip:function(b){var a=new Array();a.push("<div style='width:170px;padding: 8px 0px 8px 8px;text-align:left;'>");a.push("<div style='width:170px;line-height:18px;color:#555555;'><span>"+b+"</span></div>");a.push("<div style='width:170px;line-height:22px;'><img style='vertical-align: middle;margin-bottom: 5px;width:16px;height:16px;' src='"+PageData.staticDomain+"/tb/img/icon_tip1.png?v=1.0' /><a href='' onclick='BalvInfo.render();return false;' target='_blank'>\u5982\u4f55\u83b7\u5f97\u7ecf\u9a8c\uff0c\u63d0\u5347\u5934\u8854\uff1f</a></div>");a.push("</div>");Tinytip.render("userlike_info_tip",a.join(""),true,false,false,1,true,Balv.close_trans_tip)},show_expire_tip:function(e){$("#my_entrance_tcbox").css("position","relative").css("z-index","10");var b=new Array();b.push("<div style='width:240px;padding: 8px 0px 8px 8px;text-align:left;'>");b.push("<div style='width:240px;line-height:18px;color:#555555;'><span>"+e+"</span></div>");b.push("<div style='width:240px;line-height:22px;'><a href='/imall/mall?kw="+PageData.forum.name_url+"#!/tc/my/' style='padding-left:0px;' target='_blank'>\u7acb\u5373\u7eed\u8d39</a></div>");b.push("</div>");var c=b.join("");var d={content:c,arrow_dir:"up",bubble_css:{top:15,right:-5,width:252,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#my_entrance_tcbox"),closeBtn:true};var a=new UiBubbleTipBase(d);a.j_bubble.find(".j_content").css("padding","2px");a.showBubble();setTimeout(function(){a.closeBubble();$("#my_entrance_tcbox").css("position","static")},1000)},show_furank_tip:function(){if($.cookie("close_furank_tip")=="1"){return}$.cookie("close_furank_tip","0",{expires:14});var a=new Array();if(PageData.user.balv.has_liked){a.push("<div style='width:160px;padding:4px 0px 0px 0px;text-align:left;'>")}else{a.push("<div style='width:160px;padding:4px 0px 0px 8px;text-align:left;'>")}a.push("\u5427\u5185\u5f71\u54cd\u529b\u6392\u884c\u699c\u706b\u70ed\u5f00\u699c\uff01<br/>\u770b\u770b\u4f60\u5728\u5427\u91cc\u4ec0\u4e48\u6c34\u5e73~");a.push("</div>");Tinytip.render("entrance_rank",a.join(""),true,false,false,1,true,Balv.close_furank_tip,PageData.user.balv.has_liked)},close_furank_tip:function(){$.cookie("close_furank_tip","1",{expires:14})},close_trans_tip:function(){Balv._close_tip("trans")},show_lvup_tip:function(h,g){var b=new Array();b.push("<div class='lvup_tip_container'>");b.push("<div class='lvlup_con_msg'>\u5347\u7ea7\u5566!\u4f60\u5df2\u62e5\u6709\u672c\u5427"+h+"\u7ea7\u5934\u8854!</div>");b.push('<div class="lvlup_pop_rights">'+g+"</div>");if(g=="\u52a0\u6cb9~\u7ee7\u7eed\u6512\u7ecf\u9a8c\uff01"){b.push("<a style='float:left;' href='/f/like/level?kw="+PageData.forum.name_url+"' target='_blank'>\u67e5\u770b\u5347\u7ea7\u79d8\u7b08</a>")}else{var e='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvupguide&lv='+h+'")';b.push("<a href='#sub' style='float:left;' onclick='rich_postor.jumpToTry("+h+");"+e+"'>\u73b0\u5728\u53bb\u8bd5\u8bd5~~</a>")}var d='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=lvup_imallentrance")';b.push("<a target='_blank' onclick='"+d+"' style='float:left;margin-left:15px' href='/imall/mall?kw="+PageData.forum.name_url+"'>\u53bb\u767e\u5b9d\u7bb1\u770b\u770b</a>");b.push("</div>");var c=b.join("");var f={content:c,arrow_dir:"up",bubble_css:{top:4,right:-5,width:232,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#userlike_info_tip"),closeBtn:true};var a=new UiBubbleTipBase(f);a.j_bubble.find(".j_content").css("padding","2px").addClass("lvup_tip_table");a.showBubble();a.bind("onclose",function(){Balv.close_lvup_tip()},true);setTimeout(function(){a.closeBubble();Balv.close_lvup_tip()},8000)},show_liked_forum_tip:function(){},close_lvup_tip:function(){var a={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:2};$.tb.post(Balv.config.url.closetip,a,function(e){var b=false;try{var c=e}catch(d){b=true}if(b){return}if(c&&c.no==0){}else{}})},show_orange_tip:function(){if($.cookie("close_sign_tip_o")=="false"){return}$.cookie("close_sign_tip_o",true,{expires:14});$(".userlike_info").css("position","relative");var b={content:"\u8fde\u7eed\u7b7e\u523030\u5929ID\u5373\u53ef\u9ad8\u4eae\u5c55\u793a\uff0c\u4e00\u8d77\u95ea\u8000\u5427\uff01",arrow_dir:"down",bubble_css:{top:10,right:65,width:145,"z-index":9999},arrow_pos:{left:88},attr:" ",wrap:$(".userlike_info"),closeBtn:true};var a=new UiBubbleTipBase(b);a.j_bubble.find(".j_body").css("padding-right","3px");a.showBubble();a.bind("onclose",function(){$.cookie("close_sign_tip_o",false,{expires:14})},true);setTimeout(function(){$(".j_wrap .j_close").click()},8000)},_close_tip:function(a){var c={first:1,award:4,lvup:2,trans:3};var b={fid:PageData.forum.id,fname:PageData.forum.name_url,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:c[a]};$.tb.post(Balv.config.url.closetip,b,function(g){var d=false;try{var e=g}catch(f){d=true}if(d){return}if(e&&e.no==0){}else{}})},render_balv_tip_configs:function(a){return{content:a,arrow_dir:"up",bubble_css:{top:98,left:4,width:170,"z-index":100},arrow_pos:{left:88},attr:" ",wrap:$("#userlike_info"),closeBtn:true}},show_pic_tip:function(){if(!PageData.is_login){return}var a=(new Date()-new Date("2012/10/16"))/86400000;if(a>=21||a<=0){return}if($.cookie("pic_guide")=="1"){return}var c=PageData.forum.name_url||"test";var d={content:'<a href="/f/like/level?kw='+c+'&lv_t=lv_nav_who" onclick="$.stats.sendRequest(\'fr=tb0_forum&st_type=pic_guide&st_value=intip\')" target="_blank">\u53d1\u56fe\u7247\u8d34\u53ef\u83b7\u989d\u5916\u7ecf\u9a8c\u54e6\uff01</a>',arrow_dir:"up",bubble_css:{top:98,left:4,width:170,"z-index":100},arrow_pos:{left:88},attr:" ",wrap:$("#userlike_info"),closeBtn:true};var b=new UiBubbleTipBase(d);b.showBubble();b.bind("onclose",function(){$.cookie("pic_guide","1",{expires:14,path:"/"});$.stats.sendRequest("fr=tb0_forum&st_type=pic_guide&st_value=closetip")},true)}};var BalvInfo={render:function(a,b){window.open("/f/like/level?kw="+PageData.forum.name_url)}};;function UserTitle(){this.init()}UserTitle.prototype={constructor:UserTitle,init:function(){if(PageData.is_login){this.bindEvents()}},bindEvents:function(){$(".userlike_blacked").bind("mouseover",function(){Balv.show_black_tip()});$(".userlike_info_badge div:first").bind("click",function(a){window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro");return false});$(".userlike_info_expbar").bind("click",function(a){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvexpbar");window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_who");return false});$(".unlike_texture_badge").bind("click",function(a){window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro")});$(".j_meizhi_auth_link").bind("click",function(){_.Module.use("postor/widget/MeizhiPostor",[],function(){})});if(PageData.user.balv.has_liked){if($("ul.tl").css("display")=="none"){if(PageData.is_ipad){$("div.userlike_info_manager").show()}else{$(".balv_mod").hover(function(){$("div.userlike_info_manager").show()},function(){$("div.userlike_info_manager").hide()})}}else{if(PageData.is_ipad){$("a.p_balv_btnmanager").show()}else{$(".balv_mod").hover(function(){$("a.p_balv_btnmanager").show()},function(){$("a.p_balv_btnmanager").hide()})}}}},addBubble:function(){var c=$.cookie("meizhiBubble")=="1";var b=PageData.forum.theme=="bright"?28:16;if(!c){var a=new UiBubbleTipBase({content:"\u59b9\u7eb8\u8ba4\u8bc1\u706b\u70ed\u5f00\u653e\uff01",arrow_dir:"down",bubble_css:{top:b,left:-80,width:120,"z-index":200},arrow_pos:{left:100},wrap:$(".meizhi_auth_link_wrap"),closeBtn:true});a.bind("onclose",function(){$.cookie("meizhiBubble","1",{expires:365,path:"/"});a.hideBubble()});a.showBubble()}}};;_.Module.define({path:"ucenter/widget/tbSpam",requires:[],sub:{initial:function(){$("body").append($("#tb_spam_notice_html").html())}}});_.Module.define({path:"comforum/widget/LecaiLottery/LotteryHelper",sub:{initial:function(){},permute:function(d,a){var b=1;for(var c=0;c<a;c++){b*=(d-c)}return parseInt(b,10)},combine:function(d,a){var b=this;var c=b.permute(d,a);c/=b.permute(a,a);return parseInt(c,10)},fullCombination:function(j,b){var d=[];var g=j.length;var e=[];for(var c=0;c<=b;c++){e.push(c-1)}var h=b;var f=true;while(e[0]==-1){if(f){var a=[];for(var c=1;c<=b;c++){a.push(j[e[c]])}d.push(a);f=false}e[h]++;if(e[h]==g){e[h]=0;h--;continue}if(h<b){h++;e[h]=e[h-1];continue}if(h==b){f=true}}return d},fullCombinationDantuo:function(f,a,j){var k=this;var d=0;if(a){d=a.length}var c=j.length;if(d+c<f){return false}var b=f-d;var h=k.fullCombination(j,b);for(var e=0,g=h.length;e<g;e++){h[e]=h[e].concat(a)}return h},countCombinationDantuo:function(d,b,c){var a=this;b=(typeof(b)=="undefined")?0:b;var e=d-b;return a.combine(c,e)},arrayFullCombination:function(b){var a=this;var e=function(h,f){var n=h;var m=[];while(f.length>0){for(var l=0;l<n.length;l++){var g=[f[0]];for(var j=0;j<n[l].length;j++){g.push(n[l][j])}m.push(g)}f=f.slice(1,f.length)}return m};var d=a.fullCombination(b[0],1);for(var c=1;c<b.length;c++){d=e(d,b[c])}return d},arrayIsNoRepeat:function(a){var b=0,c={};for(;b<a.length;b++){if(c[a[b]]!==undefined){return false}c[a[b]]=true}return true},arrayIsHasNoRepeat:function(e){var h=this;var j=e.length;var b=[];var f=[];var g=[];var k=[];var a=1;for(var d=0;d<j;d++){b[d]=e[d].length;a=a*b[d];f[d]=0}for(var d=0;d<a;d++){g[d]=[]}var c=0;while(true){for(var d=0;d<j;d++){g[c][d]=(f[d]+1);k[d]=e[d][g[c][d]-1]}if(h.arrayIsNoRepeat(k)){return true}c++;for(var d=j-1;d>=0;d--){if(f[d]==b[d]-1){f[d]=0}else{break}}if(d<0){break}f[d]++}return false}}});;_.Module.define({path:"comforum/widget/LecaiLottery/LotteryDialog",requires:["comforum/widget/LecaiLottery/LotteryHelper"],sub:{_container:null,_lotteryData:{},_lotteryInfo:{},_singleCache:[],_betsCache:[],_gateCache:[],_danCache:[],_singleTpl:['<tr class="j_single_#{match_num}">','<td class="lottery_table_game"><div>#{race}</div></td>','<td class="lottery_table_time">#{race_start_time_short}</td>','<td class="lottery_table_team">#{home}</td>','<td class="lottery_table_team">#{away}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_3 j_sp" data-match="#{match_num}" data-rel="3" data-sp="#{scale_home}" data-type="single" data-log="sp_single_#{index}_3">#{scale_home}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_1 j_sp" data-match="#{match_num}"  data-rel="1" data-sp="#{scale_equal}" data-type="single" data-log="sp_single_#{index}_1">#{scale_equal}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_0 j_sp" data-match="#{match_num}" data-rel="0" data-sp="#{scale_away}" data-type="single" data-log="sp_single_#{index}_0">#{scale_away}</td>',"</tr>"].join(""),_betsTpl:['<tr class="j_bets_#{match_num}">','<td class="lottery_table_game"><div>#{race}</div></td>','<td class="lottery_table_time">#{race_start_time_short}</td>','<td class="lottery_table_team">#{home}</td>','<td class="lottery_table_team">#{away}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_3 j_sp" data-match="#{match_num}" data-rel="3" data-sp="#{scale_home}" data-type="bets" data-log="sp_bets_#{index}_3">#{scale_home}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_1 j_sp" data-rel="1" data-match="#{match_num}" data-sp="#{scale_equal}" data-type="bets" data-log="sp_bets_#{index}_1">#{scale_equal}</td>','<td class="lottery_table_sp lottery_icon_spbg sp_#{match_num}_0 j_sp" data-rel="0" data-match="#{match_num}" data-sp="#{scale_away}" data-type="bets" data-log="sp_bets_#{index}_0">#{scale_away}</td>',"</tr>"].join(""),_singleBubble:null,_betsBubble:null,_forumId:0,_page:null,_theme:0,initial:function(a){var b;this._theme=a.theme;this._lotteryData=a.lotteryData;this._formatLotteryInfo(a.lotteryData);this._render(a.defaultTab,b,a.selectedData||[]);this._forumId=a.forumId;this._page=a.page;this._stats(a.PageData)},_formatLotteryInfo:function(){var b=this,d=function(h){return h<10?"0"+h:h},e,g={0:"\u5468\u65e5",1:"\u5468\u4e00",2:"\u5468\u4e8c",3:"\u5468\u4e09",4:"\u5468\u56db",5:"\u5468\u4e94",6:"\u5468\u516d"};for(var f in b._lotteryData){b._lotteryInfo[f]={};for(var c=0,a=b._lotteryData[f].length;c<a;c++){b._lotteryInfo[f][b._lotteryData[f][c]["match_num"]]={3:b._lotteryData[f][c]["scale_home"],1:b._lotteryData[f][c]["scale_equal"],0:b._lotteryData[f][c]["scale_away"]};e=new Date(parseInt(b._lotteryData[f][c].race_start_time)*1000);b._lotteryData[f][c].race_start_time_short=g[e.getDay()]+" "+d(e.getHours())+":"+d(e.getMinutes())}}},_render:function(c,d,e){var a=this,f=['<div id="lottery_dialog" class="lottery_dialog lottery_dialog_'+a._theme+'">','<div class="lottery_dialog_head">',"<span>\u8db3\u5f69\u63a8\u8350</span>","<ul>",'<li><a class="lottery_tab_bets j_tab_bets" href="javascript:;" data-log="tab_ggtz">\u8fc7\u5173\u6295\u6ce8</a></li>','<li><a class="lottery_tab_single j_tab_single lottery_icon_dialog_tab" href="javascript:;" data-log="tab_dgtz">\u5355\u5173\u6295\u6ce8</a></li>',"</ul>",'<a class="lottery_icon_dialog_close j_dialog_close" href="javascript:;" title="\u5173\u95ed"></a>',"</div>",'<div class="lottery_dialog_body clearfix j_dialog_body">',"</div>",'<p class="lottery_dialog_footer_tip">\u8d34\u5427\u5f69\u7968\u7531\u4e50\u5f69\u7f51\u63d0\u4f9b\u6280\u672f\u652f\u6301\uff0c\u56fd\u5bb6\u6b63\u89c4\u53d1\u884c\uff0c\u8bf7\u653e\u5fc3\u8d2d\u4e70\u3002\u5f69\u7968\u6709\u98ce\u9669\uff0c\u6295\u6ce8\u9700\u8c28\u614e\uff0c\u4e0d\u5411\u672a\u6ee118\u5468\u5c81\u8005\u51fa\u552e\u5f69\u7968\uff01</p>',"</div>"].join(""),b=new $.dialog({html:f,holderClassName:"lottery_dialog_holder",showTitle:false,draggable:false,closeable:false,width:750,height:390});a._container=$("#lottery_dialog");a._bindDialogEvents(b);a._container.find(".j_tab_"+c).trigger("click");a._renderSelected(c,e)},_renderSigle:function(e,g){var b=this,c="",f="";for(var d=0,a=e.length;d<a;d++){e[d].index=d;c+=$.tb.format(b._singleTpl,e[d])}f=['<div class="lottery_single">','<div class="lottery_table_wrap">','<table class="lottery_table" border="0" cellspacing="0">',"<thead>","<tr>",'<th class="lottery_table_game">\u8d5b\u4e8b</th>',"<th>\u5f00\u8d5b\u65f6\u95f4</th>","<th>\u4e3b\u961f</th>","<th>\u5ba2\u961f</th>",'<th class="lottery_table_sp">\u4e3b\u961f\u80dc</th>','<th class="lottery_table_sp">\u5e73\u5c40</th>','<th class="lottery_table_sp">\u5ba2\u961f\u80dc</th>',"</tr>","</thead>",'<tbody class="j_single_tbody">',c,"</tbody>","</table>","</div>",'<div class="lottery_bottom_left">','<div class="lottery_gates_wrap"><span class="lottery_gates_title">\u8fc7\u5173\u65b9\u5f0f\uff1a</span>','<input type="radio" id="lottery_gate_0" checked /><label for="lottery_gate_0">\u5355\u5173</label>',"</div>",'<div class="lottery_bets_wrap"><span class="lottery_bets_title">\u8fc7\u5173\u500d\u6570\uff1a</span>','<input type="text" class="lottery_bets_ipt ui_textfield j_single_mutiple" data-type="single" value="1" maxlength="5" />\u500d','<div class="lottery_awards">\u7406\u8bba\u5956\u91d1<span class="lottery_awards_num j_single_award">0</span>\u5143</div>',"</div>","</div>",'<div class="lottery_bottom_right">','<div class="clearfix"><a class="lottery_icon_change j_refresh" data-type="single" href="javascript:;" data-log="refresh_single"><i class="lottery_icon_refresh"></i>\u6362\u4e00\u6362</a></div>','<div class="lottery_money clearfix">','<div class="lottery_bubble_pay j_bubble_single_pay"></div>','<a class="lottery_icon_bet disable j_single_pay" data-type="single" href="javascript:;" data-log="pay_single"></a>','<div class="fr">\u6295\u6ce8\u91d1\u989d\uff1a<span class="j_single_money">0</span>\u5143</div>',"</div>","</div>","</div>"].join("");b._container.find(".j_dialog_body").append(f);b._singleBubble=b._showBubble({wrap:$(".j_bubble_single_pay"),content:"\u81f3\u5c11\u9009\u62e9\u4e00\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8",width:144});b._singleBubble.j_bubble.show()},_renderBets:function(d,g){var c=this,b="",f="";for(var e=0,a=d.length;e<a;e++){d[e].index=e;b+=$.tb.format(c._betsTpl,d[e])}f=['<div class="lottery_bets">','<div class="lottery_table_wrap">','<table class="lottery_table" border="0" cellspacing="0">',"<thead>","<tr>",'<th class="lottery_table_game">\u8d5b\u4e8b</th>',"<th>\u5f00\u8d5b\u65f6\u95f4</th>","<th>\u4e3b\u961f</th>","<th>\u5ba2\u961f</th>",'<th class="lottery_table_sp">\u4e3b\u961f\u80dc</th>','<th class="lottery_table_sp">\u5e73\u5c40</th>','<th class="lottery_table_sp">\u5ba2\u961f\u80dc</th>',"</tr>","</thead>",'<tbody class="j_bets_tbody">',b,"</tbody>","</table>","</div>",'<div class="lottery_bottom_left">','<div class="lottery_gates_wrap"><span class="lottery_gates_title">\u8fc7\u5173\u65b9\u5f0f\uff1a</span>','<div class="lottery_gate j_gate_wrap j_gate_2 hidden"><input type="checkbox" id="lottery_gate_2" class="j_gate" data-val="2" data-log="gate_2" /><label for="lottery_gate_2">2\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_3 hidden"><input type="checkbox" id="lottery_gate_3" class="j_gate" data-val="3" data-log="gate_3" /><label for="lottery_gate_3">3\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_4 hidden"><input type="checkbox" id="lottery_gate_4" class="j_gate" data-val="4" data-log="gate_4" /><label for="lottery_gate_4">4\u4e321</label></div>','<div class="lottery_gate j_gate_wrap j_gate_5 hidden"><input type="checkbox" id="lottery_gate_5" class="j_gate" data-val="5" data-log="gate_5" /><label for="lottery_gate_5">5\u4e321</label></div>','<span class="lottery_gate_tip">\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8</span>',"</div>",'<div class="lottery_bets_wrap"><span class="lottery_bets_title">\u8fc7\u5173\u500d\u6570\uff1a</span>','<input type="text" class="lottery_bets_ipt ui_textfield j_bets_mutiple" data-type="mutiple" value="1" maxlength="5"/>\u500d','<div class="lottery_awards">\u7406\u8bba\u5956\u91d1<span class="lottery_awards_num j_bets_award">0</span>\u5143</div>',"</div>","</div>",'<div class="lottery_bottom_right">','<div class="clearfix"><a class="lottery_icon_change j_refresh" data-type="bets" href="javascript:;" data-log="refresh_bets"><i class="lottery_icon_refresh"></i>\u6362\u4e00\u6362</a></div>','<div class="lottery_money clearfix">','<div class="lottery_bubble_pay j_bubble_bets_pay"></div>','<a class="lottery_icon_bet disable j_bets_pay" data-type="bets" href="javascript:;" data-log="pay_bets"></a>','<div class="fr">\u6295\u6ce8\u91d1\u989d\uff1a<span class="j_bets_money">0</span>\u5143</div>',"</div>","</div>","</div>"].join("");c._container.find(".j_dialog_body").append(f);c._betsBubble=c._showBubble({wrap:$(".j_bubble_bets_pay"),content:"\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8",width:144});c._betsBubble.j_bubble.show()},_renderSelected:function(b,c){var a=this;$.each(c,function(d,f){var e=f.split("_");a._container.find(".sp_"+e[0]+"_"+e[1]).trigger("click")});if(b=="bets"&&c.length>1){a._container.find("#lottery_gate_2").trigger("click").trigger("change")}},_renderDan:function(){var a=this,b=0;for(var c in a._betsCache){b++}if(b!=1&&a._danCache.length+1==b){return}a._container.find(".j_dan").addClass("disable");for(var c in a._betsCache){a._container.find(".j_dan_"+c).removeClass("disable")}if(b==1){a._container.find(".j_dan.selected").trigger("click");return}},_renderGate:function(){var a=this,f=a._danCache.length,b=0,e=f>0?f+1:2,c=[];for(var d in a._betsCache){b++}if(b>=2){a._container.find(".lottery_gate_tip").hide()}else{a._container.find(".lottery_gate_tip").show()}a._container.find(".j_gate_wrap").addClass("hidden").find("input").tbattr("checked",false);for(;e<=b;e++){if($.inArray(e,a._gateCache)!=-1){c.push(e);a._container.find(".j_gate_"+e).find(".j_gate").tbattr("checked",true)}a._container.find(".j_gate_"+e).removeClass("hidden")}a._gateCache=c},_bindDialogEvents:function(b){var a=this;a._container.find(".j_dialog_close").on("click",function(){b.close()});a._container.find(".j_tab_bets").on("click",function(){a._container.find(".j_tab_single").removeClass("lottery_icon_dialog_tab");$(this).addClass("lottery_icon_dialog_tab");if(!$(this).data("load")){var c=a._lotteryData.bets.slice(0,5);a._renderBets(c);$(this).data("load",true)}else{$(".lottery_bets").show()}$(".lottery_single").hide();if(a._lotteryData.bets.length<=5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}});a._container.find(".j_tab_single").on("click",function(){a._container.find(".lottery_icon_dialog_tab").removeClass("lottery_icon_dialog_tab");$(this).addClass("lottery_icon_dialog_tab");if(!$(this).data("load")){var c=a._lotteryData.single.slice(0,5);a._renderSigle(c);$(this).data("load",true)}else{$(".lottery_single").show()}$(".lottery_bets").hide();if(a._lotteryData.single.length<=5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}});a._container.find(".j_dialog_body").on("click",".j_sp",function(){var f=$(this).data("match"),c=$(this).data("sp"),h=$(this).data("type"),n=$(this).data("rel"),k=h=="single"?a._singleCache:a._betsCache,l=0;$(this).toggleClass("selected");if($(this).hasClass("selected")){if(k[f]){k[f].push(n)}else{k[f]=[n]}if(h=="single"){a._singleBubble&&a._singleBubble.j_bubble.hide()}k[f].sort(function(o,i){return i-o})}else{if(k[f]){var d=[];for(var e=0,g=k[f].length;e<g;e++){if(k[f][e]!=n){d.push(parseInt(k[f][e]))}}if(d.length==0){delete k[f];a._danCache=[];$(".j_dan").removeClass("selected")}else{k[f]=d}}}if(h=="bets"){a._renderDan();a._renderGate()}for(var m in k){l++}if(l==5){a._container.find(".j_refresh").addClass("lottery_icon_change_disable")}else{if(a._lotteryData[h].length>5){a._container.find(".j_refresh").removeClass("lottery_icon_change_disable")}}if(h=="single"&&l==0){a._singleBubble&&a._singleBubble.j_bubble.show()}if(h=="bets"&&l<2&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e24\u573a\u6bd4\u8d5b\u8fdb\u884c\u6295\u6ce8");a._betsBubble.j_bubble.show()}else{if(h=="bets"&&a._gateCache.length>0&&a._betsBubble){a._betsBubble.j_bubble.hide()}else{if(h=="bets"&&a._gateCache.length==0&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u8fc7\u5173\u65b9\u5f0f");a._betsBubble.j_bubble.show()}}}a._updateMoney(h)});a._container.find(".j_dialog_body").on("change",".j_gate",function(){var c=$(this).data("val"),d;if($(this).tbattr("checked")){a._gateCache.push(c);a._betsBubble&&a._betsBubble.j_bubble.hide()}else{d=$.inArray(c,a._gateCache);a._gateCache.splice(d,1);if(a._gateCache.length==0&&a._betsBubble){a._betsBubble.j_bubble.find(".lottery_bubble_content").html("\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\u8fc7\u5173\u65b9\u5f0f");a._betsBubble.j_bubble.show()}}$.unique(a._gateCache);a._updateMoney("bets")});a._container.find(".j_dialog_body").on("click",".j_dan",function(){var d,c=0;d=$(this).data("match");if($(this).hasClass("disable")){return}for(var e in a._betsCache){c++}$(this).toggleClass("selected");if($(this).hasClass("selected")){a._danCache.push(d)}else{a._danCache.splice($.inArray(d,a._danCache),1);for(var e in a._betsCache){$(".j_dan_"+e).removeClass("disable")}}if(a._danCache.length+1==c){a._container.find(".j_dan").each(function(f,g){if(!$(g).hasClass("selected")){$(g).addClass("disable");return}})}a._renderGate();a._updateMoney("bets")});a._container.find(".j_dialog_body").on("keydown",".j_single_mutiple, .j_bets_mutiple",function(c){return a._numberKeyOnly(c)}).on("change",".j_single_mutiple, .j_bets_mutiple",function(){var d=$(this).data("type"),c=$(this).val();if(!c){$(this).val(1)}a._updateMoney(d)}).on("keyup",".j_single_mutiple, .j_bets_mutiple",function(){var d=$(this).data("type"),c=$(this).val();if(c){c=c.replace(/\D/g,"")}$(this).val(c);a._updateMoney(d)});a._container.find(".j_dialog_body").on("click",".j_single_pay, .j_bets_pay",function(){var c;if($(this).hasClass("disable")){return}c=$(this).data("type");switch(c){case"single":window.open(a._buildSingleUrl());break;case"bets":window.open(a._buildBetsUrl());break}setTimeout(function(){a._container.find(".j_dialog_close").trigger("click")},500)});a._container.find(".j_dialog_body").on("click",".j_refresh",function(){var k,e="",g=0,c,f=[],l=[];if($(this).hasClass("lottery_icon_change_disable")){return}k=$(this).data("type");for(var d=0,h=a._lotteryData[k].length;d<h;d++){if(typeof a["_"+k+"Cache"][a._lotteryData[k][d]["match_num"]]=="undefined"){l.push(a._lotteryData[k][d])}}for(var m in a["_"+k+"Cache"]){f.push(m);e+=$("<div>").append($(".j_"+k+"_"+m).clone()).html();g++}for(;g<5;g++){c=Math.round(Math.random()*(l.length-1)+1);if(typeof l[c]!="undefined"&&$.inArray(l[c]["match_num"],f)<0){f.push(l[c]["match_num"]);e+=$.tb.format(a["_"+k+"Tpl"],l[c])}else{g=g-1}}a._container.find(".j_"+k+"_tbody").html(e)})},_buildSingleUrl:function(){var b=this,d="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85",a=parseInt(b._container.find(".j_single_mutiple").val(),10),e="8501:8502%";for(var c in b._singleCache){e+=c+"(";e+=b._singleCache[c].join(";");e+="),"}e=e.slice(0,-1);return d+"&content="+encodeURIComponent(e)+"&multiple="+a},_buildBetsUrl:function(){var c=this,e="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85",b=parseInt(c._container.find(".j_bets_mutiple").val(),10),g="8500:";for(var f=0,a=c._gateCache.length;f<a;f++){switch(c._gateCache[f]){case 2:g+="8503,";break;case 3:g+="8504,";break;case 4:g+="8505,";break;case 5:g+="8506,";break}}g=g.slice(0,-1);g+="%";if(c._danCache.length>0){for(var f=0,a=c._danCache.length;f<a;f++){g+=c._danCache[f]+"(";g+=c._betsCache[c._danCache[f]].join(";");g+="),"}g=g.slice(0,-1);g+="#"}for(var d in c._betsCache){if($.inArray(parseInt(d),c._danCache)==-1){g+=d+"(";g+=c._betsCache[d].join(";");g+="),"}}g=g.slice(0,-1);return e+"&content="+encodeURIComponent(g)+"&multiple="+b},_updateMoney:function(g){var s=this,J,q,H,L=0,e=0,d=this.use("comforum/widget/LecaiLottery/LotteryHelper");if(g=="single"){J=s._container.find(".j_single_award");q=s._container.find(".j_single_money");H=s._container.find(".j_single_mutiple");for(var G in s._singleCache){var A=0;L+=s._singleCache[G].length;$.each(s._singleCache[G],function(k,m){var i=s._lotteryInfo.single[G][m];A=A>i?A:i});e+=A}if(L>0&&parseInt(H.val()||0,10)){s._container.find(".j_single_pay").removeClass("disable")}else{s._container.find(".j_single_pay").addClass("disable")}q.text(L*2*parseInt(H.val()||0,10));J.text((e*parseInt(H.val()||0,10)).toFixed(2))}else{J=s._container.find(".j_bets_award");q=s._container.find(".j_bets_money");H=s._container.find(".j_bets_mutiple");e=1;var o=[],D=s._danCache;for(var v in s._betsCache){o.push(v)}if(s._danCache.length>0){for(var B=0,w=s._danCache.length;B<w;B++){o=$.grep(o,function(i,k){return i!=s._danCache[B]})}}if(s._gateCache.length!=0){for(var B=0,C=s._gateCache.length;B<C;B++){var p=s._gateCache[B];var h=d.fullCombinationDantuo(p,s._danCache,o);L+=s._countCombinedArr(h)}if(L>0&&parseInt(H.val()||0,10)){s._container.find(".j_bets_pay").removeClass("disable")}else{s._container.find(".j_bets_pay").addClass("disable")}q.text(L*2*parseInt(H.val()||0,10))}else{J.text(0);q.text(0);s._container.find(".j_bets_pay").addClass("disable");return}var f=[],E=[],I=0;if(D.length>0){for(var y=0,F=D.length;y<F;y++){var v=D[y],z={max:0};for(var B=0,w=s._betsCache[v].length;B<w;B++){var r=0;r=s._lotteryInfo.bets[v][s._betsCache[v][B]];z.max=(z.max==0)?r:(z.max<r?r:z.max)}f.push(z.max)}f.sort(function(k,i){return i-k})}if(o.length>0){for(var y=0,F=o.length;y<F;y++){var v=o[y],z={max:0};for(var B=0,w=s._betsCache[v].length;B<w;B++){var r=0;r=s._lotteryInfo.bets[v][s._betsCache[v][B]];z.max=(z.max==0)?r:(z.max<r?r:z.max)}E.push(z.max)}E.sort(function(k,i){return i-k})}for(var B=D.length+o.length,t=s._gateCache[s._gateCache.length-1];B>=t;B--){var b=0;for(var x=0,K=s._gateCache.length;x<K;x++){var e=d.combine(B-D.length,s._gateCache[x]-D.length),A=0;if(e>0){var a=d.fullCombinationDantuo(s._gateCache[x],f,E.slice(0,B-D.length));for(var v=0;v<a.length;v++){var c=a[v],l=1;for(var u=0;u<c.length;u++){l*=c[u]}l=(Math.round(l*2*100)/100)*parseInt(H.val()||0,10);A+=l}b+=A}}I=I<b?b:I}J.text(I.toFixed(2))}},_countN_1:function(b){var c=this,f=1;for(var e=0,a=b.length;e<a;e++){var d=0;for(j=0,jlen=c._betsCache[b[e]].length;j<jlen;j++){if(typeof c._betsCache[b[e]][j]!="undefined"){d++}}f*=d}return f},_countCombinedArr:function(b){var c=this;var e=0;for(var d=0,a=b.length;d<a;d++){e+=c._countN_1(b[d])}return e},_numberKeyOnly:function(a){var b=a.which,c=false;if(a.shiftKey){if(b==9){c=true}c=false}if((b<=57&&b>=48)||b==37||b==39||b==8||b==9||b==46||(b<=105&&b>=96)||b==229){c=true}return c},_showBubble:function(b){var c={content:'<div class="lottery_bubble_content">'+b.content+"</div>",arrow_dir:"down",bubble_css:{top:-20,right:10,width:b.width||150},arrow_pos:{right:0},attr:" id='tb_message_tip_n' ",wrap:b.wrap,closeBtn:false,level:1,arrowReq:true};var a=new UiBubbleTipBase(c);return a},_stats:function(b){var a=this;this._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lottery_dialog&st_fid="+a._forumId+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c+"&st_theme="+a._theme);$.stats.track(c,"lecai_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/widget/LecaiLottery",requires:["comforum/widget/LecaiLottery/LotteryDialog"],sub:{_status:null,_singleLottery:null,_betsLottery:null,_selectedData:[],_container:$("#lecai_lottery"),_forumId:0,_page:null,_theme:0,initial:function(a,e,b,g,c,d,f){this._status=a;this._forumId=c.forum.id;this._page=d;this._theme=f;this._singleLottery=$.parseJSON(e);this._betsLottery=$.parseJSON(b);this._bindEvents(c);if(this._status==1){this._countTime();if(g){this._container.find(".lottery_icon_btn_3").trigger("click")}else{this._container.find(".lottery_icon_btn_0").trigger("click")}}if(PageUnit.load("lecai_lottery_show_guide")){this._renderGuide()}this._stats(c)},_bindEvents:function(b){var a=this;a._container.find(".j_lottery_order").on("click",function(){if($(this).hasClass("disable")){return}var d=$(this).data("type");var e={lotteryData:{single:a._singleLottery,bets:a._betsLottery},defaultTab:d,selectedData:a._selectedData,forumId:a._forumId,PageData:b,page:a._page,theme:a._theme},c=a.use("comforum/widget/LecaiLottery/LotteryDialog",e)});a._container.find(".j_lottery_select").on("click",function(){var e=$(this).data("rel"),d=$(this).data("match"),c;$(this).toggleClass("select");if($(this).hasClass("select")){a._selectedData.push(d+"_"+e)}else{c=$.inArray(d+"_"+e,a._selectedData);a._selectedData.splice(c,1)}})},_countTime:function(){var a=this,d=parseInt(a._container.find(".j_lottery_deadline").data("diff")),c=function(e){return e<10?"0"+e:e},b=setInterval(function(){var e,f;if(d<=0){a._container.find(".j_lottery_order").addClass("disable");a._container.find(".j_lottery_deadline").parent("p").text("\u672c\u573a\u6bd4\u8d5b\u6295\u6ce8\u5df2\u622a\u6b62");clearInterval(b);return}d-=1;e=new Date(d*1000);f=c(Math.floor(d/3600))+":"+c(e.getUTCMinutes())+":"+c(e.getUTCSeconds());a._container.find(".j_lottery_deadline").text(f)},1000)},_renderGuide:function(){var a=this;if(!$.cookie("lottery_guide")&&a._status!=5){var b=['<div class="lottery_guide_wrap">','<div class="lottery_guide">','<span class="lottery_guide_close j_guide_close"></span>',PageUnit.load("lecai_lottery_guide_link"),"</div>","</div>"].join("");a._container.append(b);a._container.find(".j_guide_close").on("click",function(){a._container.find(".lottery_guide").remove()});$.cookie("lottery_guide",1,{expires:30})}},_stats:function(b){var a=this;this._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lecai_aside&st_fid="+b.forum.id+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c);$.stats.track(c,"lecai_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/component/LotteryHelper",sub:{initial:function(){},permute:function(d,a){var b=1;for(var c=0;c<a;c++){b*=(d-c)}return parseInt(b,10)},combine:function(d,a){var b=this;var c=b.permute(d,a);c/=b.permute(a,a);return parseInt(c,10)},fullCombination:function(j,b){var d=[];var g=j.length;var e=[];for(var c=0;c<=b;c++){e.push(c-1)}var h=b;var f=true;while(e[0]==-1){if(f){var a=[];for(var c=1;c<=b;c++){a.push(j[e[c]])}d.push(a);f=false}e[h]++;if(e[h]==g){e[h]=0;h--;continue}if(h<b){h++;e[h]=e[h-1];continue}if(h==b){f=true}}return d},fullCombinationDantuo:function(f,a,j){var k=this;var d=0;if(a){d=a.length}var c=j.length;if(d+c<f){return false}var b=f-d;var h=k.fullCombination(j,b);for(var e=0,g=h.length;e<g;e++){h[e]=h[e].concat(a)}return h},countCombinationDantuo:function(d,b,c){var a=this;b=(typeof(b)=="undefined")?0:b;var e=d-b;return a.combine(c,e)},arrayFullCombination:function(b){var a=this;var e=function(h,f){var n=h;var m=[];while(f.length>0){for(var l=0;l<n.length;l++){var g=[f[0]];for(var j=0;j<n[l].length;j++){g.push(n[l][j])}m.push(g)}f=f.slice(1,f.length)}return m};var d=a.fullCombination(b[0],1);for(var c=1;c<b.length;c++){d=e(d,b[c])}return d},arrayIsNoRepeat:function(a){var b=0,c={};for(;b<a.length;b++){if(c[a[b]]!==undefined){return false}c[a[b]]=true}return true},arrayIsHasNoRepeat:function(e){var h=this;var j=e.length;var b=[];var f=[];var g=[];var k=[];var a=1;for(var d=0;d<j;d++){b[d]=e[d].length;a=a*b[d];f[d]=0}for(var d=0;d<a;d++){g[d]=[]}var c=0;while(true){for(var d=0;d<j;d++){g[c][d]=(f[d]+1);k[d]=e[d][g[c][d]-1]}if(h.arrayIsNoRepeat(k)){return true}c++;for(var d=j-1;d>=0;d--){if(f[d]==b[d]-1){f[d]=0}else{break}}if(d<0){break}f[d]++}return false},generateRandom:function(f,a,d){if(d>a-f){return[]}var e=[];var b=0;while(b<d){var c=Math.round(Math.random()*(a-1)+f);if($.inArray(c,e)===-1){e.push(c);b++}}return e},numberKeyOnly:function(a){var b=a.which,c=false;if(a.shiftKey){if(b==9){c=true}c=false}if((b<=57&&b>=48)||b==37||b==39||b==8||b==9||b==46||(b<=105&&b>=96)||b==229){c=true}return c}}});_.Module.define({path:"comforum/widget/LuckyLottery/LuckyLotteryTab",sub:{_tabCount:0,_$tabs:null,initial:function(b,a){this._tabCount=b.length;this._$tabs=b;typeof a!="undefined"&&this._tabSelect(a);this._bindEvents()},_tabSelect:function(b){for(var c=0,a=this._$tabs.length;c<a;c++){if(c===b){if(this._$tabs[b].hasClass("lucky_open")){this._$tabs[b].children("dd").slideUp();this._$tabs[b].removeClass("lucky_open").addClass("lucky_close")}else{this._$tabs[b].children("dd").slideDown();this._$tabs[b].removeClass("lucky_close").addClass("lucky_open")}}else{this._$tabs[c].children("dd").slideUp();this._$tabs[c].removeClass("lucky_open").addClass("lucky_close")}}},_bindEvents:function(){var b=this;for(var c=0,a=b._tabCount;c<a;c++){b._$tabs[c].children("dt").on("click",(function(d){return function(){b._tabSelect(d)}})(c))}}}});;_.Module.define({path:"comforum/widget/LuckyLottery",requires:["comforum/widget/LuckyLottery/LuckyLotteryTab","comforum/component/LotteryHelper"],sub:{_container:null,_page:null,_11ydj:[],_xk3_1:[],_xk3_2:[],_xssc:{hundred:[],ten:[],digit:[]},_bubbles:{shiyiydj:null,xk3_1:null,xk3_2:null,xssc:null},_lotteryHelper:null,initial:function(c,b,a){this._container=$("#lucky_lottery");this.use("comforum/widget/LuckyLottery/LuckyLotteryTab",[this._container.find(".j_lucky_tab1"),this._container.find(".j_lucky_tab2"),this._container.find(".j_lucky_tab3")]);this._page=b;this._lotteryHelper=this.use("comforum/component/LotteryHelper");this._countTime(c);this._bubbles();this._bindEvents();this._stats(a);this._container.find(".j_11ydj_jx").trigger("click");this._container.find(".j_xks2_jx").trigger("click");this._container.find(".j_xssc_jx").trigger("click")},_countTime:function(e){var a=this;var c=[a._container.find(".j_11ydj_time"),a._container.find(".j_xks_time"),a._container.find(".j_xssc_time")];var d=function(g){return g<10?"0"+g:g};var f=function(h){if(h<0){return"00\u520600\u79d2"}var g=new Date(h);var i=d(g.getUTCMinutes())+"\u5206"+d(g.getUTCSeconds())+"\u79d2";return i};var b=setInterval(function(){var j=[];for(var h=0,g=c.length;h<g;h++){var k=e[h]*1000-new Date().getTime();k<0&&j.push(h);c[h].text(f(k))}j.length===g&&clearInterval(b)},1000)},_bindEvents:function(){var a=this;a._container.on("click",".j_11ydj_num",function(){var c=parseInt($(this).data("num"),10);if($(this).hasClass("select")){$(this).removeClass("select");var b=$.inArray(c,a._11ydj);a._11ydj.splice(b,1)}else{$(this).addClass("select");a._11ydj.push(c)}a._update11ydjMoney()});a._container.on("click",".j_11ydj_jx",function(){var c=a._lotteryHelper.generateRandom(1,11,5);a._container.find(".j_11ydj_num.select").removeClass("select");a._11ydj.length=0;for(var d=0,b=c.length;d<b;d++){a._container.find(".j_11ydj_num"+c[d]).trigger("click")}});a._container.on("click",".j_11ydj_tz",function(){if($(this).hasClass("disable")){a._bubbles.shiyiydj.showBubble();return}window.open(a._build11ydjUrl())});a._container.on("keydown",".j_mutiple_11ydj, .j_mutiple_xks1, .j_mutiple_xks2, .j_mutiple_xssc",a._lotteryHelper.numberKeyOnly).on("change",".j_mutiple_11ydj, .j_mutiple_xks2, .j_mutiple_xssc",function(){var b=$(this).val();if(!b){$(this).val(1);$(this).trigger("keyup")}}).on("keyup",".j_mutiple_11ydj, .j_mutiple_xks1, .j_mutiple_xks2, .j_mutiple_xssc",function(){var b=$(this).val();if(b){b=b.replace(/\D/g,"")}$(this).val(b)});a._container.on("keyup",".j_mutiple_11ydj",function(){a._update11ydjMoney()});a._container.on("keyup",".j_mutiple_xks1",function(){a._updateXks1Money()});a._container.on("keyup",".j_mutiple_xks2",function(){a._updateXks2Money()});a._container.on("keyup",".j_mutiple_xssc",function(){a._updateXsscMoney()});a._container.on("click",".j_lucky_count",function(){var d=this;var c=a._lotteryHelper.generateRandom(1,6,1);var e=a._container.find(".j_xks1_rst");var b=setInterval(function(){var f=a._lotteryHelper.generateRandom(1,18,1);e.text(f)},80);$(d).addClass("lucky_icon_dice");setTimeout(function(){var g=$(d).data("count");$(d).data("count",c).removeClass("lucky_icon_dice").removeClass("lucky_icon_count"+g).addClass("lucky_icon_count"+c);clearInterval(b);var f=0;a._container.find(".j_lucky_count").each(function(){f+=parseInt($(this).data("count"),10)});e.text(f)},1000)});a._container.on("click",".j_xks1_jx",function(){a._container.find(".j_lucky_count").trigger("click")});a._container.on("click",".j_xks1_tz",function(){if($(this).hasClass("disable")){a._bubbles.xk3_1.showBubble();return}window.open(a._buildXks1Url())});a._container.on("click",".j_xks_num",function(){var b=$(this).data("num");if($(this).hasClass("rect_select")){a._xk3_2.splice($.inArray(b,a._xk3_2),1);$(this).removeClass("rect_select")}else{a._xk3_2.push(b);$(this).addClass("rect_select")}a._updateXks2Money()});a._container.on("click",".j_xks2_jx",function(){var c=a._lotteryHelper.generateRandom(1,6,3);a._container.find(".j_xks_num.rect_select").removeClass("rect_select");a._xk3_2.length=0;for(var d=0,b=c.length;d<b;d++){a._container.find(".j_xks_num"+c[d]).trigger("click")}});a._container.on("click",".j_xks2_tz",function(){if($(this).hasClass("disable")){a._bubbles.xk3_2.showBubble();return}window.open(a._buildXks2Url())});a._container.on("click",".j_xssc_hundred,.j_xssc_ten,.j_xssc_digit",function(){var c=$(this).data("pos");var b=$(this).data("num");if($(this).hasClass("select")){a._xssc[c].splice($.inArray(b,a._xssc[c]),1);$(this).removeClass("select")}else{a._xssc[c].push(b);$(this).addClass("select")}a._updateXsscMoney()});a._container.on("click",".j_xssc_jx",function(){var e=["hundred","ten","digit"];for(var c=0,b=e.length;c<b;c++){a._container.find(".j_xssc_"+e[c]+".select").removeClass("select");a._xssc[e[c]].length=0;var d=a._lotteryHelper.generateRandom(0,9,1);a._container.find(".j_xssc_"+e[c]+d).trigger("click")}});a._container.on("click",".j_xssc_tz",function(){if($(this).hasClass("disable")){a._bubbles.xssc.showBubble();return}window.open(a._buildXsscUrl())})},_update11ydjMoney:function(){var b=this,e=b._11ydj.length,d,f,a;if(e<5){d=0}else{f=parseInt(b._container.find(".j_mutiple_11ydj").val(),10)||0;a=b._lotteryHelper.combine(e,5);d=f*a*2}var c=b._container.find(".j_11ydj_tz");if(d>0){b._bubbles.shiyiydj.hideBubble();c.removeClass("disable")}else{c.addClass("disable")}b._container.find(".j_money_11ydj").text(d)},_updateXsscMoney:function(){var a=this;var c,e,d;if(a._xssc.hundred.length&&a._xssc.ten.length&&a._xssc.digit.length){a._bubbles.xssc.hideBubble();a._container.find(".j_xssc_tz").removeClass("disable");d=a._lotteryHelper.combine(a._xssc.hundred.length,1)*a._lotteryHelper.combine(a._xssc.ten.length,1)*a._lotteryHelper.combine(a._xssc.digit.length,1);e=parseInt(a._container.find(".j_mutiple_xssc").val(),10)||0;c=d*e*2}else{c=0}var b=a._container.find(".j_xssc_tz");if(c>0){a._bubbles.xssc.hideBubble();b.removeClass("disable")}else{b.addClass("disable")}a._container.find(".j_money_xssc").text(c)},_updateXks2Money:function(){var b=this,e=b._xk3_2.length,f,d,a;if(e<3){d=0}else{a=b._lotteryHelper.combine(e,3);f=parseInt(b._container.find(".j_mutiple_xks2").val(),10)||0;d=a*f*2}var c=b._container.find(".j_xks2_tz");if(d>0){b._bubbles.xk3_2.hideBubble();c.removeClass("disable")}else{c.addClass("disable")}b._container.find(".j_money_xks2").text(d)},_updateXks1Money:function(){var a=this,d=parseInt(a._container.find(".j_mutiple_xks1").val(),10)||0,c=d*2;var b=a._container.find(".j_xks1_tz");if(c>0){a._bubbles.xk3_1.hideBubble();b.removeClass("disable")}else{b.addClass("disable")}a._container.find(".j_money_xks1").text(c)},_build11ydjUrl:function(){var b=this;var f=b._container.find(".j_mutiple_11ydj").val();var c="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=20";var e=b._11ydj.length===5?"2009%":"2010%";for(var d=0,a=b._11ydj.length;d<a;d++){e+=b._11ydj[d]+","}e=e.slice(0,-1);return c+"&content="+encodeURIComponent(e)+"&multiple="+f},_buildXks1Url:function(){var a=this;var e=a._container.find(".j_mutiple_xks1").val();var b="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=560";var c="56001%";var d=a._container.find(".j_xks1_rst").text();c+=d+"_1";return b+"&content="+encodeURIComponent(c)+"&multiple="+e},_buildXks2Url:function(){var b=this;var f=b._container.find(".j_mutiple_xks2").val();var c="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=560";var e=b._xk3_2.length===3?"56010%":"56011%";for(var d=0,a=b._xk3_2.length;d<a;d++){e+=b._xk3_2[d]+","}e=e.slice(0,-1);return c+"&content="+encodeURIComponent(e)+"&multiple="+f},_buildXsscUrl:function(){var k=this;var h=k._container.find(".j_mutiple_xssc").val();var a="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=202";var f=(k._xssc.hundred.length===1&&k._xssc.ten.length===1&&k._xssc.digit.length===1)?"20205%":"20206%";var b=["hundred","ten","digit"];for(var d=0,e=b.length;d<e;d++){for(var c=0,g=k._xssc[b[d]].length;c<g;c++){f+=k._xssc[b[d]][c]+","}f=f.slice(0,-1);f+="|"}f=f.slice(0,-1);return a+"&content="+encodeURIComponent(f)+"&multiple="+h},_bubbles:function(){var a=this;a._bubbles.shiyiydj=a._showBubble({wrap:a._container.find(".j_11ydj_bubble"),dir:"down",content:"\u8bf7\u81f3\u5c11\u9009\u62e95\u4e2a\u6570\u5b57"});a._bubbles.xk3_2=a._showBubble({wrap:a._container.find(".j_xks2_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"});a._bubbles.xk3_1=a._showBubble({wrap:a._container.find(".j_xks1_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"});a._bubbles.xssc=a._showBubble({wrap:a._container.find(".j_xssc_bubble"),dir:"down",content:"\u81f3\u5c11\u9009\u62e9\u4e00\u6ce8"})},_showBubble:function(b){var c={content:'<div class="lottery_bubble_content">'+b.content+"</div>",arrow_dir:b.dir||"down",bubble_css:{top:-20,right:10,width:b.width||150},arrow_pos:{right:0},wrap:b.wrap,closeBtn:true,level:1,arrowReq:true};var a=new UiBubbleTipBase(c);return a},_stats:function(b){var a=this;a._container.on("click",function(f){var d=f.target||f.srcElement,c=$(d).data("log");if(c){$.stats.sendRequest("fr=tb0_forum&st_page="+a._page+"&st_mod=lucky_lottery&st_fid="+b.forum.forum_id+"&first_class="+encodeURIComponent(b.forum.first_class)+"&second_class="+encodeURIComponent(b.forum.second_class)+"&st_type="+c);$.stats.track(c,"lucky_lottery","frs","click")}})}}});;_.Module.define({path:"comforum/widget/Wallet",sub:{initial:function(a,b){this.dataObj=a;this.is_login=b;this.priceMap={};this._initSelect();this._bindEvents();this._marquee()},_bindEvents:function(){var a=this;$("#wallet_game_title").on("change",function(){a._fillOptions();a._setPriceAndLink()});$("#wallet_game_value").on("change",function(){a._setPriceAndLink()});if(!a.is_login){$("#btn_recharge").on("click",function(){TbCom.process("User","buildLoginFrame",null,null,null,"wallet");return false})}$("#btn_recharge").on("mousedown",function(){$.stats.sendRequest("fr=tb0_forum&st_type=wallet&st_value=recharge")});$(".wallet_tips_list li a").on("click",function(){$.stats.sendRequest("fr=tb0_forum&st_type=wallet&st_value=tips")})},_initSelect:function(){var a=$("#wallet_game_title").val();this._fillOptions();this._setPriceAndLink()},_fillOptions:function(){var a=new Array();var b=$("#wallet_game_title").val();var d=this.dataObj[b].data;for(var c=0;c<d.length;c++){a.push('<option value="'+d[c].parid+'">'+d[c].parvalue+"</option>");this.priceMap[d[c].parid]=d[c].price}$("#wallet_game_value").html(a.join(""))},_setPriceAndLink:function(){var a=$("#wallet_game_value").val();var c=this.priceMap[a];var b="http://baifubao.baidu.com/jump?uri=/wy?game="+$("#wallet_game_title").val()+"&price="+a+"&c=710&domain=http://life.baifubao.com";$("#btn_recharge").tbattr("href",b);$("#wallet_game_price").html(c)},_marquee:function(){var a=$(".wallet_tips_wrap").width(),b=$(".wallet_tips_list").width(),d=0,c=$(".wallet_tips");scrollFunc=function(){c.css("right",d);d++;if(d==b){d=-a}},t=setInterval(scrollFunc,50);$(".wallet_tips_list").on("mouseover",function(){clearInterval(t)}).on("mouseout",function(){t=setInterval(scrollFunc,50)})}}});_.Module.define({path:"comforum/widget/HistoryGame",sub:{initial:function(b,c,a){this.page=b;this.fname=c;this.selectTabIndex=a||0;this._bindEvents();this._selectTab(this.selectTabIndex)},_bindEvents:function(){var a=this;$(".hgame_link").on("click",function(){var c=[],b=$(this).data("stvalue"),d=$(this).data("stratype"),e=$(this).data("tab"),f=$(this).data("pos");c.push("fr=tb0_forum");c.push("st_mod="+a.page);c.push("fname="+encodeURIComponent(a.fname));c.push("tab_type="+e);c.push("pos="+f);c.push("stra_type="+d);c.push("show_type=icon");c.push("st_type=gamelist");c.push("st_value="+encodeURIComponent(b));$.stats.sendRequest(c.join("&"))});$(".hgame_tab_item").on("click",function(){a._selectTab($(this).index());$.stats.sendRequest("fr=tb0_forum&st_mod="+a.page+"&st_type=gametab&st_value=tab"+($(this).index()+1))});$("#game_login_btn").on("click",function(){TbCom.process("User","buildLoginFrame",null,null,null,"pbgame")})},_selectTab:function(a){$("#hgame_tab .hgame_tab_item").removeClass("sel").eq(a).addClass("sel");this._targetContentId=$(".sel").data("target");$("#"+this._targetContentId).show().siblings().hide()}}});_.Module.define({path:"common/widget/asidead",sub:{initial:function(a){if(a.length>0){var b=a.find("a").attr("location");$.stats.hive(b+"_show")}}}});var initCpro=function(){if(PageData.second_class!="\u5546\u4e1a\u4eba\u7269"&&PageData.forum_name!="\u767e\u5ea6"&&PageData.show_cpro){$.JsLoadManager.use("http://cpro.baidu.com/cpro/ui/post.js",function(){window.arrBaiduCproConfig=[];arrBaiduCproConfig.n="baidupost_cpr";arrBaiduCproConfig.tm=24;arrBaiduCproConfig.cm=60;arrBaiduCproConfig.um=24;arrBaiduCproConfig.rad=1;arrBaiduCproConfig.cad=1;arrBaiduCproConfig.wn=1;arrBaiduCproConfig.bg="#ffffff";arrBaiduCproConfig.tt="#000000";arrBaiduCproConfig.ct="#000000";arrBaiduCproConfig.url="#000000";arrBaiduCproConfig.ta="right";arrBaiduCproConfig.tl="top";arrBaiduCproConfig.tn="baiduCPROiknow";arrBaiduCproConfig.hn=3;arrBaiduCproConfig.at="text";var a={keys:["title","desc","showUrl","ckUrl","redWord","picUrl"],template:function(d){var c="onmouseout=\"return f_s(' ');\" ";var e="onmouseover=\"return f_s('\u94fe\u63a5\u81f3: "+d.showUrl+"');\"";var b="";b+="<div>";b+='<a style="display:block;width:100%;"'+c+e+' href="'+d.ckUrl+'" target="_blank">';b+='<u style="display:block;">'+Page.subByteFix(d.title,25,"..")+"</u>";if((typeof(d.picUrl)=="string")&&(d.picUrl!=="")){b+='<img src="'+d.picUrl+'" width="65" height="65"/>'}b+=Page.subByteFix(d.desc,60,"..");b+='<br/><span style="white-space:nowrap">'+Page.subByteFix(d.showUrl,31,"..")+"</span>";b+="</a>";b+="</div><br/>";return b},showCpro:function(b){return this.template(b)}};if(typeof baiduCproTableBuild=="undefined"){window.baiduCproTableBuild=function(m){var b=[],i=[],n=[],o="",e=0,g={},l="",d=0;b=m.split("\n");d=b.length;for(var h=0,f=d;h<f;h++){i=b[h].split("\t");e=i.length;n=a.keys;o+=function(p,j){for(var k=0;k<j;k++){g[n[k]]=p[k]}return a.showCpro(g)}(i,n.length)}var c=document.getElementById("cproshow");c.innerHTML+=o;if(o&&o.length>0){$("#cprodata").addClass("mg_bt26")}}}scr=document.createElement("script");scr.src=f_u("");document.body.appendChild(scr)})}};_.Module.define({path:"common/component/Follower",sub:{initial:function(a){var b={timeout:0};this.options=$.extend(b,a);this.ctn=this.options.ctn;this.timer=null;if(!$.isFunction(this.options.getLimitTop)){this.minTop=this.options.getLimitTop.minTop;this.maxTop=this.options.getLimitTop.maxTop}if(this.ctn){this.bindScrollEvent();this.bindResizeEvent()}},bindScrollEvent:function(){var a=this;$(window).scroll(function(){if(a.options.timeout==0){a.scroller()}else{if(a.timer){clearTimeout(a.timer)}a.timer=setTimeout(function(){a.scroller()},a.options.timeout)}})},bindResizeEvent:function(){var a=this;$(window).on("resize",function(){a.resizer()})},resizer:function(){},scroller:function(){var c,b;var a=$(window).scrollTop()+10;c=this.minTop?this.minTop:this.options.getLimitTop().minTop;b=this.maxTop?this.maxTop:this.options.getLimitTop().maxTop;if(a<c){if(this.ctn.data("isFixed")){this.ctn.removeClass("tbui_follow_fixed");this.ctn.data("isFixed",false);this.trigger("normal")}this.ctn.show()}else{if(a>=c&&a<=b){if(!this.ctn.data("isFixed")){this.ctn.addClass("tbui_follow_fixed");this.ctn.data("isFixed",true);this.trigger("fixed")}this.ctn.show()}else{this.trigger("hide");this.ctn.hide()}}}}});_.Module.define({path:"pb/widget/NewsRecommend",requires:["common/component/Follower"],sub:{initial:function(){var a=$(".left_section");if($(".left_section").height()>$(".right_section").height()){$("#news_rcm").wrap('<div id="news_rcm_wrapper"></div>');_.Module.use("common/component/Follower",{ctn:$("#news_rcm"),getLimitTop:function(){return{minTop:$("#news_rcm_wrapper").offset().top,maxTop:a.offset().top+a.height()-$("#news_rcm").height()}}})}}}});_.Module.define({path:"comforum/widget/Rank",sub:{initial:function(a,c,b){this.page=a;this.fname=c;this.straType=b;this._bindEvents()},_bindEvents:function(){var a=this;$(".game_rank_item").on("click",".game_rank_link",function(){var c=[],b=$(this).data("stvalue"),d=$(this).data("pos");c.push("fr=tb0_forum");c.push("st_mod="+a.page);c.push("fname="+a.fname);c.push("pos="+d);c.push("stra_type="+a.straType);c.push("show_type=ranklist");c.push("st_type=gamelist");c.push("st_value="+encodeURIComponent(b));$.stats.sendRequest(c.join("&"))})}}});_.Module.define({path:"pb/widget/top10",sub:{initial:function(){this._addStats()},_addStats:function(){var a=PageData.forum.name;var b="fr=tb0_forum&fname="+a;if($.inArray(PageData.forum.name,["\u7b11\u50b2\u6c5f\u6e56\u7535\u89c6\u5267","\u70ed\u5e26\u9c7c","ac\u7c73\u5170","lol","\u5723\u5802","\u67ef\u5357"])>=0){$.stats.sendRequest(b+"&st_type=pb_top10_show");$("#follow_wrapper").find(".j_tieba_top10_content").delegate("a","click",function(){$.stats.sendRequest(b+"&st_type=pb_top10_click")})}}}});(function(a){var b={POST_AUTHORIZED:"authorized",POST_LOGIN_NEEDED:"\u672c\u5427\u53d1\u8d34\uff0c\u8bf7\u5148 <a href=\"#\" onclick=\"_.Module.use('common/component/LoginDialog', ['', 'editor']);return false;\">\u767b\u5f55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6ce8\u518c</a>&nbsp;",POST_USERNAME_NEEDED:"\u60a8\u8fd8\u6ca1\u6709\u7528\u6237\u540d\uff0c\u4e0d\u80fd\u5728\u672c\u5427\u53d1\u8d34\u3002\u8bf7\u5148<a href=\"#\" onclick=\"TbCom.process('User','buildUnameFrame','\u586b\u5199\u7528\u6237\u540d',' ');return false;\">\u586b\u5199\u7528\u6237\u540d</a>",POST_BLOCKED:'\u62b1\u6b49\uff0c\u4f60\u53ef\u80fd\u5b58\u5728\u8fdd\u89c4\u64cd\u4f5c\uff0c\u5df2\u88ab\u5c01\u7981\u3002\u8bf7<a href="http://tieba.baidu.com/pmc/main?fid=<%=forum.id%>" target="_blank">\u70b9\u51fb\u6b64\u5904</a>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\u3002',POST_LEVEL_LIMITED:'\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8<a href="http://tieba.baidu.com/f/like/level?kw=<%=forum.name%>&ie=utf-8" >4\u7ea7\u5934\u8854</a><br />\u4ee5\u4e0a\u4f1a\u5458\u53d1\u8d34',POST_BAWU_LIMITED:"\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53d1\u8d34",POST_LAW_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u6d4f\u89c8\uff0c\u4e0d\u80fd\u53d1\u8d34",POST_QUALIFICATIONS_LIMITED:"\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53ca\u6ce8\u518c\u6ee1\u4e00\u5b9a\u65f6\u95f4\u7684\u8001\u7528\u6237\u53d1\u8d34",POST_THREAD_ONLY:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u4e3b\u9898\u8d34",POST_REPLY_ONLY:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u56de\u590d\u8d34",POST_THREAD_LEVEL_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u4e3b\u9898\u8d34",POST_REPLY_LEVEL_LIMITED:"\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u56de\u590d\u8d34",POST_PAD_LIMITED:"\u5207\u6362\u6210pad\u7248\u8d34\u5427\uff0c\u7545\u4eab\u66f4\u987a\u7545\u7684\u53d1\u8d34\u4f53\u9a8c\uff01",context:null,authorities:null,loadContext:function(c){this.context=c},loadContextFromPageData:function(d){var e=d.product=="frs";var c=d.product=="pb";this.context={forum:{id:d.forum.id,name:d.forum.name,nameEncoded:d.forum.name_url},user:{id:d.user.id,name:d.user.name,level:d.user.balv.level_id,isFavorForum:e?d.user.balv.is_like:PageData.user.has_grade,isLogin:!!d.user.is_login,isBlocked:!!d.user.is_block,isBlack:!!d.user.balv.is_black,noUsername:!!d.user.no_un,canPost:e?d.user.power.post:PageData.can_post,canVote:e?d.user.power.vote_creater:false,forbidFlag:d.forum.forbid_flag,signNumber:!!d.user.is_login?(d.forum.sign_in_info?d.forum.sign_in_info.user_info.c_sign_num:0):0},product:d.product,floor:0,tbs:d.tbs,isPad:d.is_ipad,page:d.page};if(c){this.context.thread={id:d.thread.id};this.context.floor=d.thread.reply_num}},loadAuthorities:function(c){this.authorities=c},getContext:function(){return this.context},getAuthorities:function(){return this.authorities},isPostAllowed:function(){return this._validatePostAuthority()==this.POST_AUTHORIZED},getPostRejectedMessage:function(){var c=this._validatePostAuthority();if(c!=this.POST_AUTHORIZED){return baidu.template(c,this.context)}else{return null}},_validatePostAuthority:function(){var c=this.context.user;if(!c.isLogin){return this.POST_LOGIN_NEEDED}if(c.noUsername){return this.POST_USERNAME_NEEDED}if(c.isBlocked){return this.POST_BLOCKED}if(!c.canPost){return this.FORBID_FLAG_MAP[c.forbidFlag]}if(this.context.isPad){return this.POST_PAD_LIMITED}return this.POST_AUTHORIZED}};b.FORBID_FLAG_MAP={1:b.POST_LOGIN_NEEDED,2:b.POST_QUALIFICATIONS_LIMITED,3:b.POST_LEVEL_LIMITED,4:b.POST_BAWU_LIMITED,5:b.POST_LAW_LIMITED,7:b.POST_REPLY_ONLY,8:b.POST_THREAD_ONLY,9:b.POST_REPLY_LEVEL_LIMITED,10:b.POST_THREAD_LEVEL_LIMITED};a.PosterContext=b})(window);_.Module.define({path:"common/component/PostService",requires:["PostResultHandlerManager","ucenter/component/LikeTip"],sub:{_defaultData:{ie:"utf-8",kw:"",fid:"",tid:"",vcode_md5:"",floor_num:0,rich_text:1,tbs:0,content:""},posting:false,submitUrl:{thread:"/f/commit/thread/add",reply:"/f/commit/post/add",vpostThread:"/vpost/addthread",vpostReply:"/vpost/addpost"},initial:function(b){var a=this;this.resultHandlerManager=this.use("PostResultHandlerManager");this.bind("retry",function(d,c){a._retryHandler(c)})},isPosting:function(){return this.posting},post:function(e,f,d){var b=this;if(this.posting){return this}this.posting=true;var a=$.extend({},this._defaultData);if(d){$.extend(a,this._extractDataFromContext(d))}$.extend(a,f);a.__type__=e;var c=this.submitUrl[e];$.ajax({type:"post",url:c,data:a,success:function(g){var h=b.resultHandlerManager.getHandler(g.err_code||g.no);h.call(b,g,a)},error:function(){alert("\u670d\u52a1\u4e0d\u53ef\u7528");b.trigger("complete")},complete:function(){b.posting=false},dataType:"json"});return this},_extractDataFromContext:function(a){return{kw:a.forum.name,fid:a.forum.id,tid:a.thread?a.thread.id:0,tbs:a.tbs,floor_num:a.floor}},_retryHandler:function(a){this.post(a.__type__,a)},success:function(a){this.bind("success",a);return this},error:function(a){this.bind("error",a);return this},complete:function(a){this.bind("complete",a);return this},retry:function(a){this._retryHandler=a;return this}}});_.Module.define({path:"common/component/WordLimit",requires:[],sub:{checkTimer:null,isShow:false,exceed:false,initial:function(b){var a={container:$("body"),inputObj:null,checkDelay:50,showLimit:10,maxNum:120,isLimitInput:false,autoPos:true,numStyle:{},limitStyle:{}};var c=$.extend(true,a,b);this.container=$(c.container);this.inputObj=$(c.inputObj);this.showLimit=c.showLimit;this.option=c;this.holder=$('<div class="w_limit_wrapper "></div>');this.container.append(this.holder)},init:function(){var c=this.option,b=this;if(c.inputObj==null){return}var a=$(c.inputObj);a.keydown(function(d){b.handlerEvent(d);return true});a.focus(function(d){b.handlerEvent(d);return true});a.bind("input",function(d){b.handlerEvent(d);return true});a.bind("propertychange",function(d){b.handlerEvent(d);return true})},setLimitStyle:function(a){this.holder.css(a)},hideWordLimit:function(){this.trigger("wlhiding");this.holder.hide();this.isShow=false;clearTimeout(this.checkTimer)},autoPosition:function(){var c=this.inputObj.offset(),b=this.inputObj.width(),a=$(document).width();this.holder.css({top:c.top-this.holder.height()-5,right:a-b-c.left-9})},handlerEvent:function(b){clearTimeout(this.checkTimer);var c=this.option;var a=this;a.blur=false;this.checkTimer=setTimeout(function(){a.check()},c.checkDelay)},check:function(b){var g=this.option;var f=this.inputObj;var e=f.val();var c=$.tb.getByteLength(e);var d=g.maxNum-c;if(g.isLimitInput&&d<0){f.val($.tb.subByte(e,g.maxNum+(d<0&&d>-2?d:0)))}d=g.maxNum-$.tb.getByteLength(f.val());if(d<=this.showLimit){if(g.autoPos){this.autoPosition()}else{this.trigger("onSetPosition")}this.holder.show();this.isShow=true;var a=Math.ceil(d/2);if(d<0){a=Math.floor(d/2);if(!this.exceed){this.trigger("overflow");this.exceed=true}this.trigger("wlshowing");this.holder.html('\u5df2\u7ecf\u8d85\u51fa<span class="w_limit_num" style="color:#f00;">'+-a+"</span>\u4e2a\u5b57")}else{if(this.exceed){this.trigger("unoverflow");this.exceed=false}this.trigger("wlshowing");if(d==0){this.holder.html('\u8fd8\u53ef\u8f93\u5165<span class="w_limit_num" style="color:#ff0000;">'+a+"</span>\u4e2a\u5b57")}else{this.holder.html('\u8fd8\u53ef\u8f93\u5165<span class="w_limit_num" style="color:#929292;">'+a+"</span>\u4e2a\u5b57")}}}else{if(this.isShow){this.trigger("wlhiding");this.holder.hide();this.isShow=false;if(this.exceed){this.trigger("unoverflow");this.exceed=false}}}}}});_.Module.define({path:"ucenter/component/LikeTip",sub:{initial:function(g,b,d){var c=this;if(d&&d.like_no&&(d.like_no>=1)){var a=$.dialog.alert('<img src="'+PageData.staticDomain+'tb/static-frs/img/like_back.png">',{width:320,height:131,acceptValue:"\u77e5\u9053\u4e86"});$(a.element[0]).find(".dialogJcontent").css("padding-bottom","0px");$(a.element[0]).find(".dialogJanswers").css("padding-top","0px");a.bind("onaccept",function(h){c.reloadAndGotop()}).bind("onclose",function(h){c.reloadAndGotop()})}else{var f=this.getTipContent(g,b,d);var e={title:"\u6210\u529f\u63d0\u793a",width:418,modal:!g};var a=$.dialog.open(f,e);if(g){$(a.element[0]).css("padding","2px")}$(a.element[0]).find(".dialogJcontent").tbattr("id","balv_first_like_dialog");$(a.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")});$(a.element[0]).find(".lvlup_pop_btn").eq(0).bind("click",function(h){c.reloadAndGotop()});a.bind("onclose",function(h){c.reloadAndGotop()})}},getTipContent:function(e,a,b){var d="<span>";if(e){d+=e+"\uff0c"}d+="\u606d\u559c\u4f60\u6210\u4e3a\u672c\u5427\u7b2c</span>";d+="<span class='tip_font_orange'>"+b.index+"</span>";d+="<span>\u4f4d\u4f1a\u5458</span>";var c="";c+='<div class="userlike_tip_join" id="userlike_tip_join">';c+='<div class="userlike_tip_info" id="userlike_tip_info">'+d+"</div>";if(e){c+='<div class="user_rights_msg"><span class="user_rights_msg_gray">\u83b7\u5f97\u5934\u8854&nbsp;</span><img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+PageData.user.balv.level_name+'<span class="user_rights_msg_gray">&nbsp;\u5347\u7ea7\u4eab\u7279\u6743\uff0c<span><a class="user_rights_msg_link" target="_blank" href="/f/like/level?kw='+PageData.forum.name_url+'">\u67e5\u770b\u4f1a\u5458\u6743\u5229</a></div>'}else{if(PageData.user.balv.level_id==1){c+='<div class="user_rights_msg">\u83b7\u5f97\u5934\u8854&nbsp;<img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+PageData.user.balv.level_name+'\uff0c\u5347\u7ea7\u4eab\u7279\u6743\uff0c<a target="_blank" href="/f/like/level?kw='+PageData.forum.name_url+'">\u67e5\u770b\u5347\u7ea7\u79d8\u7c4d</a></div>'}else{c+='<div class="user_rights_msg">\u6839\u636e\u4f60\u5728\u672c\u5427\u7684\u6d3b\u8dc3\u8868\u73b0\uff0c\u76f4\u63a5\u6388\u4e88<img src="'+PageData.staticDomain+"tb/static-member/img/badges/"+PageData.user.balv.level_id+'.png">&nbsp;'+PageData.user.balv.level_name+"\uff0c\u7ed9\u529b\uff01</div>";c+='<div class="userlike_tip_span">\u672c\u5427\u767e\u5b9d\u7bb1\u5bf9\u4f60\u5f00\u653e\u4e86\uff0c<a target="_blank" href="/imall/mall?kw='+PageData.forum.name_url+'">\u53bb\u767e\u5b9d\u7bb1\u770b\u770b\u6709\u54ea\u4e9b\u7279\u6743\u548c\u5b9d\u8d1d</a></div>'}}c+='<div class="lvlup_tip_btnzone"><input class="lvlup_pop_btn" type="button" value="\u77e5\u9053\u4e86"/>';if(e){c+='<a class="userlike_tip_cancel" target="_blank" href="/i/'+PageData.user.itieba_id+'/forum">\u5982\u4f55\u53d6\u6d88\u4f1a\u5458</a>'}c+="</div></div>";return c},reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])}}});_.Module.define({path:"common/component/MousePwd",requires:[],sub:{initial:function(){this.UTSTART=new Date().getTime();this.MOUSEPWD_CLICK=0;var n={ea:[],ma:[]};var h={};var c=false;var i=(new Date()).getTime();var o={};var j=[];var q=[];function k(u){if(!u){var u=window.event}var t=0;var v=0;if(u.pageX||u.pageY){t=u.pageX;v=u.pageY}else{if(u.clientX||u.clientY){t=u.clientX+document.body.scrollLeft;v=u.clientY+document.body.scrollTop}}return[t,v]}function b(t){return t.offsetParent?(t.offsetLeft+b(t.offsetParent)):t.offsetLeft}function a(t){return t.offsetParent?(t.offsetTop+a(t.offsetParent)):t.offsetTop}function p(t){if(t.preventDefault){t.preventDefault()}else{window.event.returnValue=false}}function s(A){A.stopPropagation();var v=k(A);var x=n[this.id];if(x){if(!x.hover){x.hover=true;x.count++}}else{var w=b(this);var y=a(this);var z=w+this.offsetWidth;var u=y+this.offsetHeight;x=n[this.id]={hover:true,count:1,left:w,top:y,right:z,buttom:u}}if(!x["mouse"+x.count]){x["mouse"+x.count]=[];x["time"+x.count]={start:(new Date()).getTime()};n.ma.push(x["mouse"+x.count])}x["mouse"+x.count].push(v);q.push("1")}function r(v){v.stopPropagation();var t=k(v);var u=n[this.className];if(u&&u.hover){if(t[0]&&t[0]>u.left&&t[0]<u.right&&t[1]&&t[1]>u.top&&t[1]<u.buttom){return}u["time"+u.count].end=(new Date()).getTime();u.hover=false}q.push("0")}function e(){var t=n.ma.length;if(t>0){var u=n.ma[t-1];return u[u.length-1]}}function f(){var u="";var t=q.length;if(t>10){q=q.slice(t-10)}u=q.join(",");return u}function l(){if(c){return h}var t=[e(),f(),(new Date()).getTime()-this.UTSTART,[screen.width,screen.height].join(",")].join("\t");h.c=d(t)+","+i+""+this.MOUSEPWD_CLICK;c=true;return h}function d(y){var t=[];var w={};var x=i%100;for(var v=0,u=y.length;v<u;v++){var z=y.charCodeAt(v)^x;t.push(z);if(!w[z]){w[z]=[]}w[z].push(v)}return t}function g(){return this.className}function m(t){this.elements=t;$.each(t,function(u,v){$("."+v.toString()).bind("mouseover",s);$("."+v.toString()).bind("mouseout",r);o[v.toString()]=u});$("body").bind("click",function(){this.MOUSEPWD_CLICK=1})}this.start=m;this.report=l;this.time=i}}});_.Module.define({path:"common/component/PostSignature",requires:[],sub:{_template:['<option value="#{id}" #{isSelected}>#{name}</option>'].join(""),url:"/f/user/sign_list?t="+(+new Date()),hasRequested:false,isUsed:0,data:null,initial:function(b){var a=this;this.$root=b.$container},init:function(){var a=this;if(!this.hasRequested){this.hasRequested=true;if(this.data==null){this.requestSignature()}}this.$root.on("click",".j_use_signature",function(){a.isUsed=this.checked?1:0;a.toggleList();$.post("/f/user/cm/sign_setneed",{need:a.isUsed,tbs:PosterContext.getContext().tbs})})},requestSignature:function(){var a=this;$.get(this.url,function(b){b=$.json.decode(b);if(b&&b.no==0){a.data=b.data;a.isUsed=a.data.need;a.$root.find(".j_use_signature").tbattr("checked",a.isUsed==1);a.buildList(b.data);a.toggleList()}})},toggleList:function(){var a=this.$root.find(".j_signature_wrapper");if(this.isUsed==1){a.show()}else{a.hide()}},buildList:function(f){var c=this.$root.find(".j_signature_wrapper");var b=c.find("select");var e="";if(f&&f.signs.length>0){for(var d=0,a=f.signs.length;d<a;d++){e+=$.tb.format(this._template,{id:f.signs[d].id,isSelected:f.signs[d].id==f.used_id?"selected=selecte":"",name:f.signs[d].name})}b.html(e)}else{c.empty();c.html('\uff08\u60a8\u76ee\u524d\u6ca1\u6709\u53ef\u4f7f\u7528\u7684\u7b7e\u540d\u6863\uff0c&nbsp;<a style="color:#0449BE" target="_blank" href="/i/sys/jump?type=signsetting">\u67e5\u770b\u5168\u90e8</a>\uff09')}}}});_.Module.define({path:"common/component/PostPrefix",requires:[],sub:{initial:function(a){this.$target=a.$target;this.prefix=a.prefix;this.$target.val(this.prefix.value);if(this.prefix.need_sug){this.pickPrefix(this.$target,this.prefix.sug_html)}},pickPrefix:function(b,c){var g=$('<a class="pprefix-list"></a>'),h,i=-1;function d(){g.css({width:b.outerWidth()+"px",left:b.offset().left+"px",top:(b.offset().top+b.outerHeight()-1)+"px"}).show()}function a(){i=-1;h.removeClass("pprefix-item-shine");g.hide()}function f(k){var l=b.val(),j,m=b.tbattr("data-prefix");if(m&&l.indexOf(m)>-1){j=l.replace(m,k)}else{j=k}b.val(j).tbattr("data-prefix",k);setTimeout(function(){b.trigger("focus")},100)}function e(j,k){if(j=="up"){i-1<0?i=h.length-1:i--}else{if(j=="down"){i+1==h.length?i=0:i++}else{if(j=="mouse"){i=k}}}if(!g.is(":visible")){d();i=0}h.removeClass("pprefix-item-shine").eq(i).addClass("pprefix-item-shine")}g.css({display:"none","box-sizing":"border-box"}).html(c).appendTo("body");h=g.children();b.on("click.showPPrefix",d).on("blur.hidePPrefix",a).on("keydown",function(j){switch(j.keyCode){case 8:d();break;case 40:j.preventDefault();e("down");break;case 38:j.preventDefault();e("up");break;case 13:j.preventDefault();if(i!=-1){f($(".pprefix-item-shine").html());a()}break;case 27:if(g.is(":visible")){j.preventDefault();a()}default:i=-1;a()}});g.on("mousedown.pick",".pprefix-item",function(j){f($(this).html())}).on("mouseover",".pprefix-item",function(j){e("mouse",$(this).index())})}}});_.Module.define({path:"common/widget/RichPoster",requires:["common/component/PostService","common/component/WordLimit","common/component/PostPrefix","common/component/PostSignature","common/component/MousePwd"],sub:{initial:function(b){var c=$("#tb_rich_poster_container").hide();this.$root=$($("#rich_ueditor_tpl").html());this.$editorContainer=this.$root.find(".ueditor_container");this.prefix=b.prefix;c.append(this.$root);this.isFrs=PosterContext.getContext().product==="frs";this.isPb=PosterContext.getContext().product==="pb";this.initPostService();if(this.isFrs){this.$title=this.$root.find(".j_title");this.initTitle()}var a=PosterContext.getContext().page;if(a==="star"||(this.isPb&&a!=="pb_bright")){this.$root.addClass("compat_rich_poster")}this.initDraft();this.initEditor();this.initAntiSpamming();this.initEvent();this.initPlaceholder();this.initMousePwd();this.initSignature();c.show();if(!PosterContext.isPostAllowed()){if(!($.browser.msie&&$.browser.version==6)){this.editor.ready(function(){this.disable()})}this.showWarning(PosterContext.getPostRejectedMessage(true));this.toggleSubmitButton(true);if(this.$title){this.$title.tbprop("disabled",true)}}else{if(this.isFrs){_.Module.use("common/component/Placeholder",[this.$title,"\u8bf7\u586b\u5199\u6807\u9898",{color:"#bfbfbf"}])}this.editor.ready(function(){this.restoreDraft()})}PageUnit.load("rich_poster_show_music_recommend")},initPostService:function(){var a=this;this.postService=this.use("common/component/PostService");this.postService.success(function(){a.editor.setContent("");a.editor.clearDraft();a.showPostSuccess();setTimeout(function(){a.refresh()},500)}).complete(function(){a.togglePostState(false)})},initEvent:function(){var a=this;this.$submit=this.$root.find(".j_submit").click(function(b){b.preventDefault();if(!a.$submit.is(".ui_btn_disable")){a.post()}});this.$root.on("keyup",function(b){if(b.ctrlKey&&b.keyCode==13){a.post()}});this.$root.find(".add_vote_btn").click(function(){if(!PosterContext.getContext().user.canVote){var b=PosterContext.getContext().forum.nameEncoded;$.tb.alert({title:"\u53d1\u8d77\u6295\u7968",message:'\u83b7\u5f97<a target="_blank" href="/f/like/level?kw='+b+'">3\u7ea7\u5934\u8854</a>\u624d\u53ef\u53d1\u8d77\u6295\u7968\u54e6~~<br />\u7533\u8bf7\u52a0\u5165\u4f1a\u5458\uff0c\u9a6c\u4e0a\u53d1\u8d77\u6295\u7968\uff01\uff08\u66f4\u591a\u4f1a\u5458\u7279\u6743<a target="_blank" href="/f/like/level?kw= '+b+'">\u70b9\u6b64\u67e5\u770b</a>',buttons:{text:"\u786e\u5b9a"}});return false}});this.observe("insertimage",function(b,c){a.editor.execCommand("insertimage",[c])});this.observe("file_added.attachment",function(){a.togglePostState(true)});this.observe("upload_complete.attachment",function(){a.togglePostState(false)});this.observe("wanner_post",function(){a.focus()})},initTitle:function(){this.initTitleWordLimit();this.initTitlePrefix()},initTitleWordLimit:function(){var c=$("#tb_rich_poster");var a={inputObj:this.$title,checkDelay:200,showLimit:10,maxNum:60,isLimitInput:true};var b=this.use("common/component/WordLimit",a);b.init();b.bind("wlshowing",function(){c.find(".j_surveillance").hide()});b.bind("wlhiding",function(){c.find(".j_surveillance").show()})},initTitlePrefix:function(){var a={$target:this.$title,prefix:this.prefix};this.use("common/component/PostPrefix",a)},initEditor:function(){if(PosterContext.isPostAllowed()){this.editor=UE.getEditor("ueditor_replace",{topOffset:this.isFrs?40:0})}else{this.editor=UE.getEditor("ueditor_replace",{toolbar:""})}window.test_editor=this.editor;window.test_poster=this},initDraft:function(){var a=this;var d=this.$root.find(".j_draft");var b=d.children(".j_content");var c=d.children(".j_clear");this.$root.on("saved.draft",function(){b.text("\u4f60\u6b63\u5728\u8f93\u5165\u7684\u5185\u5bb9\u5df2\u81ea\u52a8\u4fdd\u5b58, "+$.dateFormat(new Date(),"HH:mm:ss"));d.show()});this.$root.on("restored.draft",function(){b.text("\u4f60\u4e0a\u6b21\u672a\u53d1\u8868\u7684\u5185\u5bb9\u5df2\u81ea\u52a8\u6062\u590d");d.show()});c.on("click",function(){a.editor.clearDraft();a.editor.setContent("");d.hide()})},initPlaceholder:function(){var a=this;this.$placeholder=$('<div class="tb_poster_placeholder"></div>');this.$placeholder.click(function(b){if(!$(b.target).is("a")){a.$placeholder.hide();a.editor.focus()}});this.editor.ready(function(){a.$placeholder.prependTo(a.$root.find(".edui-container"));a.editor.addListener("focus",function(){a.$placeholder.hide()});a.editor.addListener("blur",function(){a._showPlaceHolder()});a._showPlaceHolder()});this.$root.on("restored.draft",function(){a.$placeholder.hide()});this.$placeholder.html('\u5ba2\u6237\u7aef\u53d1\u8d34\u7ecf\u9a8c<span style="color:#CF2525; font-size:30px;font-weight:bold">3\u500d</span>\u5927\u56de\u9988\uff0c<a href="http://c.tieba.baidu.com/c/s/download/pc?src=webfatie" style="color:#2D64B3; text-decoration:underline;" target="_blank">\u72c2\u62fd\u70ab\u9177\u5c4c\u70b8\u5929\u6709\u6728\u6709</a>')},_showPlaceHolder:function(){var a=this.editor.getContent();if(a.length==0){this.$placeholder.show()}},initMousePwd:function(){this.MousePwd=this.use("common/component/MousePwd");this.MousePwd.start(["editor_content_wrapper"])},initSignature:function(){var a=this;var b=this.$root.find(".j_poster_signature");b.hide();if(PosterContext.getContext().user.isLogin){this.$root.find("#ueditor_replace").one("click",function(){var c=a.use("common/component/PostSignature",{$container:b});c.init();b.show()})}},initAntiSpamming:function(){var b=$.cookie("GET_TOPIC");if(PosterContext.getContext().user.isLogin){if(!(b&&b==PosterContext.getContext().user.id)){$("body").append('<div id="anttongji" style="display:none"></div>');var a=$(document.createElement("script"));var c="http://tongji.tieba.baidu.com/common/js/gettopic.js";a.tbattr({src:c,type:"text/javascript"});$("body").append(a);$.cookie("GET_TOPIC",PosterContext.getContext().user.id,{expires:0.5,path:"/"})}}},showPostSuccess:function(){$('<div class="tb_poster_info poster_success"><strong>\u53d1\u8868\u6210\u529f\uff01</strong><br/>\u4eb2~\u4e0b\u6b21\u8bb0\u5f97\u7528\u5ba2\u6237\u7aef\u53d1\u8d34\uff0c\u6709<span style="color:#CF2525; font-size:16px; font-weight: bold;">3\u500d</span>\u7ecf\u9a8c\u5462\uff01</div>').appendTo(this.$editorContainer)},showWarning:function(a){if(this.$warning==undefined){this.$warning=$('<div class="tb_poster_info poster_warning"></div>').appendTo(this.$editorContainer)}this.$warning.html(a)},getTitle:function(){return this.$title?this.$title.val():""},getContent:function(){return this.editor.getContent()},getPostType:function(){var a=this.isFrs?"thread":"reply";if(this.editor.getExtendContent().hasLocalVideo){a=(a=="thread")?"vpostThread":"vpostReply"}return a},getPostData:function(){var b=this.editor.getExtendContent();var a={content:this.getContent()};if(this.isFrs){a.title=this.getTitle()}if(b.videoNumber>0){a.video_url=b.videoUrl;if(b.hasLocalVideo){a.file_id=b.fileId}}if(b.attachments){a.files=b.attachments}var d=this.$root.find(".j_sign_id");var c=this.$root.find(".j_use_signature");if(c.tbattr("checked")&&d.size()>0&&d.val()){a.sign_id=d.val()}a.mouse_pwd=this.MousePwd.report()["c"];a.mouse_pwd_t=this.MousePwd.time;a.mouse_pwd_isclick=this.MousePwd.MOUSEPWD_CLICK;return a},togglePostState:function(b){var a=this.$root.find(".j_posting_status");a.toggleClass("poster_posting_status_loading",b);this.toggleSubmitButton(b)},toggleSubmitButton:function(a){this.$submit.toggleClass("ui_btn ui_btn_m",!a);this.$submit.toggleClass("ui_btn_disable ui_btn_m_disable",a)},validateContent:function(){var e=this.isFrs?30000:10000;var c=this.editor.getContentByteLength();var d=$.trim(this.getTitle()).length;var b=this.editor.getExtendContent();var f=this.$root.find(".ueditor_container .j_error");if(this.isFrs&&d===0){this.$root.find(".title_container .j_error").text("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a").show();this.$title.focus();$(window).scrollTop(this.$title.offset().top-60);return false}if(c===0&&!this.isFrs){f.text("\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a").show();return false}if(c>e){var a="\u62b1\u6b49\uff0c\u60a8\u7684\u8d34\u5b50\u8d85\u8fc7"+e/2+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u6216\u5206\u6bb5\u540e\u518d\u63d0\u4ea4";f.text(a).show();return false}if(b.videoNumber>1){var a="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u89c6\u9891\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc71\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";f.text(a).show();return false}if(b.musicNumber>10){var a="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u97f3\u4e50\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";f.text(a).show();return false}this.$root.find(".j_error").hide();return true},post:function(){var a=this.validateContent();if(!this.postService.isPosting()&&a){$.cookie("GET_TOPIC","-",{expires:-1,path:"/"});this.postService.post(this.getPostType(),this.getPostData(),PosterContext.getContext());this.togglePostState(true)}},refresh:function(){var a=$.tb.location.getHref();a=a.replace(/#\w*$/,"");$.tb.location.setHref(a)},focus:function(){if(this.isFrs){this.$title.focus()}else{if(!($.browser.msie&&$.browser.version<=7)){this.editor.focus()}}}}});(function(){window.TED=window.TED||{};window.TED["extend"]=h;window.TED["EventDispatcher"]=f;function h(n,o,j){function l(){}l.prototype=o.prototype;var m=new l();m.constructor=n;n.superclass=o;for(var k in j){m[k]=j[k]}n.prototype=m}function f(){this._events={}}f.prototype={on:function(k,l,j,i){j=j||this;this._events[k]=this._events[k]||[];this._events[k].push({listener:l,scope:j,args:i})},fireEvent:function(p,o,l){var q,n,k,m=this._events[p];if(!m){return false}else{for(n=0,k=m.length;n<k;n++){q=m[n];o=q.scope;l=l||q.args||[];q.listener.apply(o,l)}}},remove:function(n,o){if(!this._events[n]){return false}var m=this._events[n],l,k;for(l=0,k=m.length;l<k;l++){if(m[l].listener===o){m.splice(l,1);break}}if(m.length===0){delete this._events[n]}}};var b={addEvent:function(j,i,k){var l;if(j.addEventListener){l=function(n,m,o){n.addEventListener(m,o,false)}}else{l=function(n,m,o){n.attachEvent("on"+m,o)}}l(j,i,k);this.addEvent=l},removeEvent:function(k,j,l){var i;if(k.addEventListener){i=function(n,m,o){n.removeEventListener(m,linstener,false)}}else{i=function(n,m,o){n.detachEvent("on"+m,o)}}i(k,j,l);this.addEvent=i}};window.TED["Event"]=b;window.TED["HoverOverlay"]=d;function d(i){d.superclass.call(this);this.timer=null;this.container=i;this.holder=document.createElement("div");this.holder.className="tb-editor-overlay";this.holder.style.display="none";var j=this;b.addEvent(this.holder,"mouseover",function(){j.mouseover()});b.addEvent(this.holder,"mouseout",function(){j.mouseout()});this.content=document.createElement("div");this.content.className="overlay-content";this.arrow=document.createElement("span");this.arrow.className="arrow";this.holder.appendChild(this.arrow);this.holder.appendChild(this.content);this.container.appendChild(this.holder)}h(d,f,{container:null,holder:null,content:null,currentOpen:null,isOpen:false,closefunction:null,open:function(o,n,m,i,p,j,l){this.isOpen=true;this.currentOpen=l;this.arrow.style.left=p;var k=this.holder.style;k.left=o;k.top=n;k.width=m;k.height=i;k.display="block";this.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'},close:function(){this.isOpen=false;this.content.innerHTML="";this.holder.style.display="none";if(this.currentOpen){this.currentOpen.className=this.currentOpen.className.replace(" open","");this.currentOpen=null}this.fireEvent("close")},mouseover:function(){this.closefunction=this.close;this.close=function(){};if(this.timer!=null){clearTimeout(this.timer)}},mouseout:function(){var i=this;i.close=i.closefunction;i.timer=setTimeout(function(){i.close()},500)}});window.TED["Overlay"]=a;function a(i){a.superclass.call(this);this.container=i;this.holder=document.createElement("div");this.holder.className="tb-editor-overlay";this.holder.style.display="none";this.closeBtn=document.createElement("span");this.closeBtn.className="close";var j=this;b.addEvent(this.closeBtn,"click",function(){j.close()});this.content=document.createElement("div");this.content.className="overlay-content";this.arrow=document.createElement("span");this.arrow.className="arrow";this.holder.appendChild(this.closeBtn);this.holder.appendChild(this.arrow);this.holder.appendChild(this.content);this.container.appendChild(this.holder)}h(a,f,{closeButton:null,container:null,holder:null,content:null,currentOpen:null,isOpen:false,open:function(l,p,k,q,m,j){if(this.isOpen==true&&TED.Editor&&TED.Editor.Status.isPicassoOpen===true){var n=this;var o=$.dialog.confirm('<div id="maincontent" style="position:absolute;"><img style="margin:10px 10px 10px 10px;width:68px;height:68px;" src="http://static.tieba.baidu.com/tb/editor/v2/picasso/alarm.gif" /><div id="tipscontent" style="position:absolute;left:100px;top:15px;width:270px;font-size:14px;font-family:\u5b8b\u4f53" ><b>\u60a8\u6b63\u5728\u7f16\u8f91\u6d82\u9e26\uff0c\u73b0\u5728\u9000\u51fa\u5c06\u4e0d\u4f1a\u4fdd\u5b58\uff0c\u60a8\u786e\u5b9a\u8981\u9000\u51fa\uff1f</b></div></div>',{title:"\u6d82\u9e26\u7f16\u8f91\u5668",acceptValue:"\u786e\u5b9a",cancelValue:"\u53d6\u6d88"});o.width(420);o.height(90);o.bind("onaccept",function(){TED.Editor.Status.isPicassoOpen=false;if(n.picassoPanel){n.picassoPanel.destroy();n.picassoPanel=null}n.isOpen=true;n.arrow.style.left=m;var r=n.holder.style;r.left=l;r.top=p;r.width=k;r.height=q;r.display="block";n.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'})}else{this.isOpen=true;this.arrow.style.left=m;var i=this.holder.style;i.left=l;i.top=p;i.width=k;i.height=q;i.display="block";this.content.innerHTML='<iframe width="100%" height="100%" frameborder="0" scrolling="no" src="'+j+'"></iframe>'}this.fireEvent("open")},close:function(j){if(TED.Editor&&TED.Editor.Status.isPicassoOpen===true&&j!==true){var k=this;var i=$.dialog.confirm('<div id="maincontent" style="position:absolute;"><img style="margin:10px 10px 10px 10px;width:68px;height:68px;" src="http://static.tieba.baidu.com/tb/editor/v2/picasso/alarm.gif" /><div id="tipscontent" style="position:absolute;left:100px;top:15px;width:270px;font-size:14px;font-family:\u5b8b\u4f53"><b>\u60a8\u6b63\u5728\u7f16\u8f91\u6d82\u9e26\uff0c\u73b0\u5728\u9000\u51fa\u5c06\u4e0d\u4f1a\u4fdd\u5b58\uff0c\u60a8\u786e\u5b9a\u8981\u9000\u51fa\uff1f</b></div></div>',{title:"\u6d82\u9e26\u7f16\u8f91\u5668",acceptValue:"\u786e\u5b9a",cancelValue:"\u53d6\u6d88"});i.width(420);i.height(90);i.bind("onaccept",function(){TED.Editor.Status.isPicassoOpen=false;if(k.picassoPanel){k.picassoPanel.destroy();k.picassoPanel=null}k.isOpen=false;k.content.innerHTML="";k.holder.style.display="none";if(k.currentOpen){k.currentOpen.className=k.currentOpen.className.replace(" open","");k.currentOpen=null}k.fireEvent("close")})}else{if(j==true){TED.Editor&&(TED.Editor.Status.isPicassoOpen=false)}this.isOpen=false;this.content.innerHTML="";this.holder.style.display="none";if(this.currentOpen){this.currentOpen.className=this.currentOpen.className.replace(" open","");this.currentOpen=null}this.fireEvent("close")}},toggle:function(n,m,l,i,o,j,k){if(this.currentOpen&&this.currentOpen===k){this.close()}else{k.className=k.className+" open";this.currentOpen=k;this.open(n,m,l,i,o,j)}}});window.TED["augmentObject"]=c;function c(k,j){for(var i in j){if(j.hasOwnProperty(i)){k[i]=k[i]!==undefined?k[i]:j[i]}}}var e={get:function(j,l,i){var k=this.getXHR();k.open("GET",j,true);k.setRequestHeader("cache",false);k.onreadystatechange=function(){if(k.readyState!==4){return}if(k.status==200){if(typeof l==="function"){l(k.responseText)}}else{if(typeof i==="function"){i(k.statusText)}}k=null};k.send(null)},getXHR:(function(){if(window.XMLHttpRequest){return function(){return new window.XMLHttpRequest()}}else{if(window.ActiveXObject){return function(){return new window.ActiveXObject("Microsoft.XMLHTTP")}}else{throw"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301AJAX!"}}})()};window.TED["SimpleAjax"]=e;var g=(function(){var k="tieba";function o(p){return p.replace(/[_\s]/g,function(q){return q=="_"?"__":"_s"})}function l(){return document.getElementById(k+"-storage")}function n(p){return{}.toString.call(p)==="[object Date]"&&p.toString()!=="Invalid Date"&&!isNaN(p)}function j(){var p;if(window.localStorage){p=m()}else{if(window.ActiveXObject){p=i()}}return p}function i(){var p=document.createElement("div");p.style.display="none";p.id=k+"-storage";document.body.appendChild(p);l().addBehavior("#default#userData");return{set:function(r,t,q){var s=l(),w=o(r),v=q&&q.expires?q.expires:new Date().getTime()+365*24*60*60*1000;n(v)&&(v=v.getTime());s.expires=new Date(v).toUTCString();try{s.setAttribute(w,t);s.save(w)}catch(u){throw"baidu.data.storage.set error! Maybe space overflow."}s=null},get:function(q){var r=l(),u=o(q),t=null;try{r.load(u);t=r.getAttribute(u);return t}catch(s){throw s.message}},del:function(q){var r=l(),u=o(q),t;try{r.load(u);t=r.getAttribute(u);if(t){r.removeAttribute(u);r.expires=new Date(315532799000).toUTCString();r.save(u);return true}else{return false}}catch(s){return false}}}}function m(){return{set:function(q,r,p){var v=window.localStorage,u=o(q),t=p&&p.expires?p.expires:0;n(t)&&(t=t.getTime());try{v.setItem(u,t+"|"+r)}catch(s){throw"baidu.data.storage.set error! Maybe space overflow."}},get:function(q){var v=window.localStorage,u=o(q),t=null,p,s;try{t=v.getItem(u)}catch(r){return null}if(t){p=t.indexOf("|");s=parseInt(t.substring(0,p),10);if(new Date(s).getTime()>new Date().getTime()||s==0){t=t.substring(p+1,t.length);return t}else{t=null;this.del(q);return null}}else{return null}},del:function(p){var t=window.localStorage,s=o(p),r=null;try{r=t.getItem(s)}catch(q){return false}if(r){r=r.substring(r.indexOf("|")+1,r.length);r&&t.removeItem(s);return true}else{return false}}}}return{set:function(q,s,t,p){var r=this;!r._storage&&(r._storage=j());r._storage.set.apply(r._storage,arguments)},get:function(p){var q=this;!q._storage&&(q._storage=j());return q._storage.get.apply(q._storage,arguments)},remove:function(p,r){var q=this;!q._storage&&(q._storage=j());return q._storage.del.apply(q._storage,arguments)},isSupport:function(){return !!(window.localStorage||window.ActiveXObject)}}})();window.TED["Storage"]=g})();;(function(){var extend=TED.extend,EventDispatcher=TED.EventDispatcher,Event=TED.Event,Overlay=TED.Overlay,augmentObject=TED.augmentObject,Ajax=TED.SimpleAjax,Storage=TED.Storage;window.TED["EditorPlugins"]=window.TED["EditorPlugins"]||{};window.TED["EditorPlugins"]["Refer"]=Refer;function Refer(attrs){attrs=attrs||{};augmentObject(attrs,this.constructor.defaultConfig);this.config=attrs}Refer.defaultConfig={checkDelay:100,offsetLeft:1,offsetTop:18,dataUrl:"/at-sug",uid:null};Refer.prototype={constructor:Refer,disabled:false,boxWrapper:null,init:function(editor){editor.on("keydown",this.onEditorKeydown,this);editor.on("keyup",this.onEditorKeyup,this);editor.on("click",this.onEditorClick,this);editor.on("blur",function(){this.hide()},this);this.box=new Box(editor.editAreaWrapper);this.box.on("select",this.onSelect,this);this.data=new Data(this.config.dataUrl,this.config.uid);this.data.on("datachange",this.box.update,this.box);this.editor=editor},destroy:function(){},enable:function(){this.disabled=false},disable:function(){this.disabled=true},query:function(key){this.data.getData(key)},onSelect:function(value){var el=this.editor.getSelectedElement();if(value!==null){el.innerHTML="@"+value}this.breakMode(32)},onEditorKeydown:function(e){if(this.disabled){return}if(this.box.isShow){switch(e.keyCode){case 38:this.box.pre();break;case 40:this.box.next();break;case 13:this.onSelect(this.box.getValue());this.box.hide();break;default:return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}e.exitFunction=true}},onEditorKeyup:function(e){if(this.disabled){return}var code=e.keyCode;if((code===50&&e.shiftKey)||(code===50&&this.lastUpCode===16)){this.checkEnterMode()}var that=this;clearTimeout(this.timer);this.timer=setTimeout(function(){that.checkShowBox()},this.config.checkDelay);this.lastUpCode=e.keyCode},onEditorClick:function(){var that=this;clearTimeout(this.timer);this.timer=setTimeout(function(){that.checkShowBox()},this.config.checkDelay)},checkEnterMode:function(){var that=this.editor;var s=that.getSelection(),r,c;if(that.ua.ie?s.type.toLowerCase()!=="none":!s.isCollapsed){return}r=that.getRange();if(that.ua.ie){if(this.editor.isEmpty()){return}r.moveStart("character",-1);r.select();c=r.text}else{var con=r.startContainer,offset=r.startOffset;if(con.nodeType===1&&offset>0){con=con.childNodes[offset-1];offset=con.length}if(con.nodeType===3&&offset>0){r.setStart(con,offset-1);s.removeAllRanges();s.addRange(r);c=s.toString()}}var el=that.getSelectedElement();if(c==="@"&&(el.className!=="at"||el.innerHTML!=="@")){that.execCommand("inserthtml",'<span class="at">@</span>')}else{if(that.ua.ie){r.collapse(false);r.select()}else{s.collapseToEnd()}}},checkShowBox:function(){var el=this.editor.getSelectedElement(),value=el.innerHTML,key;if(el.className==="at"&&value.charAt(0)==="@"){key=value.substring(1).replace(/<br.*>$/i,"");if(key.search(/[^\w\u4E00-\u9FA5]/)===-1){this.show(el.offsetLeft+this.config.offsetLeft-this.editor.editArea.scrollLeft,el.offsetTop+this.config.offsetTop-this.editor.editArea.scrollTop);this.query(key)}else{this.hide()}}else{this.hide()}},hide:function(){this.box.hide();this.data.getting=null},show:function(x,y){this.box.show(x,y)},breakMode:function(charcode){var that=this.editor,el=that.getSelectedElement(),node,r;if(charcode===32){node=document.createElement("span");node.innerHTML="&nbsp;";node=node.firstChild}else{node=document.createTextNode(String.fromCharCode(charcode))}if(el.nextSibling){el.parentNode.insertBefore(node,el.nextSibling)}else{el.parentNode.appendChild(node)}if(that.ua.ie){r=document.selection.createRange();r.moveEnd("character",1);r.collapse(false);r.select()}else{s=window.getSelection();r=document.createRange();r.selectNode(node);s.removeAllRanges();s.addRange(r);s.collapseToEnd()}}};function Box(container){Box.superclass.call(this);this.container=container;this.holder=document.createElement("div");this.holder.innerHTML='<span class="box-title">\u60f3\u7528@\u63d0\u5230\u8c01\uff1f<span>';this.holder.className="box-holder";this.holder.style.display="none";this.ul=document.createElement("ul");this.ul.className="box-ul-empty";this.holder.appendChild(this.ul);container.appendChild(this.holder);this.initEvents()}extend(Box,EventDispatcher,{isShow:false,index:null,length:0,initEvents:function(){var that=this;this.bindClick=function(){that.onClick.apply(that,arguments)};this.bindMousedown=function(){that.onMousedown.apply(that,arguments)};Event.addEvent(this.ul,"click",this.bindClick);Event.addEvent(this.ul,"mousedown",this.bindMousedown)},onMousedown:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},onClick:function(e){var target=e.target||e.srcElement;if(target.tagName.toLowerCase()==="li"){this.fireEvent("select",null,[target.innerHTML]);this.hide()}},update:function(data){if(!this.isShow){return}if(data.length===0){this.ul.innerHTML="";this.ul.className="box-ul-empty"}else{this.ul.className="";this.ul.innerHTML='<li unselectable="on">'+data.join('</li><li unselectable="on">')+"</li>"}this.length=data.length},pre:function(){if(this.length===0){return}if(this.index===null){this.select(this.length-1)}else{this.select(this.index===0?this.length-1:this.index-1)}},next:function(){if(this.length===0){return}if(this.index===null){this.select(0)}else{this.select(this.index===this.length-1?0:this.index+1)}},select:function(index){if(this.index!==null){this.ul.childNodes[this.index].className=""}this.ul.childNodes[index].className="focus";this.index=index},getValue:function(){return this.index!==null?this.ul.childNodes[this.index].innerHTML:null},show:function(x,y){if(this.isShow){if(x===this.x&&y===this.y){return}else{this.reset()}}else{this.holder.style.display="block";this.isShow=true}this.holder.style.left=x+"px";this.holder.style.top=y+"px";this.x=x;this.y=y},hide:function(){if(!this.isShow){return}this.reset();this.holder.style.display="none";this.isShow=false},reset:function(){this.ul.innerHTML="";this.length=0;this.ul.className="box-ul-empty"}});function Data(url,uid){Data.superclass.call(this);this.url=url;this.uid=uid}extend(Data,EventDispatcher,{dataCache:{},queryCache:{},data:null,getData:function(key){if(this.getting===key){return}this.getting=key;if(key===""){this.setData([],true);return}if(this.dataCache[key]){this.setData(this.dataCache[key],true);return}if(this.queryCache[key]){return}this.queryCache[key]=true;var that=this;Ajax.get(this.url+"?query="+encodeURIComponent(key)+"&uid="+this.uid+"&ie=utf-8",function(data){delete that.queryCache[key];data=that.parseData(data);that.dataCache[key]=data;that.setData(data,key===that.getting)},function(error){delete that.queryCache[key];that.fireEvent("error",[error])})},setData:function(value,need){this.data=value;if(need){this.fireEvent("datachange",null,[value])}},parseData:function(data){try{data=eval("("+data+")");if(data.error===0){return data.msg}else{throw new Error("\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff1a"+data.error)}}catch(e){throw new Error("\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\u683c\u5f0f\u6709\u8bef\uff01")}}})})();;(function(){var f=TED.extend,c=TED.EventDispatcher,b=TED.EditorPlugins.Refer;function e(g){e.superclass.call(this);this.init(g||{})}e.defaultConfig={height:"200px",width:"400px",maxHeight:null,autoFocus:true,autoEnable:true,autoHeight:false,editAreaClassName:"tb-editor-editarea",editAreaWrapperClassName:"tb-editor-editarea-wrapper",wrapperClassName:"tb-editor-wrapper",disabledEditAreaClassName:"tb-editor-editarea disabled",disabledWrapperClassName:"tb-editor-wrapper disabled",imageClassName:"BDE_Image",smileyClassName:"BDE_Smiley",emptyClassName:"BDE_Empty",musicClassName:"BDE_Music",didaDelay:300,imageWidthLimit:560};e.ResizeImage=function(h){h.removeAttribute("onload");h.removeAttribute("onerror");if(h.width>e.defaultConfig.imageWidthLimit){var i=h.width;var g=h.height;h.setAttribute("width",e.defaultConfig.imageWidthLimit);h.setAttribute("height",e.defaultConfig.imageWidthLimit*g/i);h.setAttribute("changedsize",true)}};f(e,c,{config:null,enabled:false,focused:false,autoHeighted:false,wrapper:null,editArea:null,container:null,id:null,editValidHTML:["br","embed"],submitValidHTML:["br","embed"],execCommand:function(l,k){if(!this.enabled){return false}if(!this.focused){this.focus()}var h=true,l=l.toLowerCase(),n;if(typeof this["cmd_"+l]==="function"){var g=[];for(var j=1;j<arguments.length;j++){g.push(arguments[j])}n=this["cmd_"+l].apply(this,g);h=n[0];if(n[1]){l=n[1]}if(n[2]){k=n[2]}}if(h){try{document.execCommand(l,false,k)}catch(m){throw new Error("\u6267\u884caction\u65f6\uff0c\u53d1\u751f\u5f02\u5e38\uff1a"+m.message)}}if(!this.ua.ie){this.saveRange()}},getImageNum:function(){return this.getTagNum("img",this.config.imageClassName)},getSmileyNum:function(){return this.getTagNum("img",this.config.smileyClassName)},getHtml:function(){this.fireEvent("gethtml");return this.filteSubmitHTML()},setHtml:function(g){this.editArea.innerHTML=g},enable:function(){if(!this.enabled){this.attachEvents();this.editArea.style.display="none";this.editArea.contentEditable=true;this.editArea.style.display="block";if(this.ua.gecko&&this.editArea.innerHTML===""){this.editArea.innerHTML="<br>"}this.editArea.className=this.config.editAreaClassName;this.wrapper.className=this.config.wrapperClassName;if(this.config.autoFocus){this.focus()}this.enabled=true}else{if(this.config.autoFocus&&!this.focused){this.focus()}}},disable:function(){if(!this.enabled){return}if(this.focused){this.blur()}this.detachEvents();this.editArea.contentEditable=false;this.wrapper.className=this.config.disabledWrapperClassName;this.editArea.className=this.config.disabledEditAreaClassName;this.enabled=false},focus:function(){this.editArea.focus();if(this.ua.webkit){this.resumeRange()}},blur:function(){if(!this.ua.ie){this.saveRange()}this.editArea.blur()},isEmpty:function(){return this.isEmptyContent(this.editArea.innerHTML)},enableAutoHeight:function(h){if(h&&h<=parseInt(this.config.height)){if(this.autoHeighted){this.disableAutoHeight()}return}h=h||this.config.maxHeight;if(this.ua.ie>0&&this.ua.ie<=6){var g=parseInt(this.config.height),i;if(h){i="this.scrollHeight <= "+g+' ? "'+g+'px" : (this.scrollHeight >= '+h+' ? "'+h+'px" : "auto")'}else{i="this.scrollHeight <= "+g+' ? "'+g+'px" : "auto"'}this.editArea.style.setExpression("height",i)}else{this.editArea.style.minHeight=this.config.height;this.editArea.style.height="auto";if(h){this.editArea.style.maxHeight=h+"px"}}this.autoHeighted=true},disableAutoHeight:function(){if(this.ua.ie>0&&this.ua.ie<=6){this.editArea.style.removeExpression("height")}this.editArea.style.height=this.config.height;this.autoHeighted=false},empty:function(){this.editArea.innerHTML=""},ua:function(){var j=function(m){var o=0;return parseFloat(m.replace(/\./g,function(){return(o++==1)?"":"."}))},n=navigator,l={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,caja:n.cajaVersion,secure:false,os:null},i=navigator&&navigator.userAgent,k=window&&window.location,h=k&&k.href,g;l.secure=h&&(h.toLowerCase().indexOf("https")===0);if(i){if((/windows|win32/i).test(i)){l.os="windows"}else{if((/macintosh/i).test(i)){l.os="macintosh"}}if((/KHTML/).test(i)){l.webkit=1}g=i.match(/AppleWebKit\/([^\s]*)/);if(g&&g[1]){l.webkit=j(g[1]);if(/ Mobile\//.test(i)){l.mobile="Apple"}else{g=i.match(/NokiaN[^\/]*/);if(g){l.mobile=g[0]}}g=i.match(/AdobeAIR\/([^\s]*)/);if(g){l.air=g[0]}}if(!l.webkit){g=i.match(/Opera[\s\/]([^\s]*)/);if(g&&g[1]){l.opera=j(g[1]);g=i.match(/Opera Mini[^;]*/);if(g){l.mobile=g[0]}}else{g=i.match(/MSIE\s([^;]*)/);if(g&&g[1]){l.ie=j(g[1])}else{g=i.match(/Gecko\/([^\s]*)/);if(g){l.gecko=1;g=i.match(/rv:([^\s\)]*)/);if(g&&g[1]){l.gecko=j(g[1])}}}}}}return l}(),isUCWeb:function(){var g=navigator.userAgent.toString();if(g.indexOf("X11;")>-1&&g.indexOf("Linux i686;")>-1&&g.indexOf("Gecko")>-1&&g.indexOf("Firefox")<0&&g.indexOf("Opera")<0){return true}return false},isAndroidOS:function(){var g=navigator.userAgent.toString();if(g.match(/android/i)!=null){return true}return false},isEmptyContent:function(g){if(!g){return true}return(""===g.replace(/<br[^>]*>/gi,"").replace(/<\/?(?:span|a)[^>]*>/gi,"").replace(/[\u3000\s]+/g,"").replace(/&nbsp;/g,""))},init:function(g){this.augmentObject(g,this.constructor.defaultConfig||{});this.config=g;if(this.constructor.registerInstance){this.id=this.constructor.registerInstance(this,g.id)}this.initComponents(g);this.appendToDom();this.initEvents();this.initConfig(g)},initComponents:function(g){if(g.container){if(typeof g.container==="string"){this.container=document.getElementById(g.container)}else{if(typeof g.container==="object"&&g.container.nodeType===1){this.container=g.container}}}this.container=this.container||document.body;this.editArea=document.createElement("div");this.editArea.className=g.disabledEditAreaClassName;this.wrapper=document.createElement("div");this.wrapper.className=g.disabledWrapperClassName;this.editAreaWrapper=document.createElement("div");this.editAreaWrapper.className=g.editAreaWrapperClassName;this.editArea.style.height=g.height;this.wrapper.style.width=g.width},appendToDom:function(){this.editAreaWrapper.appendChild(this.editArea);this.wrapper.appendChild(this.editAreaWrapper);this.container.appendChild(this.wrapper)},initConfig:function(g){if(g.autoHeight){this.enableAutoHeight()}if(g.enableRefer){this.addPlugin("refer",new b({uid:this.config.uid}))}if(g.autoEnable){var h=this;setTimeout(function(){h.enable();h.fireEvent("initcomplete")},10)}else{this.fireEvent("initcomplete")}},initEvents:function(){var g=this;this.bindMousedown=function(){g.onMousedown.apply(g,arguments)};this.bindMouseup=function(){g.onMouseup.apply(g,arguments)};this.bindClick=function(){g.onClick.apply(g,arguments)};this.bindDoubleclick=function(){g.onDoubleclick.apply(g,arguments)};this.bindKeydown=function(){g.onKeydown.apply(g,arguments)};this.bindKeyup=function(){g.onKeyup.apply(g,arguments)};this.bindKeypress=function(){g.onKeypress.apply(g,arguments)};this.bindPaste=function(){g.onPaste.apply(g,arguments)};this.bindBlur=function(){g.onBlur.apply(g,arguments)};this.bindFocus=function(){g.onFocus.apply(g,arguments)}},attachEvents:function(){var g=this.editArea;if(!this.ua.ie){g.addEventListener("mousedown",this.bindMousedown,false);g.addEventListener("mouseup",this.bindMouseup,false);g.addEventListener("click",this.bindClick,false);g.addEventListener("dblclick",this.bindDoubleclick,false);g.addEventListener("keypress",this.bindKeypress,false);g.addEventListener("keyup",this.bindKeyup,false);g.addEventListener("keydown",this.bindKeydown,false);g.addEventListener("paste",this.bindPaste,false);g.addEventListener("blur",this.bindBlur,false);g.addEventListener("focus",this.bindFocus,false)}else{g.attachEvent("onmousedown",this.bindMousedown);g.attachEvent("onmouseup",this.bindMouseup);g.attachEvent("onclick",this.bindClick);g.attachEvent("ondblclick",this.bindDoubleclick);g.attachEvent("onkeypress",this.bindKeypress);g.attachEvent("onkeyup",this.bindKeyup);g.attachEvent("onkeydown",this.bindKeydown);g.attachEvent("onpaste",this.bindPaste);g.attachEvent("onbeforedeactivate",this.bindBlur);g.attachEvent("onbeforeactivate",this.bindFocus)}this.on("dida",this.onDida,this)},detachEvents:function(){var g=this.editArea;if(!this.ua.ie){g.removeEventListener("mousedown",this.bindMousedown,false);g.removeEventListener("mouseup",this.bindMouseup,false);g.removeEventListener("click",this.bindClick,false);g.removeEventListener("dblclick",this.bindDoubleclick,false);g.removeEventListener("keypress",this.bindKeypress,false);g.removeEventListener("keyup",this.bindKeyup,false);g.removeEventListener("keydown",this.bindKeydown,false);g.removeEventListener("paste",this.bindPaste,false);g.removeEventListener("blur",this.bindBlur,false);g.removeEventListener("focus",this.bindFocus,false)}else{g.detachEvent("onmousedown",this.bindMousedown);g.detachEvent("onmouseup",this.bindMouseup);g.detachEvent("onclick",this.bindClick);g.detachEvent("ondblclick",this.bindDoubleclick);g.detachEvent("onkeypress",this.bindKeypress);g.detachEvent("onkeyup",this.bindKeyup);g.detachEvent("onkeydown",this.bindKeydown);g.detachEvent("onpaste",this.bindPaste);g.detachEvent("onbeforedeactivate",this.bindBlur);g.detachEvent("onbeforeactivate",this.bindFocus)}this.remove("dida",this.onDida)},onMousedown:function(g){if(g.target&&g.target.tagName==="IMG"){if(g.preventDefault){g.preventDefault()}}this.fireEvent("mousedown",null,[g]);if(g.exitFunction){return}},onMouseup:function(g){this.fireEvent("mouseup",null,[g]);if(g.exitFunction){return}if(!this.ua.ie){this.saveRange()}},onClick:function(g){this.fireEvent("click",null,[g]);if(g.exitFunction){return}},onDoubleclick:function(g){this.fireEvent("doubleclick",null,[g]);if(g.exitFunction){return}},onKeydown:function(h){this.fireEvent("keydown",null,[h]);if(h.exitFunction){return}if(h.keyCode===8){if(this.ua.ie){var g=this.getRange();if(g.item){g.item(0).outerHTML="";h.returnValue=false}}}},onKeypress:function(i){this.fireEvent("keypress",null,[i]);if(i.exitFunction){return}var g=i.keyCode;switch(g){case 13:if(this.ua.ie){var h=this.getRange();if(h){h.pasteHTML("<br>");h.collapse(false);h.select()}i.returnValue=false}else{if(this.ua.webkit){document.execCommand("insertlinebreak");i.preventDefault()}}break}},onKeyup:function(g){this.fireEvent("keyup",null,[g]);if(g.exitFunction){return}if(!this.ua.ie){this.saveRange()}if(g.stopPropagation){g.stopPropagation()}},onPaste:function(h){this.fireEvent("paste",null,[h]);if(h.exitFunction){return}if(this.ua.ie){this.doPasteIE(h);this.fireEvent("afterpaste",null,[h])}else{var g=this;setTimeout(function(){g.doPaste();g.fireEvent("afterpaste",null,[h])},5)}},didaTimer:null,savedHeight:null,startDida:function(){var g=this;this.didaTimer=setInterval(function(){g.fireEvent("dida")},this.config.didaDelay)},stopDida:function(){clearInterval(this.didaTimer)},onDida:function(){if(this.autoHeighted){if(this.savedHeight===null){this.savedHeight=this.wrapper.scrollHeight;return}var g=this.wrapper.scrollHeight;if(this.savedHeight&&g!==this.savedHeight){this.fireEvent("heightChanged",null,[g,g-this.savedHeight]);this.savedHeight=g}}},onBlur:function(g){this.stopDida();this.focused=false;this.fireEvent("blur",null,[g]);if(g.exitFunction){return}if(this.ua.ie){this.saveRange()}},onFocus:function(g){this.startDida();this.focused=true;this.fireEvent("focus",null,[g]);if(g.exitFunction){return}this.resumeRange()},augmentObject:function(i,h){for(var g in h){if(h.hasOwnProperty(g)){i[g]=i[g]!==undefined?i[g]:h[g]}}},getSelection:function(){return window.getSelection?window.getSelection():document.selection},getRange:function(){return this.ua.ie?document.selection.createRange():window.getSelection().getRangeAt(0)},createRange:function(){return this.ua.ie?document.body.createTextRange():document.createRange()},getSelectedElement:function(){var g=this.getRange();if(this.ua.ie){return g.item?g.item(0):g.parentElement()}var h=g.commonAncestorContainer;if(h.nodeType===3){h=h.parentNode}return h},doPasteIE:function(g){var h=clipboardData.getData("Text");if((!h)||h==""){return true}h=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g,"&nbsp;").replace(/\u3000/g,"&nbsp;&nbsp;");this.execCommand("inserthtml",h);g.returnValue=false},doPaste:function(){this.saveCursor();this.editArea.innerHTML=this.filteEditHTML();this.ensureCursor()},filteEditHTML:function(){return html=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(/<\/ ?tr[^>]*>/gi,"[br]").replace(/<\/ ?td[^>]*>/gi,"&nbsp;&nbsp;").replace(/<(ul|dl|ol)[^>]*>/gi,"[br]").replace(/<(li|dd)[^>]*>/gi,"[br]").replace(/<p [^>]*>/gi,"[br]").replace(new RegExp("<(/?(?:"+this.editValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(new RegExp('<span([^>]*class="?at"?[^>]*)>',"gi"),"[span$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.emptyClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+'"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.editValidHTML.join("|")+"|img|span)[^\\]]*)\\]","gi"),"<$1>").replace(/\r?\n/gi,"<br>")},filteSubmitHTML:function(){this.reLayout(true);var o=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+this.submitValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(/<strong[^>]*>/gi,"[strong]").replace(/<\/strong[^>]*>/gi,"[/strong]").replace(/<b[^>]*>/gi,"[strong]").replace(/<\/b[^>]*>/gi,"[/strong]").replace(new RegExp('<span([^>]*class="?edit_font_normal"?[^>]*)>@</span>',"gi"),"@").replace(/<span([^>]*)>/gi,"[span$1]").replace(/<\/span[^>]*>/gi,"[/span]").replace(/<font[^>]*color=(\")?#E10602(\")?[^>]*>/gi,'[span class="edit_font_color"]').replace(/<font[^>]*color=(\")?#333333(\")?[^>]*>/gi,'[span class="edit_font_normal"]').replace(/<font[^>]*>/gi,'[span class="edit_font_normal"]').replace(/<\/font[^>]*>/gi,"[/span]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.submitValidHTML.join("|")+"|img|span|strong)[^\\]]*)\\]","gi"),"<$1>").replace(new RegExp("<span[^>]*>@</span>","gi"),"@").replace(new RegExp("<span[^>]*>@(.*?)</span>","gi"),"@$1 ");var m=document.createElement("div");m.innerHTML=o;var g=m.getElementsByTagName("span"),k=[],q,p,l,h;for(l=0,h=g.length;l<h;l++){if(g[l].className==="edit_font_normal"){k.push(g[l])}}for(l=0,h=k.length;l<h;l++){p=k[l];q=document.createDocumentFragment();while(p.firstChild){q.appendChild(p.firstChild)}p.parentNode.replaceChild(q,p)}this.parseURL(m);return m.innerHTML},filteHTML:function(h,g){return h.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+g.join("|")+")[^>]*)>","gi"),"[$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+g.join("|")+")[^\\]]*)\\]","gi"),"<$1>")},selectNodeContents:function(h,j){if(!h){return}var g,i;if(this.ua.ie){g=document.body.createTextRange();g.moveToElementText(h);if(j){g.collapse(false)}g.select()}else{i=this.getSelection();g=document.createRange();g.selectNodeContents(h);i.removeAllRanges();i.addRange(g);if(j){i.collapseToEnd()}}},hasSelection:function(){var g=this.getSelection();if(this.ua.ie){if(g.type){return g.type.toLowerCase()!=="none"}else{return false}}else{if(this.ua.opera){var h=this.getRange();return !(g.isCollapsed&&h.startContainer&&h.startContainer===h.endContainer&&h.startOffset===h.endOffset)}else{return !g.isCollapsed}}},saveCursor:function(){if(!this.focused){return}var g=document.getElementById("editor-tmp-img");if(g){g.parentNode.removeChild(g)}this.execCommand("inserthtml",'<img class="'+this.config.emptyClassName+'" id="editor-tmp-img" style="width:1px;height:1px">')},ensureCursor:function(){if(!this.focused){this.focus()}var h=document.getElementById("editor-tmp-img");if(h){if(this.ua.ie&&(!document.documentMode||document.documentMode<9)){this.selectNodeContents(h);this.execCommand("delete")}else{var g=document.createRange();g.selectNode(h);var i=window.getSelection();i.removeAllRanges();i.addRange(g);this.execCommand("delete")}}},savedRange:null,saveRange:function(){this.savedRange=this.getRange()},resumeRange:function(g){g=g||this.savedRange;if(!g){return false}if(this.ua.ie){try{g.select()}catch(i){}}else{var h=this.getSelection();h.removeAllRanges();h.addRange(g)}},cmd_inserthtml:function(g){if(this.ua.ie){var h=this.getRange();if(h.item){h.item(0).outerHTML=g}else{h.pasteHTML(g)}return[false]}return[true]},insertImage:function(g,i,p,l,h,q){var m="";if(typeof l!=="undefined"){m=l}var o=' onload="TED.EditorCore.ResizeImage(this);"';if(h>0){if(h>e.defaultConfig.imageWidthLimit){var s=h;var n=q;h=e.defaultConfig.imageWidthLimit;q=e.defaultConfig.imageWidthLimit*n/s}o=' height="'+q+'" width="'+h+'"'}if(this.ua.ie===8){this.execCommand("inserthtml",'<img unselectable="on"  pic_type="'+m+'"  class="'+i+'" id="editor-tmp-img" src="'+g+'" '+o+">");var j=document.getElementById("editor-tmp-img");j.removeAttribute("id");if(j.parentNode.lastChild===j){var r=document.createElement("br");j.parentNode.appendChild(r);var k=document.body.createTextRange();k.moveToElementText(r);if(p){k.collapse(false)}else{k.collapse(true)}k.select()}else{if(p){this.execCommand("insertlinebreak")}}}else{this.execCommand("inserthtml",'<img unselectable="on"   pic_type="'+m+'" class="'+i+'" src="'+g+'" '+o+">");if(p){this.execCommand("insertlinebreak")}}},cmd_insertlinebreak:function(){if(this.ua.webkit){document.execCommand("insertlinebreak",false,null)}else{if(this.ua.gecko){document.execCommand("inserthtml",false,'<br id="editor-tmp-br">');var h=document.getElementById("editor-tmp-br");h.removeAttribute("id");if(h.parentNode.lastChild===h){h.parentNode.removeChild(h);document.execCommand("inserthtml",false,'<br><br id="editor-tmp-br">');h=document.getElementById("editor-tmp-br");h.removeAttribute("id");var i=window.getSelection();var j=document.createRange();j.setStartBefore(h);j.setEndBefore(h);i.removeAllRanges();i.addRange(j)}}else{if(this.ua.ie){var g=this.getRange();if(g){g.pasteHTML("<br>");g.collapse(false);g.select()}}}}return[false]},cmd_insertsmiley:function(g){this.insertImage(g,this.config.smileyClassName);return[false]},cmd_insertimage:function(h,l,m){if(typeof h=="string"){this.insertImage(h,this.config.imageClassName,true,l)}else{if(Object.prototype.toString.apply(h)==="[object Array]"){if(m=="obj"){for(var k=0,g=h.length;k<g;k++){this.insertImage(h[k].url,this.config.imageClassName,true,l,h[k].width,h[k].height)}}else{for(var k=0,g=h.length;k<g;k++){this.insertImage(h[k],this.config.imageClassName,true,l)}}}}return[false]},cmd_focus2end:function(){var g=this.editArea;if(this.ua.ie){g.innerHTML=g.innerHTML}else{if(g.lastChild){var i=document.createRange(),h=window.getSelection();i.setStartAfter(g.lastChild);i.setEndAfter(g.lastChild);h.removeAllRanges();h.addRange(i)}else{g.focus()}}return[false]},editorPlugins:null,addPlugin:function(h,g){g.init(this);this.editorPlugins=this.editorPlugins||{};this.editorPlugins[h]=g},augmentObject:function(i,h){for(var g in h){if(h.hasOwnProperty(g)){i[g]=i[g]!==undefined?i[g]:h[g]}}},setStatsRequest:function(h){var g=new Image();window["bd_pv_"+(new Date).getTime()]=g;g.src="http://static.tieba.baidu.com/tb/img/pv.gif?fr=tb0_forum&st_mod=frspb&st_type=editor&st_value="+h+"&t="+(new Date).getTime();g=null},getTagNum:function(l,m){var h=this.editArea.getElementsByTagName(l),n=h.length;if(m){n=0;for(var k=0,g=h.length;k<g;k++){if(h[k].className===m){n++}}}return n},reLayout:function(n){var m=this.editArea.getElementsByTagName("img"),g=this.config.imageWidthLimit;var l=[];for(var k=0,h=m.length;k<h;k++){img=m[k];if(img.width===0||img.height===0){l.push(img);continue}if(n){img.removeAttribute("unselectable")}if(img.className===this.config.imageClassName){if(img.width>g){img.setAttribute("width",g);img.setAttribute("changedsize",true)}else{img.setAttribute("width",img.width)}img.setAttribute("height",img.height)}else{if(img.className===this.config.smileyClassName){if(img.width>100){img.setAttribute("width",100)}else{img.setAttribute("width",img.width)}img.setAttribute("height",img.height)}else{img.setAttribute("width",img.width);img.setAttribute("height",img.height)}}img.removeAttribute("onload")}for(var k=0,h=l.length;k<h;k++){l[k].parentNode.removeChild(l[k])}},parseURL:function(k){var h="(=*+)",g="(+*=)";var j=4;var i=function(l){if(l.nodeType==3){var m=l.nodeValue;if(m&&m.length>j){m="."+m;m=m.replace(/([^0-9a-zA-Z])((www\.|http:\/\/|mms:\/\/|rtsp:\/\/|ftp:\/\/|https:\/\/)[0-9a-zA-Z\.\!\~\#\?\:\/\&\%\-\+\*\'\=\@\_\$]+)/gi,"$1"+h+'a href="$2" target="_blank"'+g+"$2"+h+"/a"+g);m=m.substring(1);l.nodeValue=m}}else{if(l.nodeType==1){var n=l.firstChild;while(n){if(n.nodeName.toUpperCase()!="A"){i(n)}n=n.nextSibling}}}};i(k);k.innerHTML=k.innerHTML.replace(/\(\=\*\+\)a\ href="www\./gi,'<a href="http://www.').replace(/\(\=\*\+\)/gi,"<").replace(/\(\+\*\=\)/gi,">")}});window.TED["EditorCore"]=e;var a={instanceNum:0,idPrefix:"tb-editor-",registerInstance:function(g,h){this.instances=this.instances||{};h=h||this.generateID();this.instances[h]=g;return h},generateID:function(){return this.idPrefix+ ++this.instanceNum},getInstanceById:function(g){return(g&&this.instances)?this.instances[g]:null}};window.TED["EditorInstanceManager"]=a;function d(g){d.superclass.call(this);this.area=document.createElement("textarea");if(g.is_ipad){this.area.className="textarea_ipad"}this.area.style.width=g.width;this.area.style.height=g.height;if(g.autoEnable===false){this.area.disabled=true}document.getElementById(g.container).appendChild(this.area);this.init()}f(d,c,{isMobile:true,init:function(){var g=this;this.area.onfocus=function(){g.fireEvent("focus")};this.area.onclick=function(){g.fireEvent("click")};if(this.constructor.registerInstance){this.id=this.constructor.registerInstance(this)}},getImageNum:function(){return 0},getSmileyNum:function(){return 0},getFlashNum:function(){return 0},getMusicNum:function(){return 0},getHtml:function(){return this.area.value.replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\r?\n/gi,"<br>").replace(/[\u3000\s]/gi,"&nbsp;").replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;")},focus:function(){this.area.focus()},blur:function(){this.area.blur()},isEmpty:function(){var g=this.area;return !(g&&g.value&&g.value.replace(/[\u3000\s]/gi,"").replace(/\r?\n/gi,"").replace(/\t/gi,"")!="")},quoteContainer:null,quote:function(j,g,k){j=parseInt(j);if(j>1){if(this.quoteContainer===null){this.quoteContainer=document.createElement("div");this.quoteContainer.className="editor-quote";this.area.parentNode.insertBefore(this.quoteContainer,this.area)}var i=document.getElementById("post_content_"+g).innerHTML.replace(/<img[^>]*>/gi,"[\u56fe\u7247]").replace(/<embed[^>]*>/gi,"[\u89c6\u9891]").replace(/<br[^>]*>/gi," ").replace(/<a[^>]*>/gi,"").replace(/<\/a>/gi,"").subByte(270);this.quoteContainer.innerHTML='<blockquote class="quote quote_simple"><a href="javascript:void(0);" onmousedown="return false;" onclick="TED.TextInput.getInstanceById(\''+this.id+'\').unQuote();Stats.sendRequest(\'fr=tb0_forum&st_mod=pb&st_type=quote&st_value=delete\');" class="close" title="\u5220\u9664\u5f15\u7528">\u2573</a><p class="quote_title">\u5f15\u7528&nbsp;'+k+'&nbsp;(<a href="#'+g+'">'+j+'\u697c</a>)</p><p class="quote_content">'+i+"</p></blockquote>";this.quoteContainer.style.display="block";this.fireEvent("quote",null,[g])}else{this.unQuote();Stats.sendRequest("fr=tb0_forum&st_mod=pb&st_type=quote&st_value=replyfirst")}var h=this;setTimeout(function(){h.focus()},100)},unQuote:function(){if(this.quoteContainer){this.quoteContainer.style.display="none"}this.fireEvent("unquote")}});TED.augmentObject(d,a);window.TED["TextInput"]=d})();;(function(){var b=window.TED["Overlay"],a=window.TED["Event"];window.TED["EditorPlugins"]["InsertSmiley"]=c;function c(e,f){this.container=e;this.holder=document.createElement("div");this.holder.style.position="relative";this.holder.className="insertsmiley_holder";this.options=f;this.container.appendChild(this.holder)}c.prototype={init:function(f){this.editor=f;var e=this;this.overlay=new b(this.holder);_.Module.use("common/component/EditorLayer",[{container:$(this.holder)}],function(g){e.editor.overlay=g;window.PAGESMILELAYER=e.editor.overlay;a.addEvent(e.holder,"click",function(i){var h=i.target||i.srcElement;if(h===e.holder){e.clickHandler(i);if(i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}}})})},clickHandler:function(){var f={layerPos:{left:-472,top:29},layerSize:{height:315,width:552},arrowPos:{left:472,top:-7},content:{height:313},arrowType:"arrow_up",layerType:""};f=$.extend(f,this.options);var e=this;if(this.smileLayer){e.editor.overlay.toggle(f,this.smileLayer,this.editor,e.holder,"smile")}else{_.Module.use("common/component/EditorSmiley",[],function(g){e.smileLayer=g;e.editor.overlay.toggle(f,e.smileLayer,e.editor,e.holder,"smile")})}},closeOverlay:function(){this.editor.overlay.close()}};window.TED["EditorPlugins"]["WordLimit"]=d;function d(e){this.maxNum=e||130;this.holder=document.createElement("div");this.holder.className="wordlimit-holder";this.holder.style.visibility="hidden"}d.prototype={showLimit:10,checkTimer:null,checkDelay:300,isShow:false,exceed:false,init:function(e){this.editor=e;this.container=e.wrapper;this.container.appendChild(this.holder);e.on("keyup",this.handlerEvent,this);e.on("focus",this.handlerEvent,this);this.check()},handlerEvent:function(g){clearTimeout(this.checkTimer);var f=this;this.checkTimer=setTimeout(function(){f.check()},this.checkDelay)},check:function(e){var f=this.maxNum-this.editor.getContentLength();if(f<=this.showLimit){this.holder.style.visibility="visible";this.isShow=true;if(f<0){if(!this.exceed){this.editor.fireEvent("overflow");this.exceed=true}this.holder.innerHTML='\u5df2\u7ecf\u8d85\u51fa<span style="font-size:18px;font-family:Arial;color:#f00;">'+-f+"</span>\u4e2a\u5b57"}else{if(this.exceed){this.editor.fireEvent("unoverflow");this.exceed=false}this.holder.innerHTML='\u8fd8\u80fd\u8f93\u5165<span style="font-size:18px;font-family:Arial;">'+f+"</span>\u4e2a\u5b57"}}else{if(this.isShow){this.holder.style.visibility="hidden";this.isShow=false;if(this.exceed){this.editor.fireEvent("unoverflow");this.exceed=false}}}}}})();;(function(){var d=TED.EditorCore,e=TED.extend,a=TED.EditorInstanceManager,b=TED.augmentObject;window.TED["SimpleEditor"]=c;function c(f){c.superclass.call(this,f)}c.defaultConfig={height:"100px",width:"400px",maxHeight:null,autoFocus:true,autoEnable:true,autoHeight:false,wrapperClassName:"tb-simpleeditor-wrapper",editAreaClassName:"tb-editor-editarea",editAreaWrapperClassName:"tb-editor-editarea-wrapper",disabledEditAreaClassName:"tb-editor-editarea tb-editor-editarea-disabled",disabledWrapperClassName:"tb-simpleeditor-wrapper tb-simpleeditor-wrapper-disabled",imageClassName:"BDE_Image",smileyClassName:"BDE_Smiley",rootPath:"/tb/static-common/",enableRefer:true,emptyClassName:"BDE_Empty",flashClassName:"BDE_Flash",flashNumLimit:10,didaDelay:300,imageWidthLimit:570};e(c,d,{getContentLength:function(){return Math.ceil(this.filteHTML(this.editArea.innerHTML,["img","br"]).replace(/<img[^>]*>/gi,"mm").replace(/<br[^>]*>/gi,"m").replace(/&nbsp;/gi,"m").replace(/[^\x00-\xff]/g,"mm").length/2)},filteEditHTML:function(){return html=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:br)[^>]*)>","gi"),"[$1]").replace(new RegExp('<span([^>]*class="?at"?[^>]*)>',"gi"),"[span$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.emptyClassName+"|"+this.config.smileyClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:br|img|span)[^\\]]*)\\]","gi"),"<$1>")},getConfig:function(){return this.config},filteSubmitHTML:function(){this.reLayout();var g=this.editArea.innerHTML.replace(/_moz_dirty=""/gi,"").replace(/\[/g,"[[-").replace(/\]/g,"-]]").replace(new RegExp("<(/?(?:"+this.submitValidHTML.join("|")+")[^>]*)>","gi"),"[$1]").replace(new RegExp('<img([^>]*class="?(?:'+this.config.imageClassName+"|"+this.config.smileyClassName+"|"+this.config.flashClassName+"|"+this.config.musicClassName+')"?[^>]*)>',"gi"),"[img$1]").replace(/<[^>]*>/g,"").replace(/\[\[\-/g,"[").replace(/\-\]\]/g,"]").replace(new RegExp("\\[(/?(?:"+this.submitValidHTML.join("|")+"|img)[^\\]]*)\\]","gi"),"<$1>");var f=document.createElement("div");f.innerHTML=g;this.parseURL(f);return f.innerHTML}});b(c,a)})();;var SimplePostor=function(d,c){this.option=d;this._edOp_t=c;var a=PageData.user.has_grade?PageData.user.grade_level:0;this._edOp_t.bavl=a;var b=$("#"+d.tpl_id).html();this.cur_sec=c.container;this.cur_sec.innerHTML=b;var e=$(c.container);this._bc=e.find(".lzl_panel_btn");this._enabled=true;this._eh=e.find(".lzl_panel_error");this._event={};this._statInit(d._login,d._can_post,d._no_un)};SimplePostor.prototype={constructor:SimplePostor,_statInit:function(d,f,e){var a=this.option;if(!d){this._cannotPost();return}if(d&&f==1&&e){this._cannotPost();return}if(d&&f!=1){this._cannotPost();return}if(a._reach_limit){this._cannotPost();return}if(a._is_block){this._cannotPost();return}if(d&&f==1&&!e){var c=this.cur_sec;var b=$(c).find(".editor_for_container")[0];this._buildNormalEditor(b);this._postBtnInit("enble")}},_cannotPost:function(){var a=this.cur_sec;this._buildLimitedEditor(a);this._postBtnInit("disable");return},_postBtnInit:function(d){switch(d){case"disable":this._disableEditor();this._disableSmile();break;case"enble":var a=this._bc,b=this;var c=a.find("span.j_lzl_p_sm");c.css("position","relative");if(!PageData.is_ipad){this._se.addPlugin("insertsmiley",new TED.EditorPlugins.InsertSmiley(c[0]))}else{c.hide()}this._se.addPlugin("WordLimit",new TED.EditorPlugins.WordLimit(140));c=a.find("span.j_lzl_p_sb");c.hover(function(){$(this).addClass("lzl_panel_submit_hover")},function(){$(this).removeClass("lzl_panel_submit_hover lzl_panel_submit_active")});c.bind("click",function(f){$(this).addClass("lzl_panel_submit_active");b.submitClick();f.target.blur()});break}},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(a){if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){return false}}}return true},_buildLimitedEditor:function(e){var b=this;if(!b._fe){var c=$("<div>");c.addClass("lzl_simple_wrapper");var a=this._edOp_t;var d=$(b.cur_sec).find(".editor_for_container");c.css({width:b._edOp_t.width,height:b._edOp_t.height,position:"static"});c.append(b._buildLimitedInfo());b._fe=c}d.append(b._fe)},_tip:["","\u53c2\u4e0e\u672c\u5427\u8ba8\u8bba\uff0c\u8bf7\u5148 ","\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53ca\u6ce8\u518c\u6ee1\u4e00\u5b9a\u65f6\u95f4\u7684\u8001\u7528\u6237\u53d1\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8","\u62b1\u6b49\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u9650\u5427\u52a1\u56e2\u961f\u53d1\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u6d4f\u89c8\uff0c\u4e0d\u80fd\u53d1\u8d34","","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u56de\u590d\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u53ea\u80fd\u53d1\u4e3b\u9898\u8d34","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8","\u62b1\u6b49\uff0c\u6839\u636e\u76f8\u5173\u6cd5\u5f8b\u6cd5\u89c4\u548c\u653f\u7b56\uff0c\u672c\u5427\u76ee\u524d\u4ec5\u5141\u8bb8"],_buildLimitedInfo:function(){var e=$("<p>");var c='<div class="editor_banned_tip_info">',d=this.option,b=this;if(d._reach_limit){c+="<span>\u672c\u697c\u5c42\u56de\u590d\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u53c2\u4e0e\u5176\u4ed6\u697c\u5c42\u8ba8\u8bba</span>";c+="</div>";e.html(c);e.css({margin:"14px 0 0 14px"})}else{if(d._is_block){var a=["<span>"];a.push(PageUnit.load("simple_postor_blocktippart1"));a.push(PageUnit.load("simple_postor_blocktippart2"));a.push(PageUnit.load("simple_postor_blocktippart3"));a.push("</span></div>");c+=a.join("").replace(/(href=\")(.*?)(\")/,"$1$2"+PageData.forum_id+"$3");e.html(c);e.css({margin:"14px 0 0 14px"})}else{c+="<span>";if(d._can_post==1&&d._no_un){c+="\u60a8\u8fd8\u6ca1\u6709\u7528\u6237\u540d\uff0c\u4e0d\u80fd\u56de\u590d\u3002\u8bf7\u5148<a href=\"javascript:void(0)\"  onclick=\"TbCom.process('User','buildUnameFrame','\u586b\u5199\u7528\u6237\u540d',' ')\">\u586b\u5199\u7528\u6237\u540d</a>";c+="</span>";c+="</div>";e.html(c);e.css({margin:"4px 0 0 14px"})}else{c+=b._tip[d._forum_type];c+="</span>";if(d._forum_type==1){c+='<span class="lzl_login_wrapper">';c+="<a href=\"#\" onclick=\"_.Module.use('common/component/LoginDialog', ['', 'lzl']);return false;\">\u767b\u5f55</a>";c+="&nbsp;|&nbsp";c+="<a href=\"#\" onclick=\"TbCom.process('User', 'buildRegisterFrame', 'lzl');return false;\">\u6ce8\u518c</a>";c+="</span>"}else{if(d._forum_type==3){c+='<a href="http://tieba.baidu.com/f/like/level?kw=d8" >4\u7ea7\u5934\u8854</a>\u4ee5\u4e0a\u4f1a\u5458\u53d1\u8d34\u3002'}else{if(d._forum_type==9){c+="\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u56de\u590d\u8d34\u3002"}else{if(d._forum_type==10){c+="\u4e00\u5b9a\u7ea7\u522b\u4ee5\u4e0a\u4f1a\u5458\u53d1\u4e3b\u9898\u8d34\u3002"}}}}c+="</div>";e.html(c);if(d._forum_type==3||d._forum_type>=7){e.css({margin:"5px 0 0 14px"})}else{e.css({margin:"14px 0 0 14px"})}}}}return e},_buildNormalEditor:function(e){var b=this,a=b.option;var c=b._edOp_t;c.container=e;var d=new TED.SimpleEditor(c);d.on("overflow",function(){b._overFlow()});d.on("unoverflow",function(){b._unoverFlow()});d.on("keydown",function(f){b._keyDown(f)});d.on("keyup",function(f){b._keyUp(f)});b._se=d},_overFlow:function(){this._disableEditor()},_unoverFlow:function(){this._enableEditor()},_keyDown:function(a){if(a.keyCode==17){this._ctrl_down=true}else{if(a.keyCode==13&&this._ctrl_down){this.submitClick();if(a.srcElement){a.srcElement.blur()}else{a.target.blur()}}}},_disableEditor:function(){var c=this;c._enabled=false;var a=c._bc.find("span.j_lzl_p_sb");a.removeClass("lzl_panel_submit");a.html("");a.addClass("lzl_panel_submit_disabled")},_disableSmile:function(){var c=this;var a=c._bc.find("span.j_lzl_p_sm");if(PageData.is_ipad){a.hide();return}c._enabled=false;a.removeClass("lzl_panel_smile");a.html("");a.addClass("lzl_panel_smile_disabled")},_enableEditor:function(){var c=this;c._enabled=true;var a=c._bc.find("span.j_lzl_p_sb");a.removeClass("lzl_panel_submit_disabled");a.addClass("lzl_panel_submit");a.html("\u53d1\u8868")},_keyDown:function(b){var a=this;if(b.keyCode==17){a._ctrl_down=true}else{if(b.keyCode==13&&a._ctrl_down){a.submitClick();if(b.srcElement){b.srcElement.blur()}else{b.target.blur()}}}if(b.altKey&&b.keyCode==83){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}setTimeout(function(){a.submitClick()},0)}},_keyUp:function(a){if(a.keyCode==17){this._ctrl_down=false}},_ie6RelativeHack:function(){var b=this,d=$(b.cur_sec),a=this._bc;d.find("div.insertsmiley_holder").hide();var e=d.find("div.wordlimit-holder");var c=a.find("span.j_lzl_p_sm");c.css("position","static");if(e.css("visibility")!="hidden"){d.find("div.wordlimit-holder").hide();b._hint_shown=true}else{b._hint_shown=false}d.find("div.lzl_simple_wrapper").css("position","static")},_ie6RelativeRecover:function(){var b=this,d=$(b.cur_sec),a=this._bc;d.find("div.insertsmiley_holder").show();var e=d.find("div.wordlimit-holder");if(this._hint_shown){e.show()}var c=a.find("span.j_lzl_p_sm");c.css("position","relative");d.find("div.lzl_simple_wrapper").css("position","relative")},_getHtml:function(){var a=this._se.getHtml();a=a.replace(/<br[^>]*>/gi," ").replace(/[\u3000\s]+/g," ").replace(/&nbsp;/g," ");return a},_data:{},submitClick:function(){if(PageData.thread.is_ad===1){if(document.images){var b=new Image();b.src=PageData.ecomStatDomain+"reply.php?forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&userid="+(PageData.user.id||"")+"&username="+encodeURIComponent(PageData.user_name||"")+"&exp="+encodeURIComponent(PageData.ecomExp||"")+"&t="+new Date().getTime();b=null}}var a=this;var d=$(a.cur_sec),c=d.find("div.insertsmiley_holder");d.find("span.close").click();c.css("position","static");if(!this._isValid()){c.css("position","relative");return}c.css("position","relative");this._submitData()},_isValid:function(){if(!this._enabled){return false}if(this._se.isEmpty()){this._se.focus();this._eh.html("\u53d1\u8d34\u5185\u5bb9\u9700\u5305\u542b\u6587\u5b57").show();return false}if(this._se.getSmileyNum()>10){this._eh.html("\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u8868\u60c5\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4").show();return false}return true},_submitData:function(){this._eh.hide();this._disableEditor();var a=this;$.tb.post(FORUM_POST_URL.postAdd,a._getData(),function(b){a._setPostData("vcode","");a._setPostData("vcode_md5","");if(b.no==0){var c=a.triggerEvent("onsuccess");a._se.empty();if(a.option.__data__){a.option.data=a.option.__data__;a.option.__data__=null}a._enableEditor();var c=a.triggerEvent("hide")}else{a._showAddResult(b);a._enableEditor()}return false})},_setData:function(a){this.option.__data__=this.option.data;this.option.data=$.extend(this.option.data,a)},_setPostData:function(a,b){this._data[a]=b},_getData:function(){var f=this.option,a=f.data,b=this;b._data.kw=PageData.forum_name;b._data.fid=PageData.forum_id;b._data.tid=PageData.thread.id;b._data.floor_num=a.floor_num;b._data.quote_id=a.pid;b._data.rich_text=1;b._data.tbs=PageData.tbs;b._data.content=b._getHtml();b._data.lp_type=f._thread_topic_type;b._data.lp_sub_type=f._thread_topic_subtype;b._data.new_vcode=1;b._data.tag=11;if(a.spid!=undefined){b._data.repostid=a.spid}else{b._data.repostid=a.pid}if(b._no_un==true){b._data.anonymous=1}else{b._data.anonymous=0}try{var c=window.external.GetVersion("version");if(c.indexOf("baidubrowser")>-1){b._data.browser_version="baidubrowser"}}catch(d){}return b._data},_errorTipShow:function(b){var a=this;a._eh.html(b).show();a._se.focus()},_showAddResult:function(b){var a=this;var c=function(f){switch(f.getActionType()){case f.Action_FocusContent:a._se.focus();break;case f.Action_ClearYZM:break;case f.Action_GoToHead:break;case f.Action_FlushAndGoToHead:a._se.empty();break;default:break}};Thread_add_result.init(b);if(b.no!=0){if(Thread_add_result.isNeedWaitForCheck()){var e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5b8b\u4f53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/messageFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ed1\u4f53&quot;;">\u7b49\u5f85\u5ba1\u6838...</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>";var d=$.dialog.alert(e,{width:380,height:105,title:"\u53d1\u8868\u8d34\u5b50"});d.bind("onclose",function(){a._se.empty();a._se.focus();return true})}else{if(b.no==901){var e="\u672c\u697c\u5c42\u56de\u590d\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u53c2\u4e0e\u5176\u4ed6\u697c\u5c42\u8ba8\u8bba";a._errorTipShow(e)}else{if(b.no==814){var e="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u63d2\u5165\u7684\u8868\u60c5\u4e0d\u80fd\u8d85\u8fc710\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";a._errorTipShow(e)}else{if(b.no==902){var e="\u62b1\u6b49\uff0c\u6bcf\u5c42\u697c\u8f93\u5165\u7684\u6587\u5b57\u4e0d\u80fd\u8d85\u8fc7140\u4e2a\uff0c\u8bf7\u4fee\u6539\u540e\u91cd\u65b0\u63d0\u4ea4";a._errorTipShow(e)}else{if(b.no==40){if(a.captchaDialog){a.captchaDialog.setTip(b.data.vcode.str_reason);a.captchaDialog.updateCaptchaImg(b.data.vcode.captcha_vcode_str,b.data.vcode.captcha_code_type);a.captchaDialog.show();a.captchaDialog.focus()}else{_.Module.use("common/component/CaptchaDialog",{message:b.data.vcode.str_reason,vCode:b.data.vcode.captcha_vcode_str,vCodeType:b.data.vcode.captcha_code_type,forumName:a._data.kw,forumId:a._data.fid,isAnonymous:a._data.anonymous,postType:"reply",paramsCallback:function(){var f=a._getData();var g={content:f.content};g.tid=PageData.thread.id;return g}},function(f){a.captchaDialog=f;f.bind("onclose",function(){a._enableEditor();f.hide();return false});f.bind("onaccept",function(){a._setPostData("vcode",f.getInputValue());a._setPostData("vcode_md5",f.getVCode());a._submitData()});f.show()})}}else{if(Thread_add_result.isNeedBindPhone()){$.dialog.alert("<div style='margin: 15px;'>"+Thread_add_result.getMessage()+"</div>",{title:"\u53d1\u8d34\u5931\u8d25",acceptValue:"\u7ed1\u5b9a\u624b\u673a",width:410,onaccept:function(){location.href="http://passport.baidu.com/v2/?accountbindphone&tpl=tb&u="+encodeURIComponent(location.href);return false},onclose:function(){c(Thread_add_result);return true}})}else{var e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5b8b\u4f53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ed1\u4f53&quot;;">\u53d1\u8d34\u5931\u8d25</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>";var d=$.dialog.alert(e,{width:410,height:95,title:"\u53d1\u8868\u8d34\u5b50"});d.bind("onclose",function(){c(Thread_add_result);return true})}}}}}}}}};window.Common_GoTop=function(e){var c=false,b={id:"goTop","class":"goTop goTop_self",href:"#"},d="<style>html{_background:url(about:blank) fixed;}</style>";if($.browser.msie&&$.browser.version<7){b["class"]+=" goTop_ie6";$("body").append(d)}$("<a>").attr(b).bind("click",function(){Common_ToTop(e);return false}).appendTo("body");var f=$("#goTop");var a=$("#container").offset().left-f.width()-5;if(a<0){f.addClass("goTop_1024")}var g;setTimeout(function(){$(window).bind("scroll",function(){if(g){clearTimeout(g)}g=setTimeout(function(){if($(window).scrollTop()>0){if(!c){f.fadeIn(500);c=true}}else{if(c){f.fadeOut();c=false}}},500)})},500)};window.Common_ToTop=function(b){var d=null;var c=$(window).scrollTop();if($.browser.msie||b){window.scrollTo(0,0)}else{function a(){c=Math.floor(c/2);window.scrollTo(0,c);if(c>2){d=setTimeout(a,40)}else{window.scrollTo(0,0);clearTimeout(d)}}a()}};_.Module.define({path:"pb/component/NoAutoVideo",requires:["common/component/MusicPlayer"],sub:{_configs:{},initial:function(a){if(a!=null){this._configs=$.extend(this._configs,a)}this.postWrapper=$("#j_p_postlist");this.videoElem=null;this.run()},run:function(){this._delMusic();if(PageData.is_ipad){this._delIpadFlash()}else{this._delFlash()}},_getSearch:function(a){return a.replace(/http:\/\/box\.baidu\.com\/widget\/flash\/bdspacesong\.swf\?/g,"")},_getSearchValue:function(c,e){var f=e.replace(/^\?/,""),g={};if(!f){return c===undefined?g:undefined}f=f.split("&amp;");var b;for(var d=0,a=f.length;d<a;d++){b=f[d].indexOf("=");if(b>0){g[f[d].substring(0,b)]=f[d].substring(b+1)}else{g[f[d]]=""}}return c===undefined?g:g[c]},_delMusic:function(){var b=this.postWrapper.find(".BDE_Music"),a=this,c=0;$.each(b,function(g,i){var j=$.tb.escapeHTML($(i).attr("src"));var h=a._getSearch(j);var d=a._getSearchValue("song_id",h);if(d){var e=$('<div class="musicbox_con"></div>');$(i).replaceWith(e);if(a.musicPlayer){a.musicPlayer.mboxInit(e,d,c)}else{a.musicPlayer=a.use("common/component/MusicPlayer",[],[]);a.musicPlayer.mboxInit(e,d,c)}c++}else{j=j.replace(/autoplay=false/ig,"autoPlay=true");var f=$('<img style="cursor:pointer;display:block;" src="http://tb2.bdstatic.com/tb/static-pb/img/no_music_auto.png">');$(i).replaceWith(f);f.bind("click",function(){var k=a._genericMusicImage(j);$(this).fadeOut(100,function(){$(this).replaceWith(k)})})}})},_genericMusicImage:function(b){var a='<embed width="402" height="95" class="BDE_Music" src="'+b+'" scale="noborder" allowscriptaccess="never" menu="false" loop="false" play="true" wmode="transparent" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" allowfullscreen="true" style="display:block;">';return $(a)},_delIpadFlash:function(){var a=this,b=this.postWrapper.find(".BDE_Flash");$.each(b,function(d,f){if($(f).attr("id")=="voteFlash"){return true}var g=$(f).attr("vsrc"),e=null;if(g&&g!==""){g=$.tb.escapeHTML(g);e=a._getReplaceElem($(f).attr("vpic"));var c=$('<a target="_blank" href="'+g+'"></a>');c.append(e);$(f).replaceWith(c);c.bind("click",function(h){h.preventDefault();window.open($(this).attr("href"))})}else{e=$('<img src="http://tb2.bdstatic.com/tb/static-pb/img/noflash.png" alt="\u8be5\u8bbe\u5907\u6682\u4e0d\u652f\u6301\u6b64\u89c6\u9891\u64ad\u653e">');$(f).replaceWith(e)}})},_delFlash:function(){var b=this,c=this.postWrapper.find(".BDE_Flash");if(c.length<1){return}var a=true;$.each(c,function(f,i){if($(i).attr("id")=="voteFlash"){return true}var e=b._getAttrs(i);var h=e.vsrc;var g=false;if(PageData.thread.is_ad===1&&a){var j=$(i).parents("div.l_post");var d=j.getData();if(d.content.floor==1||d.content.floor==2){g=true}else{a=false}}if(g){b.videoElem=b._getAdReplaceElem()}else{b.videoElem=b._getReplaceElem(e.vpic)}$(i).replaceWith(b.videoElem);b._bindPlayEvent(e)})},_getReplaceElem:function(a){var c,b=this;if(a){c=b._getVideoPic(a)}else{c=b._getBaiduPicElem(a)}return c},_getVideoPic:function(a){var b='<div class="vpic_wrap"><img class="vpic_img" src="'+a+'"/><span class="vpic_play"></span></div>';var c=$(b);c.hover(function(){$(this).addClass("vpic_hover")},function(){$(this).removeClass("vpic_hover")});return c},_getBaiduPicElem:function(a){var b="http://tb2.bdstatic.com/tb/static-pb/img/no_autovideo_1.png",d="http://tb2.bdstatic.com/tb/static-pb/img/no_autovideo_2.png",c=$(document.createElement("img"));c.attr("src",b);c.css("cursor","pointer");c.hover(function(){$(this).attr("src",d)},function(){$(this).attr("src",b)});return c},_getAdReplaceElem:function(){var c=$(document.createElement("div"));c.attr({id:"ad_video_area","class":"ad_video_area"});var b=$('<div class="ad_video_bg"></div>');b.css({background:"url('"+(PageData.thread.video_url||"")+"')"});var a=$('<div class="ad_play_btn"></div>');c.append(b).append(a).append($('<div class="ad_play_bar"></div>'));c.hover(function(){a.css({"background-position":"0 -64px"})},function(){a.css({"background-position":"0 0"})});c.bind("click",function(){if(document.images){var d=new Image();d.src=PageData.ecomStatDomain+"video.php?page=pb&forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&t="+new Date().getTime();d=null}});return c},_getAttrs:function(b){var a={};a.src=$.tb.escapeHTML($(b).attr("src"));a.width=$(b).attr("width");a.height=$(b).attr("height");a.scale=$(b).attr("scale");a.allowscriptaccess=$(b).attr("allowscriptaccess");a.menu=$(b).attr("menu");a.loop=$(b).attr("loop");a.play=$(b).attr("play");a.wmode=$(b).attr("wmode");a.type=$(b).attr("type");a.pluginspage=$(b).attr("pluginspage");a.allowfullscreen=$(b).attr("allowfullscreen");a.flashvars="playMovie=true&auto=1&adss=0&isAutoPlay=true";a.vsrc=$.tb.escapeHTML($(b).attr("vsrc")||"");a.vpic=$.tb.escapeHTML($(b).attr("vpic")||"");return a},_bindPlayEvent:function(b){var a=this,c=a.videoElem;if($.browser.msie){c.bind("click",function(){var e;var d=b.src.match(/[\w]+\.[\w]+(?=\/)/i)[0];if(d!=null&&d.indexOf("cntv")>=0){e=$(a._createVideoTagForOtherBrowser(b))}else{e=$(a._createVideoTagForIEBrowser(b))}$(this).replaceWith($(e));$(e).css("display","block");a._clickStats(b.src)})}else{c.bind("click",function(){var d=a._createVideoTagForOtherBrowser(b);var e=$(d);$(this).replaceWith($(e));$(e).css("display","block");a._clickStats(b.src)})}},_createVideoTagForOtherBrowser:function(a){var b=new Array();b.push('<embed type="'+a.type+'" ');b.push(' class="BDE_Flash"');b.push(' src="'+a.src+'"');b.push(' width="'+a.width+'"');b.push(' height="'+a.height+'"');b.push(' scale="'+a.scale+'"');b.push(' allowscriptaccess="never"');b.push(' menu="'+a.menu+'"');b.push(' loop="'+a.loop+'"');b.push(' play="true"');b.push(' womode="'+a.wmode+'"');b.push(' pluginspage="'+a.pluginspage+'"');b.push(' allowfullscreen="true"');b.push(' flashvars="'+a.flashvars+'"');b.push(' style="visibility:visible;">');b.push("</embed>");return b.join("")},_createVideoTagForIEBrowser:function(c){var b=this;var e='<object style="visibility:visible" class="BDE_Flash" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,22,0" width="'+c.width+'" height="'+c.height+'">';var a=new Array();a.push('<param name="FlashVars" value="'+c.flashvars+'">');a.push('<param name="Movie" value="'+c.src+'">');a.push('<param name="Src" value="'+c.src+'">');a.push('<param name="WMode" value="Transparent">');a.push('<param name="Play" value="0">');a.push('<param name="Loop" value="-1">');a.push('<param name="Quality" value="High">');a.push('<param name="Menu" value="0">');a.push('<param name="AllowScriptAccess" value="never">');a.push('<param name="Scale" value="NoScale">');a.push('<param name="DeviceFont" value="0">');a.push('<param name="EmbedMovie" value="0">');a.push('<param name="BGColor" value="">');a.push('<param name="MovieData" value="">');a.push('<param name="AllowNetworking" value="all">');a.push('<param name="AllowFullScreen" value="true">');a.push(b._createVideoTagForOtherBrowser(c));var d=a.join("");return e+d+"</object>"},_clickStats:function(c){var a=c.match(/http:\/\/([^\/]*)\/.*/);if(a!=null&&a[1]!=null){var b=a[1];$.stats.sendRequest("fr=tb0_forum&st_type=videoclick&st_mod=pb&provider="+b)}}}});_.Module.define({path:"pb/component/UserVerify",sub:{pointCutConfig:null,initial:function(){if(PageData.is_uber){this.pointCutConfig=[];if(PageData.thread.thread_type!=1){this.pointCutConfig=this.pointCutConfig.concat([{target:"pb/component/Favthread",method:"excute_open_remind",loginframe_mark:"pbfavt"},{target:"pb/component/Favthread",method:"excute_open_kept",loginframe_mark:"pbfavt"},{target:"pb/component/Favthread",method:"excute_cancel_remind",loginframe_mark:"pbfavt"},{target:"pb/component/Favthread",method:"excute_cancel_kept",loginframe_mark:"pbfavt"},{target:"pb/component/Favthread",method:"handler_clickmain",loginframe_mark:"pbfavt"}])}}else{this.pointCutConfig=[{target:"pb/component/Posts/Concern",method:"excute",loginframe_mark:"concern"},{target:"pb/component/Posts/Concern",method:"cancel",loginframe_mark:"concern"}]}this.init()},init:function(){$.each(this.pointCutConfig,function(b,a){_.Module.aop("around",{target:a.target,method:a.method},function(c){if(PageData.user.is_login){return c.proceed()}else{TbCom.process("User","buildLoginFrame",null,null,null,a.loginframe_mark||"")}})})}}});_.Module.define({path:"pb/component/Follow",sub:{initial:function(b,a){this.jdom=b;this.key=a;this.jq_window=$(window);this.initWrapper();this.firstShowTop10();this.bindEvents();this.fixedLeft=this.follow_wrapper.offset().left;this.initHack()},initWrapper:function(){var a='<div class="follow_content '+this.key+'_wrapper"></div>';this.follow_content=$(a);a='<div id="follow_wrapper" class="follow_wrapper '+this.key+'_mod">';this.follow_wrapper=$(a).append(this.follow_content);this.jdom.after(this.follow_wrapper);this.follow_content.append(this.jdom)},firstShowTop10:function(){this.follow_content.show();this.follow_content.addClass("follow_absolute")},bindEvents:function(){var a=this;a.addScrollListener();a.addResizeListener()},initHack:function(){if($.browser.msie&&$.browser.version<7){this.follow_content.addClass("follow_hack")}},getLimitTop:function(){var a=$("div.left_section");this.minTop=this.follow_wrapper.offset().top;this.maxTop=a.offset().top+a.height()-this.follow_content.height()},addScrollListener:function(){var a=this;this.jq_window.bind("scroll",function(){a.showTop10()})},addResizeListener:function(){var a=this;this.jq_window.bind("resize",function(){a.resizeOn()})},resizeOn:function(){var a=this.follow_content.parent();if(a.attr("id")!="follow_wrapper"){if($.browser.msie&&$.browser.version<7){this.fixedLeft=this.follow_wrapper.offset().left}else{this.fixedLeft=this.follow_wrapper.offset().left-this.jq_window.scrollLeft()}this.follow_content.css({left:this.fixedLeft})}},showTop10:function(){var b=this.jq_window.scrollTop()+10;var a=this.follow_content.parent();this.getLimitTop();if(b<this.minTop){if(a.attr("id")!="follow_wrapper"){this.follow_wrapper.append(this.follow_content);this.follow_content.addClass("follow_absolute");this.follow_content.attr({style:""})}this.follow_content.show()}else{if(b>=this.minTop&&b<this.maxTop){if(a.attr("id")=="follow_wrapper"){$("body").append(this.follow_content);this.follow_content.removeClass("follow_absolute")}if($.browser.msie&&$.browser.version<7){this.fixedLeft=this.follow_wrapper.offset().left}else{this.fixedLeft=this.follow_wrapper.offset().left-this.jq_window.scrollLeft()}this.follow_content.css({left:this.fixedLeft});this.follow_content.show()}else{this.follow_content.hide()}}}}});(function(){var c=["\u541e\u566c\u661f\u7a7a","\u906e\u5929","\u6b66\u52a8\u4e7e\u5764","\u51e1\u4eba\u4fee\u4ed9\u4f20","\u795e\u5370\u738b\u5ea7","\u50b2\u4e16\u4e5d\u91cd\u5929","\u5c06\u591c","\u6740\u795e","\u5723\u738b","\u957f\u751f\u4e0d\u6b7b"];var a="THREAD_PAGE_TIMES";var d=function(){var f=PageData.thread.id;$("ul.l_posts_num").delegate("a","click",function(n){var o=$.cookie(a);var m={},l=null,j="",h=true;if(o){if(o.indexOf("@3")>0){return}l=o.split("|");for(var k=0,g=l.length;k<g;k++){j=l[k].split("@");m[j[0]]=j[1]}}if(!m[f]){m[f]=1}else{m[f]++;if(m[f]==3){b($.tb.unescapeHTML($(this).tbattr("href")));h=false}}e(m);return h})};var e=function(i){var f=[],h;for(var g in i){h=[g,"@",i[g]].join("");f.push(h)}$.cookie(a,f.join("|"))};var b=function(f){var i=new $.modal();i.show();var g=$("#lzonly_cntn");var h=$('<div><div class="lzonly_tip"></div><div class="iknow_btn"></div><div class="lzonly_tip_close"></div></div>');h.css({position:"absolute","z-index":$.getzIndex,left:g.offset().left-190,top:g.offset().top-10});$("body").append(h);$(window).scrollTop(0);$("div.iknow_btn,div.lzonly_tip_close").bind("click",function(){h.remove();i.remove();$.tb.location.setHref(f)});$(window).bind("resize",function(){h.css({left:g.offset().left-190})})};if(!PageData.is_login&&PageData.is_lzl==1&&PageData.is_uber&&$.inArray(PageData.forum_name,c)!=-1){d()}})();(function(d,e){var c;var b=function(){c=e.setInterval(function(){var f=(typeof(e.bdPass_api_loginLite_loaded)!="undefined");if(f){e.clearInterval(c);c=null;var g=PageData.user.is_login;if(!g){bdPass.api.loginLite.getSuggestFormIndexArray(1);TbCom.process("User","buildLoginFrame",null,null,null,"recallmaillogin")}}},200)};var a=d.tb.getDecodedSearch("src");if(a=="recallmail"){d(b)}})(jQuery,window);function HourGlass(c,b,a){this.hasEntered=false;this.beatId="";this.rate=c?c:20,this.paras=b;this.isActive=a||PageData.user.is_login}HourGlass.prototype={constructor:HourGlass,init:function(){if(this.isActive){$("body").bind("mouseover",{obj:this},function(a){a.data.obj.enter()});$("body").bind("mouseleave",{obj:this},function(a){a.data.obj.leave()})}},parasToQuery:function(){var b="";for(var a in this.paras){b+=a+"="+this.paras[a]+"&"}return b.substr(0,b.length-1)},enter:function(){if(!this.hasEntered){this.hasEntered=true;this.startBeat()}},leave:function(){if(this.hasEntered){this.hasEntered=false;this.stopBeat()}},startBeat:function(){var a=this;this.beatId=setInterval(function(){a.beat()},a.rate*1000)},stopBeat:function(){clearInterval(this.beatId)},beat:function(){var a=new Image();window["bd_hg2_"+(new Date().getTime())]=a;a.src="http://static.tieba.baidu.com/tb/img/hg/hg.gif?"+this.parasToQuery()+"&t="+new Date().getTime();a=null}};