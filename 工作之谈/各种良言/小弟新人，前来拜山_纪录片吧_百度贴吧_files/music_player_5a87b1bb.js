var T,baidu=T=baidu||{version:"1.5.0"};baidu.guid="$BAIDU$";window[baidu.guid]=window[baidu.guid]||{};baidu.fn=baidu.fn||{};baidu.fn.blank=function(){};baidu.string=baidu.string||{};baidu.string.format=function(c,a){c=String(c);var b=Array.prototype.slice.call(arguments,1),d=Object.prototype.toString;if(b.length){b=b.length==1?(a!==null&&(/\[object Array\]|\[object Object\]/.test(d.call(a)))?a:b):b;return c.replace(/#\{(.+?)\}/g,function(f,h){var g=b[h];if("[object Function]"==d.call(g)){g=g(h)}return("undefined"==typeof g?"":g)})}return c};baidu.format=baidu.string.format;baidu.object=baidu.object||{};baidu.object.each=function(f,c){var b,a,d;if("function"==typeof c){for(a in f){if(f.hasOwnProperty(a)){d=f[a];b=c.call(f,d,a);if(b===false){break}}}}return f};baidu.extend=baidu.object.extend=function(c,a){for(var b in a){if(a.hasOwnProperty(b)){c[b]=a[b]}}return c};baidu.number=baidu.number||{};baidu.number.pad=function(d,c){var f="",b=(d<0),a=String(Math.abs(d));if(a.length<c){f=(new Array(c-a.length+1)).join("0")}return(b?"-":"")+f+a};baidu.platform=baidu.platform||{};baidu.platform.isAndroid=/android/i.test(navigator.userAgent);baidu.platform.isIpad=/ipad/i.test(navigator.userAgent);baidu.platform.isIphone=/iphone/i.test(navigator.userAgent);baidu.swf=baidu.swf||{};baidu.browser=baidu.browser||{};baidu.browser.ie=baidu.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?(document.documentMode||+RegExp["\x241"]):undefined;baidu.array=baidu.array||{};baidu.array.remove=function(c,b){var a=c.length;while(a--){if(a in c&&c[a]===b){c.splice(a,1)}}return c};baidu.lang=baidu.lang||{};baidu.lang.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)};baidu.lang.isFunction=function(a){return"[object Function]"==Object.prototype.toString.call(a)};baidu.lang.toArray=function(b){if(b===null||b===undefined){return[]}if(baidu.lang.isArray(b)){return b}if(typeof b.length!=="number"||typeof b==="string"||baidu.lang.isFunction(b)){return[b]}if(b.item){var a=b.length,c=new Array(a);while(a--){c[a]=b[a]}return c}return[].slice.call(b)};baidu.swf.getMovie=function(c){var a=document[c],b;return baidu.browser.ie==9?a&&a.length?(b=baidu.array.remove(baidu.lang.toArray(a),function(d){return d.tagName.toLowerCase()!="embed"})).length==1?b[0]:b:a:a||window[c]};baidu.swf.version=(function(){var h=navigator;if(h.plugins&&h.mimeTypes.length){var d=h.plugins["Shockwave Flash"];if(d&&d.description){return d.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}}else{if(window.ActiveXObject&&!window.opera){for(var b=12;b>=2;b--){try{var g=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+b);if(g){var a=g.GetVariable("$version");return a.replace(/WIN/g,"").replace(/,/g,".")}}catch(f){}}}}})();baidu.string.encodeHTML=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};baidu.encodeHTML=baidu.string.encodeHTML;baidu.swf.createHTML=function(t){t=t||{};var l=baidu.swf.version,h=t.ver||"6.0.0",g,d,f,c,j,s,a={},p=baidu.string.encodeHTML;for(c in t){a[c]=t[c]}t=a;if(l){l=l.split(".");h=h.split(".");for(f=0;f<3;f++){g=parseInt(l[f],10);d=parseInt(h[f],10);if(d<g){break}else{if(d>g){return""}}}}else{return""}var n=t.vars,m=["classid","codebase","id","width","height","align"];t.align=t.align||"middle";t.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000";t.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0";t.movie=t.url||"";delete t.vars;delete t.url;if("string"==typeof n){t.flashvars=n}else{var q=[];for(c in n){s=n[c];q.push(c+"="+encodeURIComponent(s))}t.flashvars=q.join("&")}var o=["<object "];for(f=0,j=m.length;f<j;f++){s=m[f];o.push(" ",s,'="',p(t[s]),'"')}o.push(">");var b={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(c in t){s=t[c];c=c.toLowerCase();if(b[c]&&(s||s===false||s===0)){o.push('<param name="'+c+'" value="'+p(s)+'" />')}}t.src=t.movie;t.name=t.id;delete t.id;delete t.movie;delete t.classid;delete t.codebase;t.type="application/x-shockwave-flash";t.pluginspage="http://www.macromedia.com/go/getflashplayer";o.push("<embed");var r;for(c in t){s=t[c];if(s||s===false||s===0){if((new RegExp("^salign\x24","i")).test(c)){r=s;continue}o.push(" ",c,'="',p(s),'"')}}if(r){o.push(' salign="',p(r),'"')}o.push("></embed></object>");return o.join("")};baidu.swf.create=function(a,c){a=a||{};var b=baidu.swf.createHTML(a)||a.errorMessage||"";if(c&&"string"==typeof c){c=document.getElementById(c)}if(c){c.innerHTML=b}else{document.write(b)}};(function(){var a=window[baidu.guid];baidu.lang.guid=function(){return"TANGRAM__"+(a._counter++).toString(36)};a._counter=a._counter||1})();window[baidu.guid]._instances=window[baidu.guid]._instances||{};baidu.lang.Class=function(a){this.guid=a||baidu.lang.guid();window[baidu.guid]._instances[this.guid]=this};window[baidu.guid]._instances=window[baidu.guid]._instances||{};baidu.lang.Class.prototype.dispose=function(){delete window[baidu.guid]._instances[this.guid];for(var a in this){if(!baidu.lang.isFunction(this[a])){delete this[a]}}this.disposed=true};baidu.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};baidu.lang.isString=function(a){return"[object String]"==Object.prototype.toString.call(a)};baidu.isString=baidu.lang.isString;baidu.lang.Event=function(a,b){this.type=a;this.returnValue=true;this.target=b||null;this.currentTarget=null};baidu.lang.Class.prototype.addEventListener=function(d,c,b){if(!baidu.lang.isFunction(c)){return}!this.__listeners&&(this.__listeners={});var a=this.__listeners,f;if(typeof b=="string"&&b){if(/[^\w\-]/.test(b)){throw ("nonstandard key:"+b)}else{c.hashCode=b;f=b}}d.indexOf("on")!=0&&(d="on"+d);typeof a[d]!="object"&&(a[d]={});f=f||baidu.lang.guid();c.hashCode=f;a[d][f]=c};baidu.lang.Class.prototype.removeEventListener=function(d,c){if(typeof c!="undefined"){if((baidu.lang.isFunction(c)&&!(c=c.hashCode))||(!baidu.lang.isString(c))){return}}!this.__listeners&&(this.__listeners={});d.indexOf("on")!=0&&(d="on"+d);var b=this.__listeners;if(!b[d]){return}if(typeof c!="undefined"){b[d][c]&&delete b[d][c]}else{for(var a in b[d]){delete b[d][a]}}};baidu.lang.Class.prototype.dispatchEvent=function(d,a){if(baidu.lang.isString(d)){d=new baidu.lang.Event(d)}!this.__listeners&&(this.__listeners={});a=a||{};for(var c in a){d[c]=a[c]}var c,b=this.__listeners,f=d.type;d.target=d.target||this;d.currentTarget=this;f.indexOf("on")!=0&&(f="on"+f);baidu.lang.isFunction(this[f])&&this[f].apply(this,arguments);if(typeof b[f]=="object"){for(c in b[f]){b[f][c].apply(this,arguments)}}return d.returnValue};baidu.lang.createClass=function(g,b){b=b||{};var f=b.superClass||baidu.lang.Class;var d=function(){if(f!=baidu.lang.Class){f.apply(this,arguments)}else{f.call(this)}g.apply(this,arguments)};d.options=b.options||{};var j=function(){},h=g.prototype;j.prototype=f.prototype;var a=d.prototype=new j();for(var c in h){a[c]=h[c]}typeof b.className=="string"&&(a._className=b.className);a.constructor=h.constructor;d.extend=function(l){for(var k in l){d.prototype[k]=l[k]}return d};return d};baidu.lang.inherits=function(h,f,d){var c,g,a=h.prototype,b=new Function();b.prototype=f.prototype;g=h.prototype=new b();for(c in a){g[c]=a[c]}h.prototype.constructor=h;h.superClass=f.prototype;if("string"==typeof d){g._className=d}};baidu.inherits=baidu.lang.inherits;baidu.lang.isBoolean=function(a){return typeof a==="boolean"};baidu.lang.isElement=function(a){return !!(a&&a.nodeName&&a.nodeType==1)};baidu.lang.isNumber=function(a){return"[object Number]"==Object.prototype.toString.call(a)&&isFinite(a)};baidu.lang.isObject=function(a){return"function"==typeof a||!!(a&&"object"==typeof a)};baidu.isObject=baidu.lang.isObject;baidu.fn.bind=function(b,a){var c=arguments.length>2?[].slice.call(arguments,2):null;return function(){var f=baidu.lang.isString(b)?a[b]:b,d=(c)?c.concat([].slice.call(arguments,0)):arguments;return f.apply(a||f,d)}};baidu.each=baidu.array.forEach=baidu.array.each=function(h,f,b){var d,g,c,a=h.length;if("function"==typeof f){for(c=0;c<a;c++){g=h[c];d=f.call(b||h,g,c);if(d===false){break}}}return h};baidu.array.some=function(f,d,b){var c=0,a=f.length;for(;c<a;c++){if(c in f&&d.call(b||f,f[c],c)){return true}}return false};baidu.browser.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp["\x241"]:undefined;baidu.browser.firefox=/firefox\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp["\x241"]:undefined;baidu.browser.isWebkit=/webkit/i.test(navigator.userAgent);try{if(/(\d+\.\d+)/.test(external.max_version)){baidu.browser.maxthon=+RegExp["\x241"]}}catch(e){}(function(){var a=navigator.userAgent;baidu.browser.safari=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome/i.test(a)?+(RegExp["\x241"]||RegExp["\x242"]):undefined})();baidu.dom=baidu.dom||{};baidu.dom.g=function(a){if("string"==typeof a||a instanceof String){return document.getElementById(a)}else{if(a&&a.nodeName&&(a.nodeType==1||a.nodeType==9)){return a}}return null};baidu.g=baidu.G=baidu.dom.g;baidu.dom._styleFixer=baidu.dom._styleFixer||{};baidu.dom._styleFilter=baidu.dom._styleFilter||[];baidu.dom._styleFilter.filter=function(b,f,g){for(var a=0,d=baidu.dom._styleFilter,c;c=d[a];a++){if(c=c[g]){f=c(b,f)}}return f};baidu.string.toCamelCase=function(a){if(a.indexOf("-")<0&&a.indexOf("_")<0){return a}return a.replace(/[-_][^-_]/g,function(b){return b.charAt(1).toUpperCase()})};baidu.dom.setStyle=function(c,b,d){var f=baidu.dom,a;c=f.g(c);b=baidu.string.toCamelCase(b);if(a=f._styleFilter){d=a.filter(b,d,"set")}a=f._styleFixer[b];(a&&a.set)?a.set(c,d):(c.style[a||b]=d);return c};baidu.setStyle=baidu.dom.setStyle;baidu.dom.setStyles=function(b,c){b=baidu.dom.g(b);for(var a in c){baidu.dom.setStyle(b,a,c[a])}return b};baidu.setStyles=baidu.dom.setStyles;baidu.dom._NAME_ATTRS=(function(){var a={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};if(baidu.browser.ie<8){a["for"]="htmlFor";a["class"]="className"}else{a.htmlFor="for";a.className="class"}return a})();baidu.dom.setAttr=function(b,a,c){b=baidu.dom.g(b);if("style"==a){b.style.cssText=c}else{a=baidu.dom._NAME_ATTRS[a]||a;b.setAttribute(a,c)}return b};baidu.setAttr=baidu.dom.setAttr;baidu.dom.setAttrs=function(c,a){c=baidu.dom.g(c);for(var b in a){baidu.dom.setAttr(c,b,a[b])}return c};baidu.setAttrs=baidu.dom.setAttrs;baidu.dom.create=function(c,a){var d=document.createElement(c),b=a||{};return baidu.dom.setAttrs(d,b)};baidu.cookie=baidu.cookie||{};baidu.cookie._isValidKey=function(a){return(new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+\x24')).test(a)};baidu.cookie.getRaw=function(b){if(baidu.cookie._isValidKey(b)){var c=new RegExp("(^| )"+b+"=([^;]*)(;|\x24)"),a=c.exec(document.cookie);if(a){return a[2]||null}}return null};baidu.cookie.get=function(a){var b=baidu.cookie.getRaw(a);if("string"==typeof b){b=decodeURIComponent(b);return b}return null};baidu.cookie.setRaw=function(c,d,b){if(!baidu.cookie._isValidKey(c)){return}b=b||{};var a=b.expires;if("number"==typeof b.expires){a=new Date();a.setTime(a.getTime()+b.expires)}document.cookie=c+"="+d+(b.path?"; path="+b.path:"")+(a?"; expires="+a.toGMTString():"")+(b.domain?"; domain="+b.domain:"")+(b.secure?"; secure":"")};baidu.cookie.remove=function(b,a){a=a||{};a.expires=new Date(0);baidu.cookie.setRaw(b,"",a)};baidu.cookie.set=function(b,c,a){baidu.cookie.setRaw(b,encodeURIComponent(c),a)};baidu.sio=baidu.sio||{};baidu.sio._createScriptTag=function(b,a,c){b.setAttribute("type","text/javascript");c&&b.setAttribute("charset",c);b.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(b)};baidu.sio._removeScriptTag=function(b){if(b.clearAttributes){b.clearAttributes()}else{for(var a in b){if(b.hasOwnProperty(a)){delete b[a]}}}if(b&&b.parentNode){b.parentNode.removeChild(b)}b=null};baidu.sio.callByServer=function(a,n,o){var j=document.createElement("SCRIPT"),i="bd__cbs__",l,f,p=o||{},d=p.charset,g=p.queryField||"callback",m=p.timeOut||0,b,c=new RegExp("(\\?|&)"+g+"=([^&]*)"),h;if(baidu.lang.isFunction(n)){l=i+Math.floor(Math.random()*2147483648).toString(36);window[l]=k(0)}else{if(baidu.lang.isString(n)){l=n}else{if(h=c.exec(a)){l=h[2]}}}if(m){b=setTimeout(k(1),m)}a=a.replace(c,"\x241"+g+"="+l);if(a.search(c)<0){a+=(a.indexOf("?")<0?"?":"&")+g+"="+l}baidu.sio._createScriptTag(j,a,d);function k(q){return function(){try{if(q){p.onfailure&&p.onfailure()}else{n.apply(window,arguments);clearTimeout(b)}window[l]=null;delete window[l]}catch(r){}finally{baidu.sio._removeScriptTag(j)}}}};var mbox=mbox||{};T.extend(mbox,{namespace:function(){var b=arguments,h=null,f,c,g;for(f=0,len=b.length;f<len;f++){g=(""+b[f]).split(".");h=mbox;for(c=(g[0]=="mbox")?1:0;c<g.length;c=c+1){h[g[c]]=h[g[c]]||{};h=h[g[c]]}}return h},Fuze:function(){var a,c,b;a=[];c=function(d){if(b){d()}else{a.push(d)}};c.fire=function(){while(a.length){a.shift()()}b=true};c.extinguish=function(){b=false};c.wettish=function(){this.fire();this.extinguish()};c.clear=function(){while(a.length){a.shift()}this.extinguish()};return c},convertTime:function(b){var c,a;b=Math.round(b/1000);c=Math.floor(b/60);a=b%60;return T.number.pad(c,2)+":"+T.number.pad(a,2)},Timer:(function(b,c){var a=function(f,d){this._timer=function(){};this._listener=function(){};this._timerComplete=function(){};this._timerID=null;this._delay=this._remain=f;this._repeatCount=d||0;this._currentCount=0;this._isRunning=false;this._startTime=this._endTime=0;this.EVENTS={TIMER:"timer",COMPLETE:"timerComplete"}};a.prototype={_createTimer:function(f,d){var g=this;if(d==1){return function(){return b.setTimeout(function(){g.reset();g._listener(g._delay,d);g._timerComplete()},f)}}else{return function(){return b.setInterval(function(){if(d!=0&&g._currentCount>=d){g.reset();g._timerComplete()}else{g._currentCount++;g._listener(f,g._currentCount)}},f)}}},addEventListener:function(d,f){if(d=="timer"){this._listener=f;this._timer=this._createTimer(this._delay,this._repeatCount)}else{if(d=="timerComplete"){this._timerComplete=f}}},reset:function(){this.stop();if(this._repeatCount==1){this._timer=this._createTimer(this._delay,this._repeatCount)}this._currentCount=0;this._remain=this._delay;this._startTime=this._endTime=0},start:function(){if(!this._timerID){this._timerID=this._timer();if(this._repeatCount==1){this._startTime=new Date().getTime()}this._isRunning=true}},stop:function(){if(this._timerID){if(this._repeatCount==1){b.clearTimeout(this._timerID)}else{b.clearInterval(this._timerID)}this._timerID=null;this._isRunning=false}},pause:function(){if(this._repeatCount==1){if(this._timerID){this.stop();this._endTime=new Date().getTime();this._remain=this._remain-(this._endTime-this._startTime);if(this._remain>0){this._timer=this._createTimer(this._remain,1)}else{this.reset()}}}else{this.stop()}},getCurrentCount:function(){return this._currentCount},isRunning:function(){return this._isRunning}};return a})(window),StopWatch:(function(c,d){var b=0;var a=function(){this.startTime=0;this.isRunning=false;this.isReset=true;this.passedTime=0;b++};a.prototype={reset:function(){this.startTime=0;this.pauseTime=0;this.passedTime=0;this.isRunning=false;this.isReset=true},start:function(){if(this.isReset){this.reset();this.startTime=new Date().getTime()}else{if(!this.isRunning){this.startTime=new Date().getTime()}}this.isRunning=true;this.isReset=false},pause:function(){if(!this.isReset&&this.isRunning){this.pauseTime=new Date().getTime();this.passedTime+=this.pauseTime-this.startTime;this.isRunning=false}},isRunning:function(){return this.isRunning},isReset:function(){return this.isReset},getTime:function(){if(this.isReset){return 0}else{if(this.isRunning){return new Date().getTime()-this.startTime+this.passedTime}else{return this.passedTime}}},getCounts:function(){return b}};return a})(window)});mbox.namespace("mbox.lang");T.extend(mbox.lang,{createClass:function(c,a){var b=T.lang.createClass(c,a);b.prototype.removeEventListener=function(i,h){if(typeof h!="undefined"){if(baidu.lang.isFunction(h)&&!(h=h.hashCode)||!baidu.lang.isString(h)){return}}!this.__listeners&&(this.__listeners={});var d=i.split(".");if(i.length>1){i=d[0];h=d[1]}i.indexOf("on")!=0&&(i="on"+i);var g=this.__listeners;if(!g[i]){return}if(typeof h!="undefined"){g[i][h]&&delete g[i][h]}else{for(var f in g[i]){delete g[i][f]}}};b.extend=function(f){for(var d in f){b.prototype[d]=(function(h,g){if(T.lang.isFunction(h)){return function(){this.dispatchEvent(g,{name:g,arguments:arguments});var i=h.apply(this,arguments);return i}}else{return h}})(f[d],d)}return b};return b}});var mbox=mbox||{};(function(){var a="mbox";mbox.CONF={instanceCallName:a,autoPlay:false,autoNext:false,engineArg:{audio:{constructorName:"PlayEngine_Audio"},fmp:{constructorName:"PlayEngine_FMP_MP3",args:{swfPath:"http://play.baidu.com/player/static/flash/fmp.swf",instanceName:a+".player"}}},logOpt:{ref:"pc_widget_tieba"},songLinkHost:{link:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.song.play&format=jsonp&bit=128&songid=",lrc:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.song.lry&fromat=jsonp&songid=",sug:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common&page_size=1&page_no=1&query="}}})(undefined);var PlayEngine_Interface=mbox.lang.createClass((function(d,f){var b=0;var a={mute:false,volume:50};var c=function(g){this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"};this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"};g=g||{};this.mute=typeof g.mute=="undefined"?a.mute:!!g.mute;this.volume=typeof g.volume=="undefined"?a.volume:g.volume;this.ready=false;this.url="";this.state=this.STATES.INIT;this.engineType="";this.stateStack=[this.STATES.INIT];this.supportMimeType=[]};c.prototype={newId:function(){return"_m3_"+b++},init:function(){},reset:function(){},setUrl:function(g){},getUrl:function(){return this.url},play:function(){},pause:function(){},stop:function(){},setMute:function(g){},getMute:function(){return this.mute},setVolume:function(g){},getVolume:function(){return this.volume},getState:function(){return""},setCurrentPosition:function(g){},getCurrentPosition:function(){return 0},getLoadedPercent:function(){return 0},getLoadedBytes:function(){return 0},getTotalBytes:function(){return 0},getTotalTime:function(){return 0},getVersion:function(){return""},getEngineType:function(){return this.engineType},canPlayType:function(h){var g=this.getSupportMimeTypeList();return T.array.some(g,function(j,i){return h==j})},getSupportMimeTypeList:function(){return this.supportMimeType},setEventListener:function(g,i,h){var j=T.fn.bind(function(){return i.apply(this,arguments)},this);this.addEventListener(g,j,h)}};return c})(window),{superClass:T.lang.Class,className:"PlayEngine_Interface"});var PlayEngine_Audio=mbox.lang.createClass(function(a){a=a||{};this.engineType="audio";this.contentType={mp3:["audio/mpeg","audio/mp3"],mp4:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],m4a:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],aac:["audio/aac","audio/aacp"],"3gp":["audio/3gpp","audio/3gpp2"],ogg:["audio/ogg","video/ogg","application/ogg","audio/vorbis"],oga:["audio/ogg","application/ogg","audio/vorbis"],wma:["audio/x-ms-wma"]};this.supportAudio=typeof Audio!="undefined";this.supportMimeType=[];if(this.supportAudio){this.audio=new Audio();if(typeof this.audio.canPlayType=="function"){T.object.each(this.contentType,T.fn.bind(function(c,d){for(var b=0;b<c.length;b++){var f=this.audio.canPlayType(c[b]);if(f=="probably"||f=="maybe"){this.supportMimeType.push(d);break}}},this))}if(!this.supportMimeType.length){this.supportAudio=false}}this.supportVolume=T.fn.bind(function(){if(this.supportAudio){this.audio.volume=0.5;return(this.audio.volume<1)}return false},this)()},{superClass:PlayEngine_Interface,className:"PlayEngine_Audio"}).extend({test:function(a){a=!!a;if(!this.supportAudio&&a){this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType})}return this.supportAudio},init:function(a){this.lastState=this.STATES.INIT;this.muted=this.audio.muted=false;this.volume=50;this.audio.volume=0.5;this.url="";this._definedEvents();this.state=this.STATES.READY;this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.audio})},reset:function(){if(!this.supportAudio){return}this.url="";this.audio.pause();this.state="ready";this.lastState="ready"},setUrl:function(a){if(!this.supportAudio){return}this.url=a;this.audio.src=a;this.audio.load();this._firePlayStateChange(this.STATES.PREBUFFER)},play:function(){if(!this.supportAudio){return}if(this.state!="ready"){if(T.platform.isAndroid&&T.browser.isWebkit&&this.audio.readyState<3){var a=T.fn.bind(function(){this.audio.play();this.audio.removeEventListener("canplay",a,false)},this);this.audio.addEventListener("canplay",a,false)}else{this.audio.play()}}},pause:function(){if(!this.supportAudio){return}if(this.state!=this.STATES.STOP&&this.state!=this.STATES.READY&&this.state!=this.STATES.END){this.audio.pause();this._firePlayStateChange(this.STATES.PAUSE)}},stop:function(){if(!this.supportAudio){return}if(this.state!=this.STATES.READY){if(this.audio.currentTime!=0){this.audio.currentTime=0}this.audio.pause();this._firePlayStateChange(this.STATES.STOP)}},setMute:function(a){if(!this.supportAudio){return}this.audio.muted=this.mute=a},setVolume:function(a){if(!this.supportAudio){return}a=T.lang.isNumber(a)?a:50;a=Math.max(Math.min(a,100),0);this.volume=a;this.audio.volume=a/100},setCurrentPosition:function(b){if(!this.supportAudio){return}if(T.platform.isAndroid&&this.audio.readyState<3){var a=T.fn.bind(function(){this.audio.currentTime=b/1000;this.audio.play();this.audio.removeEventListener("canplay",a,false)},this);this.audio.addEventListener("canplay",a,false)}else{this.audio.currentTime=b/1000;this.audio.play()}},getCurrentPosition:function(){if(!this.supportAudio){return 0}return Math.round(this.audio.currentTime*1000)},getLoadedPercent:function(){try{var a=this.audio.buffered.end(0),b=this.audio.duration;b=isNaN(b)?0:b;return Math.round(a/b*100)/100}catch(c){return 0}},getTotalTime:function(){if(!this.supportAudio){return 0}var a=this.audio.duration;a=isNaN(a)?0:a;return Math.round(a*1000)},getState:function(){return this.state},_firePlayStateChange:function(a){if(this.state!=a){this.lastState=this.state;this.state=a;this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:a,oldState:this.lastState,engineType:this.engineType})}},_definedEvents:function(){this.audio.addEventListener("error",T.fn.bind(function(){this._firePlayStateChange(this.STATES.ERROR);this.dispatchEvent(this.EVENTS.ERROR,{engineType:this.engineType})},this),false);this.audio.addEventListener("ended",T.fn.bind(function(){this._firePlayStateChange(this.STATES.END)},this),false);this.audio.addEventListener("playing",T.fn.bind(function(){this._firePlayStateChange(this.STATES.PLAY)},this),false);this.audio.addEventListener("pause",T.fn.bind(function(){if(this.getState()==this.STATES.PLAY){this._firePlayStateChange(this.getCurrentPosition()?this.STATES.PAUSE:this.STATES.STOP)}},this),false);this.audio.addEventListener("waiting",T.fn.bind(function(){this._firePlayStateChange(this.getCurrentPosition()?this.STATES.BUFFERING:this.STATES.PREBUFFER)},this),false)}});var PlayEngine_FMP_MP3=mbox.lang.createClass(function(a){a=a||{};this.supportMimeType=["mp3"];this.engineType="fmp_mp3";this.swfPath="fmp_mp3.swf";this.flashVersionRequire=a.flashVersionRequire||"9.0.0";this.versionErrorMessage=a.versionErrorMessage||"";this.stateCode={"-2":this.STATES.INIT,"-1":this.STATES.READY,"0":this.STATES.STOP,"1":this.STATES.PLAY,"2":this.STATES.PAUSE,"3":this.STATES.END,"4":this.STATES.BUFFERING,"5":this.STATES.PREBUFFER,"6":this.STATES.ERROR};this.flashLoaded=false;this.flashReady=new mbox.Fuze()},{superClass:PlayEngine_Interface,className:"PlayEngine_FMP_MP3"}).extend({test:function(a){return this._checkPlayer(a)},init:function(b){b=b||{};var c=b.el;this.instanceName=b.instanceName;this.swfPath=b.swfPath||this.swfPath;var a,d=this.newId();if(T.lang.isString(c)){c=T.g(c)}if(!c){c=T.dom.create("div");document.body.appendChild(c)}a=T.dom.create("div");c.appendChild(a);this.swfPath+="?"+d+"_"+Math.random();T.swf.create({id:this.flashObjectId=d,width:"1px",height:"1px",ver:this.flashVersionRequire,errorMessage:this.versionErrorMessage,allowscriptaccess:"always",url:this.swfPath,bgcolor:"#ffffff",wmode:"window",scale:"noscale",vars:{_instanceName:this.instanceName+"",_buffertime:2000}},a);this.flashObject=T.swf.getMovie(this.flashObjectId)},reset:function(){this.stop();if(this.state!=this.STATES.INIT){this.url="";this.state=this.STATES.READY;this.stateStack=[this.STATES.READY]}},setUrl:function(a){this.flashReady(T.fn.bind(function(){this.url=a;this.flashObject.closeStream();this.flashObject.f_load(a)},this))},play:function(){this.flashReady(T.fn.bind(function(){if(this.state==this.STATES.PLAY){return}this.flashObject.f_play()},this))},pause:function(){this.flashReady(T.fn.bind(function(){if(this.state==this.STATES.PAUSE||this.state==this.STATES.STOP||this.state==this.STATES.END){return}this.flashObject.f_pause()},this))},stop:function(){this.flashReady(T.fn.bind(function(){if(this.state==this.STATES.STOP){return}this.flashObject.f_stop()},this))},setMute:function(a){this.flashReady(T.fn.bind(function(){this.mute=a;this.flashObject.setData("mute",a)},this))},setVolume:function(a){this.flashReady(T.fn.bind(function(){this.volume=a;this.flashObject.setData("volume",a)},this))},setCurrentPosition:function(a){this.flashReady(T.fn.bind(function(){this.flashObject.f_play(a)},this))},getCurrentPosition:function(){return this.flashLoaded?this.flashObject.getData("currentPosition"):0},getLoadedPercent:function(){return this.flashLoaded?this.flashObject.getData("loadedPct"):0},getTotalTime:function(){return this.flashLoaded?this.flashObject.getData("length"):0},getState:function(a){return T.lang.isNumber(a)?this.stateCode[a]:this.state},getVersion:function(){return T.swf.version},_firePlayStateChange:function(b){if(this.state!=b){this.state=b;this.stateStack.push(b);var a=this.stateStack.shift();this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:b,oldState:a,engineType:this.engineType})}},_onLoad:function(){this.state=this.STATES.READY;this.stateStack=[this.state];this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.flashObject});setTimeout(T.fn.bind(function(){this.flashReady.fire();this.flashLoaded=true},this),0)},_onPlayStateChange:function(a){setTimeout(T.fn.bind(function(){this._firePlayStateChange(this.getState(a))},this),0)},_checkPlayer:function(b){b=!!b;var d=T.swf.version,f=this.flashVersionRequire;if(d){var a=d.split("."),c=f.split(".");if(a[0]-c[0]>=0&&a[1]-c[1]>=0){return true}else{if(b){this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType})}return false}}else{if(b){this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType})}return false}}});var PlayEngine=mbox.lang.createClass(function(a){a=a||{};this.subEnginesConf=[];this.subEnginesInitArgs={};this.curEngine=null;this.curEngineType="";this.unInitEngineList=[];this.engineList=[];this.engineTypeList=[];this.ready=false;this.defaultExt=".mp3";this.coreContainer=null;this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"};this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"};this.progressTimer=new mbox.Timer(200,0);this.positionTimer=new mbox.Timer(100,0);this._initEngines(a)},{className:"PlayEngine"}).extend({_error:function(a){throw new Error(a)},_initEngines:function(config){this.coreContainer=config.el||null;this.subEnginesConf=config.subEngines||[];T.array.each(this.subEnginesConf,T.fn.bind(function(item,index){var subEngineName=item.constructorName,args=item.args||{},subEngineConstructor;this.subEnginesInitArgs[subEngineName]=args;try{subEngineConstructor=eval(subEngineName);if(!T.lang.isFunction(subEngineConstructor)){return}}catch(e){return}var engine=new subEngineConstructor(args);this.unInitEngineList.push(engine)},this));this.curEngine=this.unInitEngineList[0]},init:function(b){if(this.ready){return this._error("")}b=b||{};this.subEnginesInitArgs=b.subEngines?b.subEngines:this.subEnginesInitArgs;this.coreContainer=b.el?b.el:this.coreContainer;if(!this.coreContainer){var a=T.dom.create("div",{id:"_player_container_"+T.lang.guid()});T.dom.setStyles(a,{width:"1px",height:"1px",overflow:"hidden"});document.body.appendChild(a);this.coreContainer=b.el=a}T.array.each(this.unInitEngineList,T.fn.bind(function(h,f){var c=h.toString(),i="",g=/^\[object (.*)\]$/i;if(g.test(c)){i=RegExp.$1}var d=this.subEnginesInitArgs[i]||{};if(h.test(true)){d.instanceName=d.instanceName+".engineList["+this.engineList.length+"]";d.el=d.el||this.coreContainer;this.engineList.push(h);h.init.apply(h,[d])}},this));this.switchEngineByUrl(this.defaultExt);this.ready=true;this._initProgressEvent();this._initPositionChangeEvent()},canPlayType:function(a){return T.array.some(this.engineList,function(c,b){return c.canPlayType(a)})},getSupportMimeTypeList:function(){var a=[];T.array.each(this.engineList,T.fn.bind(function(c,b){a=a.concat(c.getSupportMimeTypeList())},this));return a},switchEngineByUrl:function(b){var a=T.array.some(this.engineList,T.fn.bind(function(g,d){var h=g.getSupportMimeTypeList().join("|");var f=new RegExp("\\.("+h+")(\\?|$)","ig");if(f.test(b)){this.curEngine=g;this.curEngineType=g.getEngineType();return true}},this));var c=arguments[1];if(!a&&!c){arguments.callee.apply(this,[this.defaultExt,true])}},switchEngineByMimeType:function(a){T.array.some(this.engineList,T.fn.bind(function(c,b){if(c.canPlayType(a)){this.curEngine=c;this.curEngineType=c.getEngineType();return true}},this))},reset:function(){this.curEngine.reset.apply(this.curEngine,arguments)},setUrl:function(b){var a=this.curEngine;this.switchEngineByUrl(b);if(a&&a!=this.curEngine){a.stop()}if(this.curEngine){this.curEngine.setUrl.apply(this.curEngine,arguments)}},getUrl:function(){return this.curEngine.getUrl.apply(this.curEngine,arguments)},play:function(a){if(typeof a=="undefined"){if(this.curEngine){return this.curEngine.play.apply(this.curEngine,arguments)}}else{return this.setCurrentPosition(a)}},pause:function(){if(this.curEngine){return this.curEngine.pause.apply(this.curEngine,arguments)}},stop:function(){if(this.curEngine){return this.curEngine.stop.apply(this.curEngine,arguments)}},setMute:function(b){var a=arguments;T.array.each(this.engineList,function(d,c){d.setMute.apply(d,a)})},getMute:function(){if(this.curEngine){return this.curEngine.getMute.apply(this.curEngine,arguments)}return false},setVolume:function(b){var a=arguments;T.array.each(this.engineList,function(d,c){d.setVolume.apply(d,a)})},getVolume:function(){if(this.curEngine){return this.curEngine.getVolume.apply(this.curEngine,arguments)}return 0},setCurrentPosition:function(a){if(this.curEngine){return this.curEngine.setCurrentPosition.apply(this.curEngine,arguments)}},getCurrentPosition:function(){if(this.curEngine){return this.curEngine.getCurrentPosition.apply(this.curEngine,arguments)}return 0},getCurrentPositionString:function(){return mbox.convertTime(this.getCurrentPosition())},getLoadedPercent:function(){if(this.curEngine){return this.curEngine.getLoadedPercent.apply(this.curEngine,arguments)}return 0},getLoadedBytes:function(){if(this.curEngine){return this.curEngine.getLoadedBytes.apply(this.curEngine,arguments)}},getTotalBytes:function(){if(this.curEngine){return this.curEngine.getTotalBytes.apply(this.curEngine,arguments)}return 0},getTotalTime:function(){if(this.curEngine){return this.curEngine.getTotalTime.apply(this.curEngine,arguments)}return 0},getTotalTimeString:function(){return mbox.convertTime(this.getTotalTime())},getCurEngine:function(){return this.curEngine},getEngineType:function(){return this.getCurEngine().getEngineType()},getVersion:function(){var a={};T.array.each(this.engineList,function(c,b){a[c.getEngineType()]=c.getVersion()});return a},getState:function(){if(this.curEngine){return this.curEngine.getState.apply(this.curEngine,arguments)}return null},setEventListener:function(a,c,b){var d;if(a==this.EVENTS.INITFAIL||a==this.EVENTS.INIT){d=T.fn.bind(function(f){c.apply(this,arguments)},this)}else{d=T.fn.bind(function(f){if(f.target&&f.target.getEngineType()==this.curEngineType){c.apply(this,arguments)}},this)}T.array.each(this.unInitEngineList,function(g,f){g.setEventListener(a,d,b)})},removeEventListener:function(b,a){T.array.each(this.unInitEngineList,function(d,c){d.removeEventListener(b,a)})},_initProgressEvent:function(){this.progressTimer.addEventListener("timer",T.fn.bind(function(b,a){var c=this.getLoadedPercent();this.curEngine.dispatchEvent(this.EVENTS.PROGRESS,{progress:c,totalBytes:this.getTotalBytes(),loadedBytes:this.getLoadedBytes(),totalTime:this.getTotalTime()});if(c==1&&this.curEngineType!="wmp"){this.progressTimer.stop()}},this));this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(b){var a=b.newState;switch(a){case this.STATES.PREBUFFER:case this.STATES.PLAY:if(this.getLoadedPercent()<1){this.progressTimer.start()}break;case this.STATES.STOP:case this.STATES.READY:case this.STATES.END:this.progressTimer.reset();break}},this));this.setEventListener("setUrl",T.fn.bind(function(a){this.progressTimer.reset();this.progressTimer.start()},this))},_initPositionChangeEvent:function(){this.positionTimer.addEventListener("timer",T.fn.bind(function(b,a){var c=this.getCurrentPosition();this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:c})},this));this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(b){var a=b.newState;switch(a){case this.STATES.PLAY:this.positionTimer.start();break;case this.STATES.STOP:case this.STATES.PAUSE:this.positionTimer.pause();this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:this.getCurrentPosition()});break;case this.STATES.READY:case this.STATES.END:this.positionTimer.reset();break}},this));this.setEventListener("setUrl",T.fn.bind(function(a){this.positionTimer.reset()},this))}});mbox.SongModel=function(a){a=a||{};this.hasLink=false;this.songId=0;this.songName="";this.artistId=0;this.artistName="";this.albumId=0;this.albumName="";this.songPicSmall="";this.songPicBig="";this.songPicRadio="";this.lrcLink="";this.time=0;this.songLink="";this.showLink="";this.format="";this.rate=0;this.size=0;this.lyricContent="";this.relateStatus=0;this.resourceType=0;this.copyType=0;for(var b in a){var d=a[b];if(!T.isString(this[b])){if(d!=""){var c=+d;if(c==d){d=c}else{if(d==null){d=""}}}}this[b]=d}};mbox.SongModel.prototype={set:function(d,c){for(var a in d){var f=d[a];if(!T.isString(this[a])){if(f!=""){var b=+f;if(b==f){f=b}else{if(f==null){f=""}}}}this[a]=f}},get:function(a){return this[a]},unset:function(a){delete this[a]}};(function(){var a=T.lang.createClass(function(){this.allSongCache={};this.apiAddress=mbox.CONF.songLinkHost.link;this.lrcAddress=mbox.CONF.songLinkHost.lrc;this.sugAddress=mbox.CONF.songLinkHost.sug}).extend({createSongModel:function(c,b){var d=[],c=T.lang.toArray(c),b=T.lang.toArray(b);T.each(c,function(h,f,g){if(!h||h==="null"||h==="undefined"){return}if(!this.allSongCache[h]){this.allSongCache[h]=new mbox.SongModel({songId:h})}d.push(this.allSongCache[h])},this);T.object.each(b,function(h,g,f){if(this.allSongCache[h.queryId||h.id]){this.allSongCache[h.queryId||h.id].set(h)}},this);return d},fetchIdByQuery:function(f,b){var c=f.split("$$"),g=c[0]||c[2],d=c[1];T.sio.callByServer(this.sugAddress+g+" "+d,function(h){if(h.song_list&&h.song_list.length){b(h.song_list[0].song_id)}else{b(f)}})},fetchSong:function(b,c){if(b.hasLink){T.lang.isFunction(c.success)&&c.success(b,this)}else{if(b.songId.toString().indexOf("$$")>-1){this.fetchIdByQuery(b.songId,T.fn.bind(function(d){T.sio.callByServer(this.apiAddress+d,function(j){if(j.error_code===22000){var h=j.songinfo,f=j.bitrate;if(h.extra){var g=h.extra.split("$$");h.song_id=h.extra;h.title=g[0]||g[2];h.author=g[1]}b.set({hasLink:true,songId:h.song_id,songName:h.title,artistId:h.ting_uid,artistName:h.author,albumId:h.album_id,albumName:h.album_title,songPicBig:h.pic_big,songPicSmall:h.pic_small||"http://mu9.bdstatic.com/player/t/i/JJn494Tv.jpg",songPicRadio:h.pic_radio,resourceType:h.resource_type,relateStatus:h.relate_status,copyType:h.copy_type,lrcLink:h.lrclink,rate:f.file_bitrate,songLink:f.file_link,showLink:f.show_link,format:f.file_extension,size:f.file_size,time:f.file_duration});T.lang.isFunction(c.success)&&c.success(b,this)}else{T.lang.isFunction(c.error)&&c.error(b,j.error_code)}})},this))}else{T.sio.callByServer(this.apiAddress+b.songId,function(h){if(h.error_code===22000){var g=h.songinfo,d=h.bitrate;if(g.extra){var f=g.extra.split("$$");g.song_id=g.extra;g.title=f[0]||f[2];g.author=f[1]}b.set({hasLink:true,songId:g.song_id,songName:g.title,artistId:g.ting_uid,artistName:g.author,albumId:g.album_id,albumName:g.album_title,songPicBig:g.pic_big,songPicSmall:g.pic_small||"http://mu9.bdstatic.com/player/t/i/JJn494Tv.jpg",songPicRadio:g.pic_radio,resourceType:g.resource_type,relateStatus:g.relate_status,copyType:g.copy_type,lrcLink:g.lrclink,rate:d.file_bitrate,songLink:d.file_link,showLink:d.show_link,format:d.file_extension,size:d.file_size,time:d.file_duration});T.lang.isFunction(c.success)&&c.success(b,this)}else{T.lang.isFunction(c.error)&&c.error(b,h.error_code)}})}}},getLrcContent:function(c,b){var g=T.lang.isFunction,f=g(b)?b:g(b.success)?b.success:function(){},d=g(b.error)?b.error:function(){};if(c.lrcContent){f(c.lrcContent)}else{if(c.songLink&&c.lrcLink){T.sio.callByServer(this.lrcAddress+c.songId,function(h){if(h.lrcContent){c.lrcContent=h.lrcContent;f(h.lrcContent)}else{d()}})}else{d()}}}});mbox.SongDataModel=new a()})(undefined);(function(){var a={RANDOM:0,SINGLE:1,CYCLE:2};mbox.PlayList=T.lang.createClass(function(){this.curSongIndex=-1;this.curSong=null;this.songModels=[];this.mode=a.SINGLE}).extend({_random:function(){return parseInt(Math.random()*this.getLength(),10)},addSong:function(b){b=T.lang.toArray(b);if(b.length){this.songModels=this.songModels.concat(b);this.dispatchEvent("add:songModels",{songModels:b})}},removeSong:function(g){if(g===-1){this.reset();this.dispatchEvent("remove:songModels",{indexes:d})}else{var d=T.lang.toArray(g),h=d.length;if(h){d.sort(function(k,j){return k-j});var c=this.curSongIndex,i=c,b=false;while(h--){var f=d[h];this.songModels.splice(f,1);if(i!==-1){if(f===c){b=true}if(f<=c){c--}}}if(b){c++}if(i!==-1){if(c<0&&songlist.length>0){c=0;b=true}else{if(c>songlist.length-1){c=0}}}if(b){this.curSong=songlist[c];this.curSongIndex=c}this.dispatchEvent("remove:songModels",{indexes:d})}}},prev:function(){var c=this.getLength(),b=this.curSongIndex===-1?0:(this.curSongIndex+c-1)%c;if(!c){return}if(this.mode===a.RANDOM){this.setCurIndex(this._random())}else{this.setCurIndex(b)}},next:function(){var c=this.getLength(),b=(this.curSongIndex+1)%c;if(!c){return}if(this.mode===a.RANDOM){this.setCurIndex(this._random())}else{this.setCurIndex(b)}},autoNext:function(){if(this.mode===a.SINGLE){this.setCurIndex(this.curSongIndex)}else{this.next()}},setCurIndex:function(b){this.curSongIndex=b;this.setCurSong(this.songModels[b]);this.dispatchEvent("change:curSongIndex",{index:b})},setCurSong:function(b){this.curSong=b;this.dispatchEvent("change:curSong",{curSong:b})},getCurIndex:function(){return this.curSongIndex},getCurSong:function(){return this.curSong},getSongList:function(){return this.songModels},setMode:function(b){this.mode=b},getMode:function(){return this.mode},getLength:function(){return this.songModels.length},reset:function(){this.curSongIndex=-1;this.curSong=null;this.songModels=[];this.playlist=[]},fetchLink:function(b){mbox.SongDataModel.fetchSong(this.curSong,b)}})})();mbox.LogModel=T.lang.createClass(function(a,b){this.logUrl="http://nsclick.baidu.com/v.gif";this.playerRules={};this.playerRuleCtrl=null;this.player=a;this.playList=b;this.initLog()}).extend({initLog:function(){var c=this;var a=new mbox.PlayerLog({time:100,resetOnNoVoice:true,type:"play100ms",player:this.player,handler:function(){c.sendLog("playsong100ms",c.logUrl,{sendCurSong:true})}});var b=new mbox.PlayerLog({time:60*1000,resetOnNoVoice:false,type:"play60s",player:this.player,handler:function(){c.sendLog("60play",c.logUrl,{sendCurSong:true})}});this.player.setEventListener("setUrl",function(){c.sendLog("playstart",c.logUrl,{sendCurSong:true})})},_addCurSong:function(c){var a={song_id:"songId",song_title:"songName",singer_id:"artistId",singer_name:"artistName",album_id:"albumId",album_name:"albumName",copytype:"copyType",format:"format",queryid:"queryId",rate:"rate",relatestatus:"relateStatus",resourcetype:"resourceType",songsize:"size",linkCode:"linkCode",lrcLink:"lrcLink",time:"time",status:"status",from:"from",link:"songLink"};var b=this.playList.getCurSong();T.object.each(a,function(f,d){c.push(d+"="+encodeURIComponent(b[f]==null?"":b[f]))})},sendLog:function(f,d,c){var g=[],b=new Date().getTime();window["naga_log_"+b]=new Image();var a=window["naga_log_"+b];g.push("pid=304");g.push("url=");g.push("type="+f);if(c.sendCurSong){this._addCurSong(g)}if(c.pos){g.push("pos="+c.pos)}g.push("r"+Math.random()+"=1");if(mbox.CONF.logOpt){if(!mbox.CONF.logOpt.ref){mbox.CONF.logOpt.ref="pc_aldsinglebox"}T.object.each(mbox.CONF.logOpt,function(i,h){g.push(h+"="+i)})}if(c.otherInfo){_.each(c.otherInfo,function(i,h){g.push(h+"="+encodeURIComponent((i+"")||""))})}a.onload=function(){a=null;try{delete window["naga_log_"+b]}catch(h){}};a.src=(d)+"?"+g.join("&")}});mbox.PlayerLog=function(a){this.type=a.type;this.time=a.time;this.resetOnNoVoice=a.resetOnNoVoice;this.player=a.player;this.active=false;this.timer=null;this.handlers=[];if(a.handler){this.handlers.push(a.handler)}this._init()};mbox.PlayerLog.prototype={_init:function(){if(!this.timer&&this.time!=null){this.timer=new mbox.Timer(this.time,1);this.addHandler(this.handler);this.timer.addEventListener("timer",T.fn.bind(function(){for(var d=0,c=this.handlers.length;d<c;d++){this.handlers[d]&&this.handlers[d].apply(this,arguments)}},this))}var b=this.player.EVENTS.STATECHANGE,a=this.player.STATES;this.player.setEventListener("setUrl",T.fn.bind(function(){this.active=true;this.timer.reset()},this));this.player.setEventListener(b,T.fn.bind(function(c){if(this.active){if(c.newState==a.PLAY){this.timer.start()}else{if(this.resetOnNoVoice){this.timer.reset()}else{if(c.newState==a.PAUSE||c.newState==a.BUFFERING){if(c.oldState==a.PLAY){this.timer.pause()}}else{this.timer.reset()}}}}},this))},addHandler:function(a){this.handlers.push(a)}};mbox.PlayCtrl=mbox.lang.createClass(function(c){var a=[],d=mbox.CONF.instanceCallName,b=mbox.CONF.engineArg;if(typeof window[d]!=="object"){window[d]={}}if(/(macintosh|iphone|ipod|ipad)/i.test(navigator.userAgent)){a.push(b.audio);a.push(b.fmp)}else{a.push(b.fmp);a.push(b.audio)}this.player=window[d].player=new PlayEngine({subEngines:a});this.player.init();this.curSong=null;this.playList=new mbox.PlayList();this.log=new mbox.LogModel(this.player,this.playList);window[d].logger=this.log;this._init(c);if(mbox.CONF.exportAPI){window[d][mbox.CONF.exportAPI]=this.exportAPI()}}).extend({_init:function(d){d=d||{};var b=this.player,c=this.playList,h=d.songId||[],g=mbox.SongDataModel.createSongModel(h),a=this,f=T.lang.isFunction;if(d.logOpt){T.object.extend(mbox.CONF.logOpt||{},d.logOpt)}b.setEventListener(b.EVENTS.POSITIONCHANGE,function(k){var i=k.position,j=a.getTotalTime();f(d.onPositionChange)&&d.onPositionChange(i,i*100/j||0)});f(d.onProgressChange)&&b.setEventListener(b.EVENTS.PROGRESS,function(i){d.onProgressChange(i.progress*100)});b.setEventListener(b.EVENTS.STATECHANGE,function(i){f(d.onPlayStateChange)&&d.onPlayStateChange(i.newState,i.oldState);switch(i.newState){case b.STATES.END:if(mbox.CONF.autoNext){c.autoNext();a.play()}else{b.stop()}break}});c.addEventListener("change:curSong",function(i){b.stop();if(a.curSong=i.curSong){a.playList.fetchLink({success:function(j){f(d.onChangeCurSong)&&d.onChangeCurSong(j);a.dispatchEvent("fetch:link",{song:j})},error:function(j){f(d.onChangeCurSong)&&d.onChangeCurSong(null,j)}})}else{f(d.onChangeCurSong)&&d.onChangeCurSong(null)}});c.addSong(g);this.playList.setCurIndex(0);if(d.autoPlay!==undefined?d.autoPlay:mbox.CONF.autoPlay){this.play()}},getCurSong:function(){return this.curSong},getTotalTime:function(){return this.curSong&&this.curSong.time*1000||this.player.getTotalTime()},setPlayIndex:function(a,b){this.playList.setCurIndex(a);b&&this.play()},play:function(){if(this.curSong&&this.curSong.songLink){if(this.curSong.songLink!==this.player.getUrl()){this.player.reset();this.player.setUrl(this.curSong.songLink)}this.player.play()}else{var a=this;this.addEventListener("fetch:link",function(b){if(b.song){a.player.setUrl(b.song.songLink);a.player.play()}else{throw"fetch songLink fail"}a.removeEventListener("fetch:link.link")},"link")}},pause:function(){this.player.pause()},stop:function(){this.player.stop()},exportAPI:function(){var a=this,b=this.player.EVENTS;return{getCurSong:function(){return a.curSong},getTotalTime:function(){return a.totalTime},getPlayerState:function(){return a.player.getState()},getPosition:function(){return a.player.getPosition()},getProgress:function(){return a.player.getProgress()},play:function(){a.play.apply(a,arguments)},pause:function(){a.pause()},stop:function(){a.stop()},listenToStateChange:function(c){a.player.setEventListener(b.STATECHANGE,c)},listenToPosChange:function(c){a.player.setEventListener(b.POSITIONCHAGNE,c)},listenToLoadedPercentChange:function(c){a.player.setEventListener(b.PROGRESS,c)},getCurIndex:function(){return a.playList.getCurIndex()},addSong:function(c){var d=T.lang.toArray(c);if(d.length&&typeof d[0]!=="object"){d=mbox.SongDataModel.createSongModel(d)}a.playList.addSong(d)},removeSong:function(c){a.playList.removeSong(c)},setPlayIndex:function(c,d){this.setPlayIndex.call(a,c,d)},setPlayMode:function(c){a.playList.setMode(c)}}}});mbox.uiConf={prefix:"mbox",allWidget:["slider","time","volume","mute","title","lrc","album","playList","playBtn"],tpl:'<div class="mbox">                <div class="logo" ><a href="http://music.baidu.com" target="_blank" title="\u767e\u5ea6\u97f3\u4e50"></a></div>                <div class="player-main">                    <div class="album-pic mbox-album">                        <img class="pic" data-src="<%=songPicSmall%>"/>                    </div>                    <div class="right-wrapper">                        <div class="right-top">                            <div class="mbox-title player-title">                                <div class="song-name song-info" songid="<%=songId%>"><a href="http://music.baidu.com/song/<%=songId%>" target="_blank"><%=songName%></a></div>                                <span class="artist song-info">\u6b4c\u624b\uff1a<span class="artist-name"><%var i =0, len = all_artist.length; for(;len -i; i++){%>                                    <a href="<%=all_artist_link[i]%>" target="_blank"><%=all_artist[i]%></a><%};%></span></span>                                <span class="album song-info">\u4e13\u8f91\uff1a<span class="album-name"><a href="<%=albumLink%>" target="_blank"><%=albumName%></a></span></span>                                <span class="source song-info">\u6765\u6e90\uff1a<span class="link-source"><a href="javascript:void(0)"></a></span></span>                                <div class="lrc"></div>                            </div>                            <div class="button-wrapper">                                <a class="button add-favour" href="javascript:void(0)" onclick="return false;" title="\u70B9\u51FB\u6536\u85CF"></a>                                <a class="button lrc-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u67e5\u770b\u5168\u90e8\u6b4c\u8bcd"></a>                                <a class="button download-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u4e0b\u8f7d\u6b4c\u66f2"></a>                                <a class="button go-to-listen-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u5f39\u51fa\u64ad\u653e"></a>                            </div>                        </div>                        <div class="bottom-bars">                            <div class="bottom-bars-item mbox-playBtn ctrl-btn stop"><a href="javascript:void(0)" onclick="return false;"></a></div>                            <div class="bottom-bars-item  progress "><div class="slider-wrapper mbox-slider"></div></div>                            <div class="bottom-bars-item mbox-time time"><%=curTime%>/<%=totalTime%></div>                            <div class="bottom-bars-item volume">                                <a class="volume-btn mbox-mute" href="javascript:void(0)" onclick="return false;"  title="">&nbsp</a>                                <div class="slider-wrapper mbox-volume"></div>                            </div>                        </div>                    </div>                </div>                </div>'};(function(c){var b=typeof module==="undefined"?(c.baidu=c.baidu||{}):module.exports;b.template=function(h,g){var f=(function(){if(!c.document){return a._compile(h)}var j=document.getElementById(h);if(j){if(a.cache[h]){return a.cache[h]}var i=/^(textarea|input)$/i.test(j.nodeName)?j.value:j.innerHTML;return a._compile(i)}else{return a._compile(h)}})();var d=a._isObject(g)?f(g):f;f=null;return d};var a=b.template;a.versions=a.versions||[];a.versions.push("1.0.6");a.cache={};a.LEFT_DELIMITER=a.LEFT_DELIMITER||"<%";a.RIGHT_DELIMITER=a.RIGHT_DELIMITER||"%>";a.ESCAPE=true;a._encodeHTML=function(d){return String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};a._encodeReg=function(d){return String(d).replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")};a._encodeEventHTML=function(d){return String(d).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\\\/g,"\\").replace(/\\\//g,"/").replace(/\\n/g,"\n").replace(/\\r/g,"\r")};a._compile=function(f){var d="var _template_fun_array=[];\nvar fn=(function(__data__){\nvar _template_varName='';\nfor(name in __data__){\n_template_varName+=('var '+name+'=__data__[\"'+name+'\"];');\n};\neval(_template_varName);\n_template_fun_array.push('"+a._analysisStr(f)+"');\n_template_varName=null;\n})(_template_object);\nfn = null;\nreturn _template_fun_array.join('');\n";return new Function("_template_object",d)};a._isObject=function(d){return"function"===typeof d||!!(d&&"object"===typeof d)};a._analysisStr=function(g){var d=a.LEFT_DELIMITER;var i=a.RIGHT_DELIMITER;var f=a._encodeReg(d);var h=a._encodeReg(i);g=String(g).replace(new RegExp("("+f+"[^"+h+"]*)//.*\n","g"),"$1").replace(new RegExp("<!--.*?-->","g"),"").replace(new RegExp(f+"\\*.*?\\*"+h,"g"),"").replace(new RegExp("[\\r\\t\\n]","g"),"").replace(new RegExp(f+"(?:(?!"+h+")[\\s\\S])*"+h+"|((?:(?!"+f+")[\\s\\S])+)","g"),function(k,j){var l="";if(j){l=j.replace(/\\/g,"&#92;").replace(/'/g,"&#39;");while(/<[^<]*?&#39;[^<]*?>/g.test(l)){l=l.replace(/(<[^<]*?)&#39;([^<]*?>)/g,"$1\r$2")}}else{l=k}return l});g=g.replace(new RegExp("("+f+"[\\s]*?var[\\s]*?.*?[\\s]*?[^;])[\\s]*?"+h,"g"),"$1;"+i).replace(new RegExp("("+f+":?[hvu]?[\\s]*?=[\\s]*?[^;|"+h+"]*?);[\\s]*?"+h,"g"),"$1"+i).split(d).join("\t");if(a.ESCAPE){g=g.replace(new RegExp("\\t=(.*?)"+h,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'")}else{g=g.replace(new RegExp("\\t=(.*?)"+h,"g"),"',typeof($1) === 'undefined'?'':$1,'")}g=g.replace(new RegExp("\\t:h=(.*?)"+h,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'").replace(new RegExp("\\t(?::=|-)(.*?)"+h,"g"),"',typeof($1)==='undefined'?'':$1,'").replace(new RegExp("\\t:u=(.*?)"+h,"g"),"',typeof($1)==='undefined'?'':encodeURIComponent($1),'").replace(new RegExp("\\t:v=(.*?)"+h,"g"),"',typeof($1)==='undefined'?'':baidu.template._encodeEventHTML($1),'").split("\t").join("');").split(i).join("_template_fun_array.push('").split("\r").join("\\'");return g}})(window);
/*!
 * jQuery UI Widget @VERSION
 * http://jqueryui.com
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(b,f){if(b.widget&&b.widget==="function"){b.box_widget=b.widget}var a=0,d=Array.prototype.slice,c=b.cleanData;b.cleanData=function(g){for(var h=0,j;(j=g[h])!=null;h++){try{b(j).triggerHandler("remove")}catch(k){}}c(g)};b.box_widget=function(h,k,g){var n,m,j,l,i=h.split(".")[0];h=h.split(".")[1];n=i+"-"+h;if(!g){g=k;k=b.Widget}b.expr[":"][n.toLowerCase()]=function(o){return !!b.data(o,n)};b[i]=b[i]||{};m=b[i][h];j=b[i][h]=function(o,p){if(!this._createWidget){return new j(o,p)}if(arguments.length){this._createWidget(o,p)}};b.extend(j,m,{version:g.version,_proto:b.extend({},g),_childConstructors:[]});l=new k();l.options=b.box_widget.extend({},l.options);b.each(g,function(p,o){if(b.isFunction(o)){g[p]=(function(){var q=function(){return k.prototype[p].apply(this,arguments)},r=function(s){return k.prototype[p].apply(this,s)};return function(){var u=this._super,s=this._superApply,t;this._super=q;this._superApply=r;t=o.apply(this,arguments);this._super=u;this._superApply=s;return t}})()}});j.prototype=b.box_widget.extend(l,{widgetEventPrefix:h},g,{constructor:j,namespace:i,widgetName:h,widgetBaseClass:n,widgetFullName:n});if(m){b.each(m._childConstructors,function(p,q){var o=q.prototype;b.box_widget(o.namespace+"."+o.widgetName,j,q._proto)});delete m._childConstructors}else{k._childConstructors.push(j)}b.box_widget.bridge(h,j)};b.box_widget.extend=function(l){var h=d.call(arguments,1),k=0,g=h.length,i,j;for(;k<g;k++){for(i in h[k]){j=h[k][i];if(h[k].hasOwnProperty(i)&&j!==f){l[i]=b.isPlainObject(j)?b.box_widget.extend({},l[i],j):j}}}return l};b.box_widget.bridge=function(h,g){var i=g.prototype.widgetFullName;b.fn[h]=function(l){var j=typeof l==="string",k=d.call(arguments,1),m=this;l=!j&&k.length?b.box_widget.extend.apply(null,[l].concat(k)):l;if(j){this.each(function(){var o,n=b.data(this,i);if(!n){return b.error("cannot call methods on "+h+" prior to initialization; attempted to call method '"+l+"'")}if(!b.isFunction(n[l])||l.charAt(0)==="_"){return b.error("no such method '"+l+"' for "+h+" widget instance")}o=n[l].apply(n,k);if(o!==n&&o!==f){m=o&&o.jquery?m.pushStack(o.get()):o;return false}})}else{this.each(function(){var n=b.data(this,i);if(n){n.option(l||{})._init()}else{new g(l,this)}})}return m}};b.Widget=function(g,h){};b.Widget._childConstructors=[];b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(g,h){h=b(h||this.defaultElement||this)[0];this.element=b(h);this.uuid=a++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=b.box_widget.extend({},this.options,this._getCreateOptions(),g);this.bindings=b();this.hoverable=b();this.focusable=b();if(h!==this){b.data(h,this.widgetName,this);b.data(h,this.widgetFullName,this);this._on({remove:"destroy"});this.document=b(h.style?h.ownerDocument:h.document||h);this.window=b(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:b.noop,_getCreateEventData:b.noop,_create:b.noop,_init:b.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(b.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:b.noop,widget:function(){return this.element},option:function(k,l){var g=k,m,j,h;if(arguments.length===0){return b.box_widget.extend({},this.options)}if(typeof k==="string"){g={};m=k.split(".");k=m.shift();if(m.length){j=g[k]=b.box_widget.extend({},this.options[k]);for(h=0;h<m.length-1;h++){j[m[h]]=j[m[h]]||{};j=j[m[h]]}k=m.pop();if(l===f){return j[k]===f?null:j[k]}j[k]=l}else{if(l===f){return this.options[k]===f?null:this.options[k]}g[k]=l}}this._setOptions(g);return this},_setOptions:function(g){var h;for(h in g){this._setOption(h,g[h])}return this},_setOption:function(g,h){this.options[g]=h;if(g==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!h).attr("aria-disabled",h);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(i,h){if(!h){h=i;i=this.element}else{i=b(i);this.bindings=this.bindings.add(i)}var g=this;b.each(h,function(o,n){function l(){if(g.options.disabled===true||b(this).hasClass("ui-state-disabled")){return}return(typeof n==="string"?g[n]:n).apply(g,arguments)}if(typeof n!=="string"){l.guid=n.guid=n.guid||l.guid||b.guid++}var m=o.match(/^(\w+)\s*(.*)$/),k=m[1]+g.eventNamespace,j=m[2];if(j){g.widget().delegate(j,k,l)}else{i.bind(k,l)}})},_off:function(h,g){g=(g||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;h.unbind(g).undelegate(g)},_delay:function(j,i){function h(){return(typeof j==="string"?g[j]:j).apply(g,arguments)}var g=this;return setTimeout(h,i||0)},_hoverable:function(g){this.hoverable=this.hoverable.add(g);this._on(g,{mouseenter:function(h){b(h.currentTarget).addClass("ui-state-hover")},mouseleave:function(h){b(h.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(g){this.focusable=this.focusable.add(g);this._on(g,{focusin:function(h){b(h.currentTarget).addClass("ui-state-focus")},focusout:function(h){b(h.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(g,h,i){var l,k,j=this.options[g];i=i||{};h=b.Event(h);h.type=(g===this.widgetEventPrefix?g:this.widgetEventPrefix+g).toLowerCase();h.target=this.element[0];k=h.originalEvent;if(k){for(l in k){if(!(l in h)){h[l]=k[l]}}}this.element.trigger(h,i);return !(b.isFunction(j)&&j.apply(this.element[0],[h].concat(i))===false||h.isDefaultPrevented())}};b.each({show:"fadeIn",hide:"fadeOut"},function(h,g){b.Widget.prototype["_"+h]=function(k,j,m){if(typeof j==="string"){j={effect:j}}var l,i=!j?h:j===true||typeof j==="number"?g:j.effect||g;j=j||{};if(typeof j==="number"){j={duration:j}}l=!b.isEmptyObject(j);j.complete=m;if(j.delay){k.delay(j.delay)}if(l&&b.effects&&(b.effects.effect[i]||b.uiBackCompat!==false&&b.effects[i])){k[h](j)}else{if(i!==h&&k[i]){k[i](j.duration,j.easing,m)}else{k.queue(function(n){b(this)[h]();if(m){m.call(k[0])}n()})}}}});if(b.uiBackCompat!==false){b.Widget.prototype._getCreateOptions=function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]}}})(jQuery);
/*!
 * jQuery UI Mouse 1.8.20
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function(b,c){var a=false;b(document).mouseup(function(d){a=false});b.box_widget("ui.box_mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var d=this;this.element.bind("mousedown."+this.widgetName,function(f){return d._mouseDown(f)}).bind("click."+this.widgetName,function(f){if(true===b.data(f.target,d.widgetName+".preventClickEvent")){b.removeData(f.target,d.widgetName+".preventClickEvent");f.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(g){if(a){return}(this._mouseStarted&&this._mouseUp(g));this._mouseDownEvent=g;var f=this,h=(g.which==1),d=(typeof this.options.cancel=="string"&&g.target.nodeName?b(g.target).closest(this.options.cancel).length:false);if(!h||d||!this._mouseCapture(g)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){f.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(g)&&this._mouseDelayMet(g)){this._mouseStarted=(this._mouseStart(g)!==false);if(!this._mouseStarted){g.preventDefault();return true}}if(true===b.data(g.target,this.widgetName+".preventClickEvent")){b.removeData(g.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(i){return f._mouseMove(i)};this._mouseUpDelegate=function(i){return f._mouseUp(i)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);g.preventDefault();a=true;return true},_mouseMove:function(d){if(b.browser.msie&&!(document.documentMode>=9)&&!d.button){return this._mouseUp(d)}if(this._mouseStarted){this._mouseDrag(d);return d.preventDefault()}if(this._mouseDistanceMet(d)&&this._mouseDelayMet(d)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,d)!==false);(this._mouseStarted?this._mouseDrag(d):this._mouseUp(d))}return !this._mouseStarted},_mouseUp:function(d){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(d.target==this._mouseDownEvent.target){b.data(d.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(d)}return false},_mouseDistanceMet:function(d){return(Math.max(Math.abs(this._mouseDownEvent.pageX-d.pageX),Math.abs(this._mouseDownEvent.pageY-d.pageY))>=this.options.distance)},_mouseDelayMet:function(d){return this.mouseDelayMet},_mouseStart:function(d){},_mouseDrag:function(d){},_mouseStop:function(d){},_mouseCapture:function(d){return true}})})(jQuery);
/*!
 * jQuery UI Slider 1.8.20
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(b,c){var a=5;b.box_widget("ui.box_slider",b.ui.box_mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",progressbar:false,progress:0,constraintProgress:false,range:false,step:1,value:0,values:null},_create:function(){var f=this,l=this.options,k=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),j="<a class='ui-slider-handle ui-state-default ui-corner-all' hidefocus='true'><span></span></a>",d=(l.values&&l.values.length)||1,h=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(l.disabled?" ui-slider-disabled ui-disabled":""));this.range=b([]);if(l.range){if(l.range===true){if(!l.values){l.values=[this._valueMin(),this._valueMin()]}if(l.values.length&&l.values.length!==2){l.values=[l.values[0],l.values[0]]}}this.range=b("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+((l.range==="min"||l.range==="max")?" ui-slider-range-"+l.range:""))}if(l.progressbar){this.progressbar=b("<div></div>").appendTo(this.element).addClass("ui-slider-progressbar ui-widget-header")}for(var g=k.length;g<d;g+=1){h.push(j)}this.handles=k.add(b(h.join("")).appendTo(f.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(i){i.preventDefault()}).hover(function(){if(!l.disabled){b(this).addClass("ui-state-hover ui-slider-handle-hover")}},function(){b(this).removeClass("ui-state-hover ui-slider-handle-hover")}).focus(function(){if(!l.disabled){b(".ui-slider .ui-state-focus").removeClass("ui-state-focus ui-slider-handle-focus");b(this).addClass("ui-state-focus ui-slider-handle-focus")}else{b(this).blur()}}).blur(function(){b(this).removeClass("ui-state-focus ui-slider-handle-focus")});this.handles.each(function(m){b(this).data("index.ui-slider-handle",m)});this.handles.keydown(function(p){var m=b(this).data("index.ui-slider-handle"),q,n,i,o;if(f.options.disabled){return}switch(p.keyCode){case b.ui.keyCode.HOME:case b.ui.keyCode.END:case b.ui.keyCode.PAGE_UP:case b.ui.keyCode.PAGE_DOWN:case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:p.preventDefault();if(!f._keySliding){f._keySliding=true;b(this).addClass("ui-state-active ui-slider-handle-active");q=f._start(p,m);if(q===false){return}}break}o=f.options.step;if(f.options.values&&f.options.values.length){n=i=f.values(m)}else{n=i=f.value()}switch(p.keyCode){case b.ui.keyCode.HOME:i=f._valueMin();break;case b.ui.keyCode.END:i=f._valueMax();break;case b.ui.keyCode.PAGE_UP:i=f._trimAlignValue(n+((f._valueMax()-f._valueMin())/a));break;case b.ui.keyCode.PAGE_DOWN:i=f._trimAlignValue(n-((f._valueMax()-f._valueMin())/a));break;case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:if(n===f._valueMax()){return}i=f._trimAlignValue(n+o);break;case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:if(n===f._valueMin()){return}i=f._trimAlignValue(n-o);break}f._slide(p,m,i)}).keyup(function(m){var i=b(this).data("index.ui-slider-handle");if(f._keySliding){f._keySliding=false;f._stop(m,i);f._change(m,i);b(this).removeClass("ui-state-active ui-slider-handle-active")}});this._refreshValue();this._refreshProgress();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},_mouseCapture:function(g){var h=this.options,k,m,f,i,p,l,n,j,d;if(h.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();k={x:g.pageX,y:g.pageY};m=this._normValueFromMouse(k);f=this._valueMax()-this._valueMin()+1;p=this;this.handles.each(function(o){var q=Math.abs(m-p.values(o));if(f>q){f=q;i=b(this);l=o}});if(h.range===true&&this.values(1)===h.min){l+=1;i=b(this.handles[l])}n=this._start(g,l);if(n===false){return false}this._mouseSliding=true;p._handleIndex=l;i.addClass("ui-state-active ui-slider-handle-active").focus();j=i.offset();d=!b(g.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=d?{left:0,top:0}:{left:g.pageX-j.left-(i.width()/2),top:g.pageY-j.top-(i.height()/2)-(parseInt(i.css("borderTopWidth"),10)||0)-(parseInt(i.css("borderBottomWidth"),10)||0)+(parseInt(i.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(g,l,m)}this._animateOff=true;return true},_mouseStart:function(d){return true},_mouseDrag:function(g){var d={x:g.pageX,y:g.pageY},f=this._normValueFromMouse(d);this._slide(g,this._handleIndex,f);return false},_mouseStop:function(d){this.handles.removeClass("ui-state-active ui-slider-handle-active");this._mouseSliding=false;this._stop(d,this._handleIndex);this._change(d,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal"},_normValueFromMouse:function(f){var d,i,h,g,j;if(this.orientation==="horizontal"){d=this.elementSize.width;i=f.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{d=this.elementSize.height;i=f.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}h=(i/d);if(h>1){h=1}if(h<0){h=0}if(this.orientation==="vertical"){h=1-h}g=this._valueMax()-this._valueMin();j=this._valueMin()+h*g;return this._trimAlignValue(j)},_start:function(g,f){var d={handle:this.handles[f],value:this.value()};if(this.options.values&&this.options.values.length){d.value=this.values(f);d.values=this.values()}return this._trigger("start",g,d)},_slide:function(i,h,g){var d,f,j;if(this.options.values&&this.options.values.length){d=this.values(h?0:1);if((this.options.values.length===2&&this.options.range===true)&&((h===0&&g>d)||(h===1&&g<d))){g=d}if(g!==this.values(h)){f=this.values();f[h]=g;j=this._trigger("slide",i,{handle:this.handles[h],value:g,values:f});d=this.values(h?0:1);if(j!==false){this.values(h,g,true)}}}else{if(g!==this.value()){j=this._trigger("slide",i,{handle:this.handles[h],value:g});if(j!==false){this.value(g)}}}},_stop:function(g,f){var d={handle:this.handles[f],value:this.value()};if(this.options.values&&this.options.values.length){d.value=this.values(f);d.values=this.values()}this._trigger("stop",g,d)},_change:function(g,f){if(!this._keySliding&&!this._mouseSliding){var d={handle:this.handles[f],value:this.value()};if(this.options.values&&this.options.values.length){d.value=this.values(f);d.values=this.values()}this._trigger("change",g,d)}},_progress:function(f){var d={progress:this.options.progress};this._trigger("progress",f,d)},progress:function(f){var d=this._trimAlignProgress(f);if(arguments.length){if(this.options.progress!=d){this.options.progress=d;this._refreshProgress();this._progress(null);if(this.options.constraintProgress&&this.value()>d){this.value(d)}return}}return this.options.progress},value:function(d){if(arguments.length){this.options.value=this._trimAlignValue(d);this._refreshValue();this._change(null,0);return}return this._value()},values:function(f,j){var h,d,g;if(arguments.length>1){this.options.values[f]=this._trimAlignValue(j);this._refreshValue();this._change(null,f);return}if(arguments.length){if(b.isArray(arguments[0])){h=this.options.values;d=arguments[0];for(g=0;g<h.length;g+=1){h[g]=this._trimAlignValue(d[g]);this._change(null,g)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(f)}else{return this.value()}}}else{return this._values()}},_setOption:function(f,g){var d,h=0;if(b.isArray(this.options.values)){h=this.options.values.length}b.Widget.prototype._setOption.apply(this,arguments);switch(f){case"disabled":if(g){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover ui-slider-handle-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();this._refreshProgress();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(d=0;d<h;d+=1){this._change(null,d)}this._animateOff=false;break;case"progress":this._refreshProgress();this._progress(null);if(this.options.constraintProgress&&this.options.value>this.options.progress){this._animateOff=true;this.value(this.options.progress);this._animateOff=false}break;case"min":case"max":this._animateOff=true;this._refreshValue();this._refreshProgress();this._animateOff=false;break}},_value:function(){var d=this.options.value;d=this._trimAlignValue(d);return d},_values:function(d){var h,g,f;if(arguments.length){h=this.options.values[d];h=this._trimAlignValue(h);return h}else{g=this.options.values.slice();for(f=0;f<g.length;f+=1){g[f]=this._trimAlignValue(g[f])}return g}},_trimAlignValue:function(h){if(h<=this._valueMin()){return this._valueMin()}if(!this.options.constraintProgress&&h>=this._valueMax()){return this._valueMax()}if(this.options.progressbar&&this.options.constraintProgress&&h>=this.options.progress){h=this.options.progress}var d=(this.options.step>0)?this.options.step:1,g=(h-this._valueMin())%d,f=h-g;if(Math.abs(g)*2>=d){f+=(g>0)?d:(-d)}return parseFloat(f.toFixed(5))},_trimAlignProgress:function(d){if(d<=this._valueMin()){return this._valueMin()}if(d>=this._valueMax()){return this._valueMax()}return d},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var h=this.options.range,g=this.options,n=this,f=(!this._animateOff)?g.animate:false,i,d={},j,l,k,m;if(this.options.values&&this.options.values.length){this.handles.each(function(p,o){i=(n.values(p)-n._valueMin())/(n._valueMax()-n._valueMin())*100;d[n.orientation==="horizontal"?"left":"bottom"]=i+"%";b(this).stop(1,1)[f?"animate":"css"](d,g.animate);if(n.options.range===true){if(n.orientation==="horizontal"){if(p===0){n.range.stop(1,1)[f?"animate":"css"]({left:i+"%"},g.animate)}if(p===1){n.range[f?"animate":"css"]({width:(i-j)+"%"},{queue:false,duration:g.animate})}}else{if(p===0){n.range.stop(1,1)[f?"animate":"css"]({bottom:(i)+"%"},g.animate)}if(p===1){n.range[f?"animate":"css"]({height:(i-j)+"%"},{queue:false,duration:g.animate})}}}j=i})}else{l=this.value();k=this._valueMin();m=this._valueMax();i=(m!==k)?(l-k)/(m-k)*100:0;d[n.orientation==="horizontal"?"left":"bottom"]=i+"%";this.handle.stop(1,0)[f?"animate":"css"](d,g.animate);if(h==="min"&&this.orientation==="horizontal"){this.range.stop(1,0)[f?"animate":"css"]({width:i+"%"},g.animate)}if(h==="max"&&this.orientation==="horizontal"){this.range[f?"animate":"css"]({width:(100-i)+"%"},{queue:false,duration:g.animate})}if(h==="min"&&this.orientation==="vertical"){this.range.stop(1,0)[f?"animate":"css"]({height:i+"%"},g.animate)}if(h==="max"&&this.orientation==="vertical"){this.range[f?"animate":"css"]({height:(100-i)+"%"},{queue:false,duration:g.animate})}}},_refreshProgress:function(){var h=this.options,d=this._valueMax(),f=h.progress,g=f/d*100;if(!this.progressbar){return}if(this.orientation==="horizontal"){this.progressbar.css({width:g+"%"})}else{this.progressbar.css({height:g+"%"})}},setLoading:function(f,d){var g;if(arguments.length<=1){d=f;g=this.handle}else{g=this.handles.eq(f)}g[d?"addClass":"removeClass"]("ui-slider-handle-loading")}});b.extend(b.ui.box_slider,{version:"1.8.20"})}(jQuery));(function(a){a.cutString=function(k,l,h){var g=k.length,b=0,d=0,m;var f,c;for(f=0;f<g;f++){if(k.charCodeAt(f)>128){b+=2}else{b+=1}if(b>l){m=k.substring(0,f-1)+"...";break}}for(c=g;c>0;c--){if(c<=f||h===0){return m}if(k.charCodeAt(f)>128){d+=2}else{d+=1}if(d>h){m=m+k.substring(c);return m}}return k}})(jQuery);mbox.UiCtrl=mbox.lang.createClass(function(b,a){this.guid="mbox_ui_"+setTimeout(function(){},0);this.conf=a||mbox.uiConf;if(!this.conf){return}this.widget={};this._init(b);this.EVENTS={POSITIONCHANGE:"ui_poschange",TOGGLEPLAY:"ui_toggleplay",VOLCHANGE:"ui_volchange",MUTECHANGE:"ui_mutechange"};this.volume=80;this.$root=$(b);this.active=false}).extend({_init:function(b){if(this.conf.tpl){var k=$(this.conf.tpl).appendTo(b||"body").css("display","none"),l=this.conf.allWidget,g=this.conf.prefix,a={};for(var f=l.length-1;f>-1;f--){var d=k.find("."+g+"-"+l[f]),h=d.html();h=h&&h.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>");a[l[f]]={dom:d,tpl:h}}this.conf.domJson=a;k.css("display","block");this.$root=k}var c=this.conf.domJson;for(var m in c){if(c.hasOwnProperty(m)){switch(m){case"slider":this._initSlider(c[m]);break;case"volume":this.widget[m]=$(c[m].dom).box_slider({animate:true,max:100,min:0,orientation:"horizental",progressbar:false,range:"min",value:80}).bind("slide",T.fn.bind(function(j,i){if(this.active){this.fireVolChange(+i.value,+i.value===0)}},this)).bind("slidestop",T.fn.bind(function(j,i){if(!this.active){this.widget.volume.box_slider("option","value",this.volume)}},this));break;case"mute":var n=this;this.widget[m]=$(c[m].dom).click(function(j){var i=$(this).hasClass("mute");n.fireVolChange(n.volume,!i)});break;case"title":case"time":case"playList":case"album":this.widget[m]=$(c[m].dom);this.widget[m].tpl=c[m].tpl;break;case"playBtn":this.widget[m]=$(c[m].dom).bind("click",T.fn.bind(function(){var i=this.widget.playBtn.hasClass("stop");this.dispatchEvent(this.EVENTS.TOGGLEPLAY,{isPlay:i})},this));break;default:break}}}this.conf.tpl&&this.tplToHtml()},_initSlider:function(c){var a=c.maxValue||10000;this.widget.slider=$(c.dom).box_slider({animate:175,max:a,min:0,orientation:"horizontal",progressbar:true,progress:0,constraintProgress:true,range:"min",value:0});this.widget.slider.maxValue=a;this.widget.slider.sliding=false;var b=this;this.widget.slider.bind("slidestart",function(){b.widget.slider.isSliding=true}).bind("slidestop",function(f,d){b.widget.slider.isSliding=false;b.dispatchEvent(b.EVENTS.POSITIONCHANGE,{percent:d.value/b.widget.slider.maxValue});!b.active&&b.widget.slider.box_slider("option","value",0)})},tplToHtml:function(d,c,h,f){if(this.widget.title){var g=this.createSongFilter(d);if(!g.songName||g.songName==="\u8be5\u6b4c\u66f2\u5df2\u4e0b\u67b6"){this.widget.title.addClass("grey")}else{this.widget.title.removeClass("grey")}this.widget.title.html(baidu.template(this.widget.title.tpl,g))}if(this.widget.lrc){this.widget.lrc.lrc("setLrc","")}if(this.widget.album){this.widget.album.html(baidu.template(this.widget.album.tpl,d));var b=this.widget.album.find("img");if(!b[0].src){var a=b.attr("data-src");a&&b.attr("src",a)}}if(this.widget.time){this.widget.time.html(baidu.template(this.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(0)}))}function j(k){$(c).delegate("."+k,"click",function(){f.sendLog("click",f.logUrl,{pos:h[k]})})}for(var i in h){j(i)}},fireVolChange:function(a,b){if(!this.active){return false}this.volume=a;if(!b){this.widget.mute&&this.widget.mute.removeClass("mute").attr("title","\u9759\u97f3");this.widget.volume&&this.widget.volume.box_slider("option","value",this.volume)}else{this.widget.mute&&this.widget.mute.addClass("mute").attr("title","\u53d6\u6d88\u9759\u97f3");this.widget.volume&&this.widget.volume.box_slider("option","value",0)}this.dispatchEvent(this.EVENTS.VOLCHANGE,{volume:a});this.dispatchEvent(this.EVENTS.MUTECHANGE,{mute:b});return true},setActive:function(a){this.active=a;this.$root[a?"addClass":"removeClass"]("active")},setShowLink:function(d,c){var b=d.showLink,a=b?$.cutString(b,16,5):"";if(d.resourceType.toString()=="2"||d.resourceType===undefined){$(c).find(".link-source a").text(a).attr("href",b);$(c).find(".source").show()}},createSongFilter:function(j){var g,c=[],b=[],h=[],f;if(j){g="http://music.baidu.com/",c=j.artistId.toString().split(","),b=j.artistName.split(","),h=[];for(var d=0,a=b.length;d<a;d++){h[d]=c[d]?g+"artist/"+c[d]:"javascript:;"}f={songId:j.songId,songName:j.songName||"\u8be5\u6b4c\u66f2\u5df2\u4e0b\u67b6",albumId:j.albumId,albumLink:j.albumId?g+"album/"+j.albumId:"javascript:;",albumName:j.albumName,all_artist:b,all_artist_id:c,all_artist_link:h}}else{f={songId:"",songName:"",albumId:"",albumLink:"",albumName:"",all_artist:b,all_artist_id:c,all_artist_link:h}}return f}});(function(){var a=function(b,d){if([].indexOf){return[].indexOf.call(b,d)}else{for(var c=b.length-1;c>-1;c--){if(b[c]===d){return c}}return -1}};mbox.Controller=function(b){this.playctrl=b;this.uiList=[]};mbox.Controller.prototype={_init:function(){},bindUi:function(d,c){if(a(this.uiList,d)>-1||!d){return false}if(c&&this.uiList.length>0){for(var b=this.uiList.length;b;b--){this.unbindUi(this.uiList[b-1]);this.uiList.splice(b-1,1)}}this.bindPlayerEvent(this.playctrl,d);this.bindSongInfoEvent(this.playctrl,d);this.bindPlayListEvent(this.playctrl,d);this.bindUIEvent(this.playctrl,d);this.uiList.push(d);var f=this.playctrl.player;this._onPosition(d,f.getCurrentPosition());this._onProgress(d,f.getLoadedPercent());this._onState(d,f.getState());d.setActive(true);d.fireVolChange(d.volume,!d.volume);return true},unbindUi:function(f){var g=playctrl.player,h=f.guid,d=g.EVENTS,b=f.EVENTS,c;for(c in d){if(d.hasOwnProperty(c)){g.removeEventListener(d[c]+"."+h)}}for(c in b){if(b.hasOwnProperty(c)){f.removeEventListener(b[c]+"."+h)}}playctrl.removeEventListener("fetch:link."+h);f.setActive(false)},bindPlayListEvent:function(){},bindPlayerEvent:function(d,b){var c=d.player,f=b.guid;c.setEventListener(c.EVENTS.POSITIONCHANGE,T.fn.bind(function(g){this._onPosition(b,g.position)},this),f);c.setEventListener(c.EVENTS.PROGRESS,T.fn.bind(function(g){this._onProgress(b,g.progress)},this),f);c.setEventListener(c.EVENTS.STATECHANGE,T.fn.bind(function(g){this._onState(b,g.newState)},this),f)},bindSongInfoEvent:function(c,b){c.addEventListener("fetch:link",T.fn.bind(function(d){this._onSongInfo(b,d.song)},this),b.guid)},bindUIEvent:function(d,b){var c=d.player;b.addEventListener(b.EVENTS.POSITIONCHANGE,function(f){c.setCurrentPosition(d.getTotalTime()*f.percent)},b.guid);b.addEventListener(b.EVENTS.VOLCHANGE,function(f){c.setVolume(f.volume)},b.guid);b.addEventListener(b.EVENTS.TOGGLEPLAY,function(f){d.player[f.isPlay?"play":"pause"]()},b.guid);b.addEventListener(b.EVENTS.MUTECHANGE,function(f){c.setMute(f.mute)},b.guid)},_onSongInfo:function(f,h){if(f.widget.title){var d=f.createSongFilter(h);if(!d.songName||d.songName==="\u8be5\u6b4c\u66f2\u5df2\u4e0b\u67b6"){f.widget.title.addClass("grey")}else{f.widget.title.removeClass("grey")}f.widget.title.html(baidu.template(f.widget.title.tpl,d))}if(f.widget.lrc&&h){mbox.SongDataModel.getLrcContent(h,{success:function(i){f.widget.lrc.lrc("setLrc",i)},error:function(){f.widget.lrc.lrc("setLrc","")}})}if(f.widget.album){f.widget.album.html(baidu.template(f.widget.album.tpl,h));var c=f.widget.album.find("img");if(!c[0].src){var g=c.attr("data-src");g&&c.attr("src",g)}}if(f.widget.time){var b=this.playctrl.getTotalTime();f.widget.time.html(baidu.template(f.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(b)}))}},_onPosition:function(c,d){var b=this.playctrl.getTotalTime();if(c.widget.slider&&!c.widget.slider.isSliding){c.widget.slider.box_slider("option","value",d*c.widget.slider.maxValue/b||0)}if(c.widget.lrc){c.widget.lrc.lrc("scrollTo",d)}if(c.widget.time){c.widget.time.html(baidu.template(c.widget.time.tpl,{curTime:mbox.convertTime(d),totalTime:mbox.convertTime(b)}))}},_onProgress:function(c,b){if(c.widget.slider&&!c.widget.slider.sliding){c.widget.slider.box_slider("progress",b*c.widget.slider.maxValue)}},_onState:function(c,b){if(c.widget.playBtn){var d=this.playctrl.player;playing=b===d.STATES.PLAY||b===d.STATES.PREBUFFER||b===d.STATES.BUFFERING;if(!playing){c.widget.playBtn.addClass("stop")}else{c.widget.playBtn.removeClass("stop")}}}}})(window);;_.Module.define({path:"common/component/MusicPlayer",requires:[],sub:{initial:function(a,c){if(!window.playctrl){window.playctrl=new mbox.PlayCtrl()}this.api=playctrl.exportAPI();this.log=playctrl.log;this.controller=new mbox.Controller(playctrl);this.logList={"song-name a":"song_title","artist-name a":"artist_name","album-name a":"album_name",logo:"logo","lrc-btn":"lrc","download-btn":"download","go-to-listen-btn":"to_musicbox"};this.ui=[];var b=0;for(;b<a.length;b++){this.mboxInit(c[b],a[b],b)}this.eventInit()},mboxInit:function(a,b,e){var h=this.ui,j=this.logList,c=this.log,g=this.api,f=this.controller;h[e]=new mbox.UiCtrl($(a));if(typeof(b)!=="object"){var d=mbox.SongDataModel.createSongModel(b);mbox.SongDataModel.fetchSong(d[0],{success:function(i){h[e].tplToHtml(i,a,j,c);h[e].setShowLink(i,a)}})}else{if(b.hasLink!=true){b={hasLink:true,songId:b.song_id,songName:b.title,artistId:b.ting_uid,artistName:b.author,albumId:b.album_id,albumName:b.album_title,songPicBig:b.pic_big,songPicSmall:b.pic_small,songPicRadio:b.pic_radio,resourceType:b.resource_type,relateStatus:b.relate_status,copyType:b.copy_type,lrcLink:b.lrclink,rate:b.file_bitrate,songLink:b.file_link,showLink:b.show_link,format:b.file_extension,size:b.file_size,time:b.file_duration}}h[e].tplToHtml(b,a,j,c);h[e].setShowLink(b,a)}g.addSong(b);$(a).find(".ctrl-btn").click(function(){if(!h[e].$root.hasClass("active")){playctrl.player.stop();var k=i(e);setTimeout(k,100)}function i(l){return function(){f.bindUi(h[l],true);g.setPlayIndex(l,true)}}})},eventInit:function(){var a=$(document);a.delegate(".add-favour","click",function(){var c=this;var e=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");var b=$.cookie("BDUSS");var d="http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.favorite.addSongFavorite&from=tieba";$.getJSON(d+"&callback=?",{songId:e},function(f){var g=f.error_code;if(g===22000||g===22322){$(c).addClass("add-favour-red")}else{if(g===22452){_.Module.use("common/component/LoginDialog",["",""])}}})}).delegate(".lrc-btn","click",function(){var b=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+b+"#song_lyric")}).delegate(".download-btn","click",function(){var b=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+b+"/download")}).delegate(".go-to-listen-btn","click",function(){var b=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com//box?&&__methodName=mboxCtrl.playSong&__argsValue="+b)})}}});;